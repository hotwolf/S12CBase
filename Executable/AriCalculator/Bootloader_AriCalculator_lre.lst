                                      ;# Size of the bootloader code
??????        -> $1000                BOOTLOADER_SIZE         EQU     $1000           ;default is 4K
                                      ;###############################################################################
                                      ;# Module configuration                                                        #
                                      ;###############################################################################
                                      ;#CLOCK
??????        -> $0001                CLOCK_CPMU              EQU     1               ;CPMU
??????        -> $0001                CLOCK_IRC               EQU     1               ;use IRC
??????        -> $F4240               CLOCK_OSC_FREQ          EQU      1000000        ; 1 MHz IRC frequency
??????        -> $17D7840             CLOCK_BUS_FREQ          EQU     25000000        ;25 MHz bus frequency
??????        -> $F4240               CLOCK_REF_FREQ          EQU      1000000        ; 1 MHz reference clock frequency
??????        -> $0001                CLOCK_VCOFRQ            EQU     $1              ;10 MHz VCO frequency
??????        -> $0000                CLOCK_REFFRQ            EQU     $0              ; 1 MHz reference clock frequency
                                      ;#VECTAB
??????        -> $0001                VECTAB_DEBUG_OFF        EQU     1               ;debug IRQs
                                      ;#SSTACK:
??????        -> $1AF8                SSTACK_TOP              EQU     STACKS_START
??????        -> $1AF8                SSTACK_TOP_LIN          EQU     STACKS_START
??????        -> $2F80                SSTACK_BOTTOM           EQU     STACKS_END
                                      ;#ISTACK
??????        -> $0001                ISTACK_NO_WAI           EQU     1               ;don't enter wait mode when debugging
                                      ;#SCI
??????        -> $0001                SCI_V5                  EQU     1               ;V5
??????        -> $0001                SCI_BAUD_9600           EQU     1               ;fixed baud rate
??????        -> $0001                SCI_BAUD_DETECT_OFF     EQU     1               ;no baud rate detection
??????        -> $0040                SCI_OC_TIM              EQU     TIM             ;ECT
??????        -> $0000                SCI_OC                  EQU     0               ;OC0
??????        -> $0001                SCI_RTSCTS              EQU     1               ;RTS/CTS flow control
??????        -> $0250                SCI_RTS_PORT            EQU     PTM             ;PTM
??????        -> $0001                SCI_RTS_PIN             EQU     PM0             ;PM0
??????        -> $0250                SCI_CTS_PORT            EQU     PTM             ;PTM
??????        -> $0252                SCI_CTS_DDR             EQU     DDRM            ;DDRM
??????        -> $0255                SCI_CTS_PPS             EQU     PPSM            ;PPSM
??????        -> $0002                SCI_CTS_PIN             EQU     PM1             ;PM1
??????        -> $0001                SCI_CTS_STRONG_DRIVE    EQU     1               ;strong drive
??????        -> $0001                SCI_RXTX_ACTHI          EQU     1               ;RXD/TXD are active hi
??????        -> $0040                SCI_RXBUF_SIZE          EQU     32*2            ;easier to debug
??????        -> $0008                SCI_TXBUF_SIZE          EQU     8               ;easier to debug
                                      ;#STRING
                                      ;STRING_ENABLE_ERASE_NB EQU     1               ;enable STRING_ERASE_NB
                                      ;STRING_ENABLE_ERASE_BL EQU     1               ;enable STRING_ERASE_BL
                                      ;STRING_ENABLE_FILL_NB  EQU     1               ;enable STRING_FILL_NB
                                      ;STRING_ENABLE_FILL_BL  EQU     1               ;enable STRING_FILL_BL
??????        -> $0001                STRING_ENABLE_PRINTABLE EQU     1               ;enable STRING_PRINTABLE
                                      ;#LED
                                      ; LED A: PE0 -> busy  (green)
                                      ; LED B: PE1 -> error (red)
                                      ; Timer usage
                                      ;LED_TIM                EQU     TIM             ;TIM
                                      ;LED_OC                 EQU     1               ;OC1
                                      ; LED A
??????        -> $0001                LED_A_BLINK_OFF         EQU     1               ;no blink patterns
??????        -> $0008                LED_A_PORT              EQU     PORTE           ;port E
??????        -> $0001                LED_A_PIN               EQU     PE0             ;PE0
                                      ; LED B
??????        -> $0001                LED_B_BLINK_OFF         EQU     1               ;no blink patterns
??????        -> $0008                LED_B_PORT              EQU     PORTE           ;port E
??????        -> $0002                LED_B_PIN               EQU     PE1             ;PE1
                                      ;#TIM
??????        -> $0001                TIM_TIOS_INIT           EQU     SCI_OC_TIOS_INIT|LED_TIOS_INIT
                                      ;#DISP
??????        -> $3926                DISP_SEQ_INIT_START     EQU     IMG_SEQ_INIT_START;start of initialization stream
??????        -> $3C02                DISP_SEQ_INIT_END       EQU     DISP_SEQ_INIT_END ;end of initialization stream
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;#Error codes
??????        -> $0001                BOOTLOADER_ERR_UNKNOWN  EQU     $01             ;unknown error
                                                              ;Vector table
??????        -> $2F80                VECTAB_START            EQU     RAM_TABS_START_LIN-VECTAB_SIZE          ;LRE destination
??????        -> $3F80                VECTAB_START_LIN        EQU     MMAP_RAM_END-VECTAB_SIZE                ;LRE source
                                                              ;RAM tables
??????        -> $1400                RAM_TABS_START          EQU     MMAP_RAM_START                          ;LRE destination
??????        -> $3000                RAM_TABS_START_LIN      EQU     MMAP_RAM_END-BOOTLOADER_SIZE            ;LRE source
                                                              ;RAM code
00140F 00300F                                                 ORG     RAM_TABS_END, RAM_TABS_END_LIN
00140F 00300F -> $140F                RAM_CODE_START          EQU     *                                       ;LRE destination
00140F 00300F -> $300F                RAM_CODE_START_LIN      EQU     @                                       ;LRE source
                                                              ;Variables
00198B 00198B                                                 ORG     RAM_CODE_END, RAM_CODE_END
00198B 00198B -> $198B                VARS_START              EQU     *
00198B 00198B -> $198B                VARS_START_LIN          EQU     @
                                                              ;Stacks
001AF8 001AF8                                                 ORG     VARS_END, VARS_END
001AF8 001AF8 -> $1AF8                STACKS_START            EQU     *
001AF8 001AF8 -> $2F80                STACKS_END              EQU     VECTAB_START
001AF8 001AF8                                                 DS      STACKS_END-STACKS_START
                                                              ;Code
002F80 002F80 -> $358B                CODE_START              EQU     RAM_CODE_END_LIN&$FFFF
002F80 002F80 -> $358B                CODE_START_LIN          EQU     RAM_CODE_END_LIN
                                                              ;Tables
00386B 00386B                                                 ORG     CODE_END, CODE_END_LIN
00386B 00386B -> $386B                TABS_START              EQU     *
00386B 00386B -> $386B                TABS_START_LIN          EQU     @
                                      ;###############################################################################
                                      ;# Global variable space                                                       #
                                      ;###############################################################################
00198B 00198B                                                 ORG     VARS_START, VARS_START_LIN
00198B 00198B -> $198B                MMAP_VARS_START         EQU     *
00198B 00198B -> $198B                MMAP_VARS_START_LIN     EQU     @
00198B 00198B                                                 ORG     MMAP_VARS_END, MMAP_VARS_END_LIN
00198B 00198B -> $198B                GPIO_VARS_START         EQU     *
00198B 00198B -> $198B                GPIO_VARS_START_LIN     EQU     @
00198B 00198B                                                 ORG     GPIO_VARS_END, GPIO_VARS_END_LIN
00198B 00198B -> $198B                RESET_VARS_START        EQU     *
00198B 00198B -> $198B                RESET_VARS_START_LIN    EQU     @
00198B 00198B                                                 ORG     RESET_VARS_END, RESET_VARS_END_LIN
00198B 00198B -> $198B                CLOCK_VARS_START        EQU     *
00198B 00198B -> $198B                CLOCK_VARS_START_LIN    EQU     @
00198B 00198B                                                 ORG     CLOCK_VARS_END, CLOCK_VARS_END_LIN
00198B 00198B -> $198B                LRE_VARS_START          EQU     *
00198B 00198B -> $198B                LRE_VARS_START_LIN      EQU     @
00198B 00198B                                                 ORG     LRE_VARS_END, LRE_VARS_END_LIN
00198B 00198B -> $198B                TIM_VARS_START          EQU     *
00198B 00198B -> $198B                TIM_VARS_START_LIN      EQU     @
00198B 00198B                                                 ORG     TIM_VARS_END, TIM_VARS_END_LIN
00198B 00198B -> $198B                VECTAB_VARS_START       EQU     *
00198B 00198B -> $198B                VECTAB_VARS_START_LIN   EQU     @
00198B 00198B                                                 ORG     VECTAB_VARS_END, VECTAB_VARS_END_LIN
00198B 00198B -> $198B                SSTACK_VARS_START       EQU     *
00198B 00198B -> $198B                SSTACK_VARS_START_LIN   EQU     @
00198B 00198B                                                 ORG     SSTACK_VARS_END, SSTACK_VARS_END_LIN
00198B 00198B -> $198B                ISTACK_VARS_START       EQU     *
00198B 00198B -> $198B                ISTACK_VARS_START_LIN   EQU     @
00198B 00198B                                                 ORG     ISTACK_VARS_END, ISTACK_VARS_END_LIN
00198B 00198B -> $198B                SCI_VARS_START          EQU     *
00198B 00198B -> $198B                SCI_VARS_START_LIN      EQU     @
0019DA 0019DA                                                 ORG     SCI_VARS_END, SCI_VARS_END_LIN
0019DA 0019DA -> $19DA                STRING_VARS_START       EQU     *
0019DA 0019DA -> $19DA                STRING_VARS_START_LIN   EQU     @
0019DA 0019DA                                                 ORG     STRING_VARS_END, STRING_VARS_END_LIN
0019DA 0019DA -> $19DA                DISP_VARS_START         EQU     *
0019DA 0019DA -> $19DA                DISP_VARS_START_LIN     EQU     @
0019ED 0019ED                                                 ORG     DISP_VARS_END, DISP_VARS_END_LIN
0019ED 0019ED -> $19ED                LED_VARS_START          EQU     *
0019ED 0019ED -> $19ED                LED_VARS_START_LIN      EQU     @
0019ED 0019ED                                                 ORG     LED_VARS_END, LED_VARS_END_LIN
0019ED 0019ED -> $19ED                NVM_VARS_START          EQU     *
0019ED 0019ED -> $19ED                NVM_VARS_START_LIN      EQU     @
001AEB 001AEB                                                 ORG     NVM_VARS_END, NVM_VARS_END_LIN
001AEB 001AEB -> $1AEB                SREC_VARS_START         EQU     *
001AEB 001AEB -> $1AEB                SREC_VARS_START_LIN     EQU     @
001AF7 001AF7                                                 ORG     SREC_VARS_END, SREC_VARS_END_LIN
001AF7 001AF7 -> $1AF7                IMG_VARS_START          EQU     *
001AF7 001AF7 -> $1AF7                IMG_VARS_START_LIN      EQU     @
001AF7 001AF7                                                 ORG     IMG_VARS_END, IMG_VARS_END_LIN
001AF7 001AF7                         BOOTLOADER_COUNT        DS      1
001AF8 001AF8 -> $1AF8                VARS_END                EQU     *
001AF8 001AF8 -> $1AF8                VARS_END_LIN            EQU     @
                                      ;###############################################################################
                                      ;# Code space                                                                  #
                                      ;###############################################################################
00358B 00358B                                                 ORG     CODE_START, CODE_START_LIN
00358B 00358B -> $358B                START_OF_CODE           EQU     *
                                                              ;Initialization
00358B 00358B MACRO                                           INIT                                    ;initialize bootloader
                                      ;############################################################################### (INIT)
                                      ;# Initialization                                                              # (INIT)
                                      ;############################################################################### (INIT)
00358B 00358B MACRO                                           RESET_INIT              ;start bootloder or application  (INIT)
                                      ;############################################################################### (INIT/RESET_INIT)
                                      ;# Macros                                                                      # (INIT/RESET_INIT)
                                      ;############################################################################### (INIT/RESET_INIT)
                                      ;#Initialization                                                                 (INIT/RESET_INIT)
00358B 00358B -> $358B                START_FIRMWARE          EQU     START_OF_CODE                           ;loop until key combination is pushed (INIT/RESET_INIT)
                                                              ;Setup keypad                                            (INIT/RESET_INIT)
00358B 00358B 18 0B FF 00 7D          CHECK_KEYPAD            MOVB    #$FF, ATDDIENL                          ;enable PAD's input buffers (INIT/RESET_INIT)
003590 003590 18 0B FF 02 79                                  MOVB    #$FF, PER1AD                            ;enable PAD's pull-ups (INIT/RESET_INIT)
003595 003595 18 0B 3F 02 5A                                  MOVB    #$3F,   DDRP                            ;drive keyboard columns low (INIT/RESET_INIT)
                                                              ;Check key pad                                           (INIT/RESET_INIT)
                                                              ;          P  P  P  P  P  P                              (INIT/RESET_INIT)
                                                              ;          P  P  P  P  P  P                              (INIT/RESET_INIT)
                                                              ;          0  1  2  3  4  5                              (INIT/RESET_INIT)
                                                              ;          |  |  |  |  |  |                              (INIT/RESET_INIT)
                                                              ; PAD6 ---29-28-27-26-25-24 |G                           (INIT/RESET_INIT)
                                                              ;          |  |  |  |  |  | |                            (INIT/RESET_INIT)
                                                              ; PAD5 ---23-22-21-20-1F-1E |F                           (INIT/RESET_INIT)
                                                              ;          |  |  |  |  |  | |                            (INIT/RESET_INIT)
                                                              ; PAD4 ---1D-1C-1B-1A-19-18 |E                           (INIT/RESET_INIT)
                                                              ;             |  |  |  |  | |                            (INIT/RESET_INIT)
                                                              ; PAD3 ------16-15-14-13-12 |D                           (INIT/RESET_INIT)
                                                              ;             |  |  |  |  | |                            (INIT/RESET_INIT)
                                                              ; PAD2 ------10--F--E--D--C |C                           (INIT/RESET_INIT)
                                                              ;             |  |  |  |  | |                            (INIT/RESET_INIT)
                                                              ; PAD1 -------A--9--8--7--6 |B                           (INIT/RESET_INIT)
                                                              ;             |  |  |  |  | |                            (INIT/RESET_INIT)
                                                              ; PAD0 -------4--3--2--1--0 |A                           (INIT/RESET_INIT)
                                                              ;          ________________                              (INIT/RESET_INIT)
                                                              ;          5  4  3  2  1  0                              (INIT/RESET_INIT)
00359A 00359A 18 0B FD 02 58                                  MOVB    #$FD, PTP                               ;check row 4 (INIT/RESET_INIT)
00359F 00359F A7                                              NOP                                             ;wait    (INIT/RESET_INIT)
0035A0 0035A0 B6 02 71                                        LDAA    PT1AD                                   ;row pattern -> A (INIT/RESET_INIT)
0035A3 0035A3 18 0B EF 02 58                                  MOVB    #$EF, PTP                               ;check row 1 (INIT/RESET_INIT)
0035A8 0035A8 81 FB                                           CMPA    #$FB                                    ;check for ENTER key (INIT/RESET_INIT)
0035AA 0035AA 26 DF                                           BNE     START_FIRMWARE                          ;start regular firmware (INIT/RESET_INIT)
0035AC 0035AC B6 02 71                                        LDAA    PT1AD                                   ;row pattern -> A (INIT/RESET_INIT)
0035AF 0035AF 18 0B DF 02 58                                  MOVB    #$DF, PTP                               ;check row 0 (INIT/RESET_INIT)
0035B4 0035B4 81 FE                                           CMPA    #$FE                                    ;check for DEL key (INIT/RESET_INIT)
0035B6 0035B6 26 D3                                           BNE     START_FIRMWARE                          ;start regular firmware (INIT/RESET_INIT)
0035B8 0035B8 B6 02 71                                        LDAA    PT1AD                                   ;row pattern -> A (INIT/RESET_INIT)
0035BB 0035BB 18 0B F7 02 58                                  MOVB    #$F7, PTP                               ;check row 2 (INIT/RESET_INIT)
0035C0 0035C0 41                                              COMA                                            ;check for no key (INIT/RESET_INIT)
0035C1 0035C1 26 C8                                           BNE     START_FIRMWARE                          ;start regular firmware (INIT/RESET_INIT)
0035C3 0035C3 B6 02 71                                        LDAA    PT1AD                                   ;row pattern -> A (INIT/RESET_INIT)
0035C6 0035C6 18 0B FB 02 58                                  MOVB    #$FB, PTP                               ;check row 3 (INIT/RESET_INIT)
0035CB 0035CB 41                                              COMA                                            ;check for no key (INIT/RESET_INIT)
0035CC 0035CC 26 BD                                           BNE     START_FIRMWARE                          ;start regular firmware (INIT/RESET_INIT)
0035CE 0035CE B6 02 71                                        LDAA    PT1AD                                   ;row pattern -> A (INIT/RESET_INIT)
0035D1 0035D1 18 0B FE 02 58                                  MOVB    #$FE, PTP                               ;check row 5 (INIT/RESET_INIT)
0035D6 0035D6 41                                              COMA                                            ;check for no key (INIT/RESET_INIT)
0035D7 0035D7 26 B2                                           BNE     START_FIRMWARE                          ;start regular firmware (INIT/RESET_INIT)
0035D9 0035D9 B6 02 71                                        LDAA    PT1AD                                   ;row pattern -> A (INIT/RESET_INIT)
0035DC 0035DC 18 0B FF 02 58                                  MOVB    #$FF, PTP                               ;unselect keypad columns (INIT/RESET_INIT)
0035E1 0035E1 41                                              COMA                                            ;check for no key (INIT/RESET_INIT)
0035E2 0035E2 26 A7                                           BNE     START_FIRMWARE                          ;start regular firmware (INIT/RESET_INIT)
0035E4 0035E4 MACRO                                           MMAP_INIT               ;configure memory map            (INIT)
0035E4 0035E4 MACRO                                           GPIO_INIT               ;configure I/Os                  (INIT)
                                      ;############################################################################### (INIT/GPIO_INIT)
                                      ;# Macros                                                                      # (INIT/GPIO_INIT)
                                      ;############################################################################### (INIT/GPIO_INIT)
                                      ;#Initialization                                                                 (INIT/GPIO_INIT)
                                                      ;#Urgent initializations                                         (INIT/GPIO_INIT)
0035E4 0035E4 18 0B 03 02 4D                          MOVB    #03, PPSS                               ;switch to pull-downs on PS[1:0] (TX/RX) (INIT/GPIO_INIT)
                                                      ;#Port AD                                                        (INIT/GPIO_INIT)
0035E9 0035E9 18 03 FC FF 00 7C                       MOVW    #%1111_1100_1111_1111, ATDDIEN          ;switch unused pins to digital (INIT/GPIO_INIT)
                                                      ;MOVW   #$0000, PT0AD                                            (INIT/GPIO_INIT)
                                                      ;MOVW   #$0000, DDR0AD                                           (INIT/GPIO_INIT)
0035EF 0035EF 18 03 FC FF 02 78                       MOVW    #%1111_1100_1111_1111, PER0AD                            (INIT/GPIO_INIT)
                                                      ;MOVW   #$0000, PPS0AD                                           (INIT/GPIO_INIT)
                                                      ;MOVW   #$0000, PIE0AD                                           (INIT/GPIO_INIT)
                                                      ;#Port A, B, C, D, and E                                         (INIT/GPIO_INIT)
                                                      ;MOVW   #$0000, PORTA                           ;port A/B        (INIT/GPIO_INIT)
                                                      ;MOVW   #$0000, DDRA                            ;port A/B        (INIT/GPIO_INIT)
                                                      ;MOVW   #$0000, PORTC                           ;port C/D        (INIT/GPIO_INIT)
                                                      ;MOVW   #$0000, DDRC                            ;port C/D        (INIT/GPIO_INIT)
0035F5 0035F5 18 03 03 03 00 08                       MOVW    #$0303, PORTE                           ;port E (PORTE/DDRE) (INIT/GPIO_INIT)
0035FB 0035FB 18 0B 4F 00 0C                          MOVB    #$4F,   PUCR                            ;BKPUE|~PDPEE|PUPDE|PUPCE|PUPBE|PUPAE (INIT/GPIO_INIT)
                                                      ;MOVB   #$C0,   ECLKCTL                                          (INIT/GPIO_INIT)
                                                      ;MOVB   #$00,   IRQCR                                            (INIT/GPIO_INIT)
                                                      ;#Port J                                                         (INIT/GPIO_INIT)
                                                      ;MOVB   #$00,   PTJ                                              (INIT/GPIO_INIT)
                                                      ;MOVB   #$00,   DDRJ                                             (INIT/GPIO_INIT)
                                                      ;MOVB   #$FF    PERJ                                             (INIT/GPIO_INIT)
003600 003600 18 0B 0F 02 6D                          MOVB    #$0F,   PPSJ                                             (INIT/GPIO_INIT)
                                                      ;MOVB   #$00FF, PIEJ                            ;PIEJ/PIFJ       (INIT/GPIO_INIT)
                                                      ;#Port M                                                         (INIT/GPIO_INIT)
                                                      ;MOVB   #$00,   PTM                                              (INIT/GPIO_INIT)
003605 003605 18 0B 02 02 52                          MOVB    #$02,   DDRM                                             (INIT/GPIO_INIT)
00360A 00360A 18 03 0D 01 02 54                       MOVW    #$0D01  PERM                            ;PERM/PPSM       (INIT/GPIO_INIT)
                                                      ;MOVB   #$02,   WOMM                                             (INIT/GPIO_INIT)
                                                      ;#Port P                                                         (INIT/GPIO_INIT)
                                                      ;MOVB   #$00,   PTP                                              (INIT/GPIO_INIT)
003610 003610 18 0B 3F 02 5A                          MOVB    #$3F,   DDRP                            ;drive keyboard columns low (INIT/GPIO_INIT)
003615 003615 18 0B FF 02 5C                          MOVB    #$FF    PERP                                             (INIT/GPIO_INIT)
                                                      ;MOVB   #$00,   PPSP                                             (INIT/GPIO_INIT)
                                                      ;MOVB   #$00FF, PIEP                            ;PIEP/PIFP       (INIT/GPIO_INIT)
                                                      ;#Port S                                                         (INIT/GPIO_INIT)
00361A 00361A 18 0B 80 02 48                          MOVB    #$80,   PTS                                              (INIT/GPIO_INIT)
00361F 00361F 18 0B FA 02 4A                          MOVB    #$FA,   DDRS                                             (INIT/GPIO_INIT)
003624 003624 18 03 0A 01 02 4C                       MOVW    #$0A01, PERS                            ;PERS/PPSS       (INIT/GPIO_INIT)
                                                      ;MOVB   #$02,   WOMS                                             (INIT/GPIO_INIT)
                                                      ;#Port T                                                         (INIT/GPIO_INIT)
00362A 00362A 18 0B 20 02 40                          MOVB    #$20,   PTT                                              (INIT/GPIO_INIT)
00362F 00362F 18 0B 20 02 42                          MOVB    #$20,   DDRT                                             (INIT/GPIO_INIT)
003634 003634 18 0B DC 02 44                          MOVB    #$DC    PERT                                             (INIT/GPIO_INIT)
                                                      ;General setup                                                   (INIT/GPIO_INIT)
003639 003639 86 80                                   LDAA    #MODC                                   ;lock MODE register into NSC mode (INIT/GPIO_INIT)
00363B 00363B 5A 0B                                   STAA    MODE                                                     (INIT/GPIO_INIT)
00363D 00363D 5A 0B                                   STAA    MODE                                                     (INIT/GPIO_INIT)
00363F 00363F 18 0C 02 57 02 57                       MOVB    PKGCR, PKGCR                            ;lock PKGCR      (INIT/GPIO_INIT)
003645 003645 MACRO                                           CLOCK_INIT              ;configure clocks                (INIT)
                                      ;############################################################################### (INIT/CLOCK_INIT)
                                      ;# Macros                                                                      # (INIT/CLOCK_INIT)
                                      ;############################################################################### (INIT/CLOCK_INIT)
                                      ;#Initialization                                                                 (INIT/CLOCK_INIT)
                                      ;#--------------                                                                 (INIT/CLOCK_INIT)
003645 003645 18 0B FF 00 37                                  MOVB    #$FF, CPMUFLG                                   ;clear all flags (INIT/CLOCK_INIT)
00364A 00364A 18 03 58 00 00 34                               MOVW    #CLOCK_PLL_CONFIG, CPMUSYNR                     ;setup PLL (INIT/CLOCK_INIT)
003650 003650 79 00 36                                        CLR     CPMUPOSTDIV                                     ;disable POSTDIV divider (INIT/CLOCK_INIT)
                                                              ;CLR    CPMUINT                                         ;disable PLL lock interrupts (INIT/CLOCK_INIT)
                                                              ;MOVB   #LOCKIE, CPMUINT                                ;enable PLL lock interrupt (INIT/CLOCK_INIT)
                                                              ;MOVB   #PLLSEL, CPMUCLKS                               ;enable PLL (INIT/CLOCK_INIT)
                                                              ;CLR    CPMUPLL                                         ;no frequency modulation (INIT/CLOCK_INIT)
                                                              ;CLR    CPMURTI                                         ;no real time interrupt (INIT/CLOCK_INIT)
                                                              ;MOVB   #(RSBCK|CR1|CR2|CR3), CPMUCOP                   ;configure COP (INIT/CLOCK_INIT)
                                                              ;CLR    CPMULVCTL                                       ;no low-voltage interrupt (INIT/CLOCK_INIT)
                                                              ;CLR    CPMUAPICTL                                      ;no API (INIT/CLOCK_INIT)
                                                              ;CLR    CPMUAPIRH                                       ;no API (INIT/CLOCK_INIT)
                                                              ;CLR    CPMUAPIRL                                       ;no API (INIT/CLOCK_INIT)
003653 003653 18 0B 01 02 FB                                  MOVB    #PROT, CPMUPROT                                 ;lock CPMU configuration (INIT/CLOCK_INIT)
003658 003658 MACRO                                           VECTAB_INIT             ;configure cector table          (INIT)
                                      ;############################################################################### (INIT/VECTAB_INIT)
                                      ;# Macros                                                                      # (INIT/VECTAB_INIT)
                                      ;############################################################################### (INIT/VECTAB_INIT)
                                      ;#Initialization                                                                 (INIT/VECTAB_INIT)
                                                              ;Set vector base address                                 (INIT/VECTAB_INIT)
003658 003658 18 0B 2F 01 20                                  MOVB    #(VECTAB_START>>8), IVBR                         (INIT/VECTAB_INIT)
00365D 00365D MACRO                                           SSTACK_INIT             ;configure subroutine stack      (INIT)
00365D 00365D MACRO                                           ISTACK_INIT             ;configure interrupt stack       (INIT)
                                      ;############################################################################### (INIT/ISTACK_INIT)
                                      ;# Macros                                                                      # (INIT/ISTACK_INIT)
                                      ;############################################################################### (INIT/ISTACK_INIT)
                                      ;#Initialization                                                                 (INIT/ISTACK_INIT)
                                      ;#--------------                                                                 (INIT/ISTACK_INIT)
                                                              ;Set stack pointer                                       (INIT/ISTACK_INIT)
00365D 00365D CF 2F 80                                        LDS     #ISTACK_BOTTOM                                   (INIT/ISTACK_INIT)
                                                              ;Enable interrupts                                       (INIT/ISTACK_INIT)
003660 003660 10 EF                                           CLI                                                      (INIT/ISTACK_INIT)
003662 003662 MACRO                                           TIM_INIT                ;configure timers                (INIT)
                                      ;############################################################################### (INIT/TIM_INIT)
                                      ;# Macros                                                                      # (INIT/TIM_INIT)
                                      ;############################################################################### (INIT/TIM_INIT)
                                      ;#Initialization                                                                 (INIT/TIM_INIT)
                                      ;#Default initialization macro                                                   (INIT/TIM_INIT)
                                                              ;TIOS                                                    (INIT/TIM_INIT)
003662 003662 18 0B 01 00 40                                  MOVB    #TIM_TIOS_INIT, TIOS                             (INIT/TIM_INIT)
003667 003667 MACRO                                           LED_INIT                ;configure LEDs                  (INIT)
003667 003667 MACRO                                           NVM_INIT                ;configure NVM                   (INIT)
                                      ;############################################################################### (INIT/NVM_INIT)
                                      ;# Macros                                                                      # (INIT/NVM_INIT)
                                      ;############################################################################### (INIT/NVM_INIT)
                                      ;#Initialization                                                                 (INIT/NVM_INIT)
                                                              ;Initialize the NVM wrapper                              (INIT/NVM_INIT)
003667 003667 18 0B 58 01 00                                  MOVB    #(FDIVLCK|NVM_FDIV_VAL), FCLKDIV;set clock divider (INIT/NVM_INIT)
00366C 00366C 18 0B 02 01 05                                  MOVB    #DFDIE,FERCNFG                  ;detect ECC double faults (INIT/NVM_INIT)
                                                              ;Initialize the sector status                            (INIT/NVM_INIT)
003671 003671 CE 1A B0                                        LDX     #NVM_TAGS                                        (INIT/NVM_INIT)
003674 003674 CD 00 0E                                        LDY     #(NVM_TAGS_END-NVM_TAGS)/4                       (INIT/NVM_INIT)
003677 003677 87                                              CLRA                                                     (INIT/NVM_INIT)
003678 003678 C7                                              CLRB                                                     (INIT/NVM_INIT)
003679 003679 6C 31                   LOOP                    STD     2,X+                                             (INIT/NVM_INIT)
00367B 00367B 6C 31                                           STD     2,X+                                             (INIT/NVM_INIT)
00367D 00367D 04 36 F9                                        DBNE    Y, LOOP                                          (INIT/NVM_INIT)
                                                              ;Initialize the program buffer (0 in D)                  (INIT/NVM_INIT)
003680 003680 7C 1A AE                                        STD     NVM_BUF_IN                      ;reset IN:OUT    (INIT/NVM_INIT)
003683 003683 7C 1A 6E                                        STD     NVM_ADDR_BUF                    ;set initial address (INIT/NVM_INIT)
003686 003686 7C 1A 70                                        STD     NVM_ADDR_BUF+2                  ;reset IN:OUT    (INIT/NVM_INIT)
003689 003689 MACRO                                           SCI_INIT                ;configure SCI                   (INIT)
                                      ;############################################################################### (INIT/SCI_INIT)
                                      ;# Macros                                                                      # (INIT/SCI_INIT)
                                      ;############################################################################### (INIT/SCI_INIT)
                                      ;#Initialization                                                                 (INIT/SCI_INIT)
                                      ;#--------------                                                                 (INIT/SCI_INIT)
                                                              ;Setup SCI communication                                 (INIT/SCI_INIT)
003689 003689 18 0B 04 00 CA                                  MOVB    #SCI_FORMAT, SCICR1                     ;set frame format (INIT/SCI_INIT)
00368E 00368E 18 0B 18 00 CD                                  MOVB    #(TXPOL|RXPOL), SCISR2                  ;invert RXD/TXD polarity (INIT/SCI_INIT)
                                                              ;Initialize buffers                                      (INIT/SCI_INIT)
003693 003693 18 03 00 00 19 D6                               MOVW    #$0000,SCI_TXBUF_IN                     ;set TX buffer indexes (INIT/SCI_INIT)
003699 003699 18 03 00 00 19 CC                               MOVW    #$0000,SCI_RXBUF_IN                     ;set RX buffer indexes (INIT/SCI_INIT)
                                                              ;Initialize variables                                    (INIT/SCI_INIT)
00369F 00369F 79 19 D8                                        CLR     SCI_EXCPT                               ;clear all exception requests (INIT/SCI_INIT)
0036A2 0036A2 79 19 D9                                        CLR     SCI_STAT                                ;clear all flags (INIT/SCI_INIT)
                                                              ;Set baud rate divider                                   (INIT/SCI_INIT)
0036A5 0036A5 18 03 00 A3 00 C8                               MOVW    #SCI_BDIV, SCIBDH                                (INIT/SCI_INIT)
0036AB 0036AB MACRO                                           STRING_INIT             ;configure STRING                (INIT)
                                                              ;NUM_INIT               ;configure NUM                   (INIT)
0036AB 0036AB MACRO                                           SREC_INIT               ;initialize S-record parser      (INIT)
0036AB 0036AB MACRO                                           LRE_INIT                ;copy LRE code                   (INIT)
                                      ;############################################################################### (INIT/LRE_INIT)
                                      ;# Macros                                                                      # (INIT/LRE_INIT)
                                      ;############################################################################### (INIT/LRE_INIT)
                                      ;#Initialization                                                                 (INIT/LRE_INIT)
                                                              ;Copy tables and code                                    (INIT/LRE_INIT)
0036AB 0036AB MACRO                                           LRE_COPY        RAM_TABS_START_LIN, RAM_TABS_START, (RAM_CODE_END-RAM_TABS_START) (INIT/LRE_INIT)
                                      ;Copy loop                                                                       (INIT/LRE_INIT/LRE_COPY)
                                      ; args:   1: source address                                                      (INIT/LRE_INIT/LRE_COPY)
                                      ;         2: destination address                                                 (INIT/LRE_INIT/LRE_COPY)
                                      ;         3: min. number of bytes to copy                                        (INIT/LRE_INIT/LRE_COPY)
                                      ; result: none                                                                   (INIT/LRE_INIT/LRE_COPY)
                                      ; SSTACK: none                                                                   (INIT/LRE_INIT/LRE_COPY)
                                      ;         no registers are preserved                                             (INIT/LRE_INIT/LRE_COPY)
                                                              ;Setup                                                   (INIT/LRE_INIT/LRE_COPY)
0036AB 0036AB CE 30 00                                        LDX     #(RAM_TABS_START_LIN&$FFFF)     ;source address  (INIT/LRE_INIT/LRE_COPY)
0036AE 0036AE CD 14 00                                        LDY     #(RAM_TABS_START&$FFFF)     ;destination address (INIT/LRE_INIT/LRE_COPY)
0036B1 0036B1 CC 00 B2                                        LDD     #((RAM_CODE_END-RAM_TABS_START>>3)+(((RAM_CODE_END-RAM_TABS_START>>2)&1)|((RAM_CODE_END-RAM_TABS_START>>1)&1)|(RAM_CODE_END-RAM_TABS_START&1))) (INIT/LRE_INIT/LRE_COPY)
                                                              ;Loop                                                    (INIT/LRE_INIT/LRE_COPY)
0036B4 0036B4 18 02 31 71             LOOP                    MOVW    2,X+, 2,Y+                                       (INIT/LRE_INIT/LRE_COPY)
0036B8 0036B8 18 02 31 71                                     MOVW    2,X+, 2,Y+                                       (INIT/LRE_INIT/LRE_COPY)
0036BC 0036BC 18 02 31 71                                     MOVW    2,X+, 2,Y+                                       (INIT/LRE_INIT/LRE_COPY)
0036C0 0036C0 18 02 31 71                                     MOVW    2,X+, 2,Y+                                       (INIT/LRE_INIT/LRE_COPY)
0036C4 0036C4 04 34 ED                                        DBNE    D, LOOP                                          (INIT/LRE_INIT/LRE_COPY)
                                                              ;Copy vector table                                       (INIT/LRE_INIT)
0036C7 0036C7 MACRO                                           LRE_COPY        VECTAB_START_LIN, VECTAB_START, VECTAB_SIZE (INIT/LRE_INIT)
                                      ;Copy loop                                                                       (INIT/LRE_INIT/LRE_COPY)
                                      ; args:   1: source address                                                      (INIT/LRE_INIT/LRE_COPY)
                                      ;         2: destination address                                                 (INIT/LRE_INIT/LRE_COPY)
                                      ;         3: min. number of bytes to copy                                        (INIT/LRE_INIT/LRE_COPY)
                                      ; result: none                                                                   (INIT/LRE_INIT/LRE_COPY)
                                      ; SSTACK: none                                                                   (INIT/LRE_INIT/LRE_COPY)
                                      ;         no registers are preserved                                             (INIT/LRE_INIT/LRE_COPY)
                                                              ;Setup                                                   (INIT/LRE_INIT/LRE_COPY)
0036C7 0036C7 CE 3F 80                                        LDX     #(VECTAB_START_LIN&$FFFF)     ;source address    (INIT/LRE_INIT/LRE_COPY)
0036CA 0036CA CD 2F 80                                        LDY     #(VECTAB_START&$FFFF)     ;destination address   (INIT/LRE_INIT/LRE_COPY)
0036CD 0036CD CC 00 10                                        LDD     #((VECTAB_SIZE>>3)+(((VECTAB_SIZE>>2)&1)|((VECTAB_SIZE>>1)&1)|(VECTAB_SIZE&1))) (INIT/LRE_INIT/LRE_COPY)
                                                              ;Loop                                                    (INIT/LRE_INIT/LRE_COPY)
0036D0 0036D0 18 02 31 71             LOOP                    MOVW    2,X+, 2,Y+                                       (INIT/LRE_INIT/LRE_COPY)
0036D4 0036D4 18 02 31 71                                     MOVW    2,X+, 2,Y+                                       (INIT/LRE_INIT/LRE_COPY)
0036D8 0036D8 18 02 31 71                                     MOVW    2,X+, 2,Y+                                       (INIT/LRE_INIT/LRE_COPY)
0036DC 0036DC 18 02 31 71                                     MOVW    2,X+, 2,Y+                                       (INIT/LRE_INIT/LRE_COPY)
0036E0 0036E0 04 34 ED                                        DBNE    D, LOOP                                          (INIT/LRE_INIT/LRE_COPY)
                                                              ;Set vector base address                                 (INIT/LRE_INIT)
0036E3 0036E3 18 0B 2F 01 20                                  MOVB    #(VECTAB_START>>8), IVBR                         (INIT/LRE_INIT)
0036E8 0036E8 MACRO                                           CLOCK_WAIT_FOR_PLL      ;wait for PLL to lock            (INIT)
                                      ;#Wait for PLL                                                                   (INIT/CLOCK_WAIT_FOR_PLL)
                                      ;#------------                                                                   (INIT/CLOCK_WAIT_FOR_PLL)
0036E8 0036E8 14 10                   LOOP            SEI                                                              (INIT/CLOCK_WAIT_FOR_PLL)
0036EA 0036EA 4E 39 80 04                             BRSET   CPMUCLKS, #PLLSEL, DONE                         ;PLL is locked (INIT/CLOCK_WAIT_FOR_PLL)
0036EE 0036EE MACRO                                   ISTACK_WAIT                                                      (INIT/CLOCK_WAIT_FOR_PLL)
                                      ;#Wait until any interrupt has been serviced                                     (INIT/CLOCK_WAIT_FOR_PLL/ISTACK_WAIT)
                                      ; args:   none                                                                   (INIT/CLOCK_WAIT_FOR_PLL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (INIT/CLOCK_WAIT_FOR_PLL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (INIT/CLOCK_WAIT_FOR_PLL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (INIT/CLOCK_WAIT_FOR_PLL/ISTACK_WAIT)
0036EE 0036EE 10 EF                                           CLI                                                      (INIT/CLOCK_WAIT_FOR_PLL/ISTACK_WAIT)
0036F0 0036F0 20 F6                                   JOB     LOOP                                                     (INIT/CLOCK_WAIT_FOR_PLL)
0036F2 0036F2 10 EF                   DONE            CLI                                                              (INIT/CLOCK_WAIT_FOR_PLL)
0036F4 0036F4 MACRO                                           SCI_ACTIVATE            ;activate SCI                    (INIT)
                                      ;#Activate SCI hardware                                                          (INIT/SCI_ACTIVATE)
                                      ; args:   none                                                                   (INIT/SCI_ACTIVATE)
                                      ; result: none                                                                   (INIT/SCI_ACTIVATE)
                                      ; SSTACK: none                                                                   (INIT/SCI_ACTIVATE)
                                      ;         No registers are preserved                                             (INIT/SCI_ACTIVATE)
                                                              ;Activate SCI                                            (INIT/SCI_ACTIVATE)
0036F4 0036F4 18 0B 2C 00 CB                                  MOVB    #(RIE|TE|RE), SCICR2                    ;start SCI (INIT/SCI_ACTIVATE)
                                                              ;Done                                                    (INIT/SCI_ACTIVATE)
0036F9 0036F9 -> $36F9                SCI_ACTIVATE_1          EQU     *                                       ;done    (INIT/SCI_ACTIVATE)
0036F9 0036F9 MACRO                                           IMG_INIT                ;configure display content       (INIT)
0036F9 0036F9 MACRO                                           DISP_INIT               ;configure display               (INIT)
                                      ;############################################################################### (INIT/DISP_INIT)
                                      ;# Macros                                                                      # (INIT/DISP_INIT)
                                      ;############################################################################### (INIT/DISP_INIT)
                                      ;#Initialization                                                                 (INIT/DISP_INIT)
                                                              ;Deassert display reset                                  (INIT/DISP_INIT)
                                                              ;BSET   DISP_RESET_PORT, #DISP_RESET_PIN                 (INIT/DISP_INIT)
                                                              ;BCLR   DISP_A0_PIN,     #DISP_A0_PORT                   (INIT/DISP_INIT)
0036F9 0036F9 18 0B 08 02 48                                  MOVB    #DISP_RESET_PIN, DISP_RESET_PORT ;shortcut       (INIT/DISP_INIT)
                                                              ;Initialize Variables                                    (INIT/DISP_INIT)
0036FE 0036FE 18 03 00 00 19 EA                               MOVW    #$0000, DISP_BUF_IN                              (INIT/DISP_INIT)
003704 003704 79 19 EC                                        CLR     DISP_RPTCNT                                      (INIT/DISP_INIT)
                                                              ;Initialize SPI                                          (INIT/DISP_INIT)
003707 003707 18 03 1E 19 00 D8                               MOVW    #((DISP_SPICR1_CONFIG<<8)|DISP_SPICR2_CONFIG), SPICR1 (INIT/DISP_INIT)
00370D 00370D 18 0B 00 00 DA                                  MOVB    #DISP_SPIBR_CONFIG, SPIBR                        (INIT/DISP_INIT)
003712 003712 F7 00 DB                                        TST     SPISR                                           ;read SPISR (INIT/DISP_INIT)
003715 003715 F7 00 DD                                        TST     SPIDRL                                          ;clear SPIF flag (INIT/DISP_INIT)
                                                              ;Setup display                                           (INIT/DISP_INIT)
003718 003718 CE 39 26                                        LDX     #DISP_SEQ_INIT_START                             (INIT/DISP_INIT)
00371B 00371B CC 3C 02                                        LDD     #DISP_SEQ_INIT_END                               (INIT/DISP_INIT)
00371E 00371E MACRO                                           DISP_STREAM_BL                                           (INIT/DISP_INIT)
                                      ;#Transmit a sequence of commands and data (non-blocking)                        (INIT/DISP_INIT/DISP_STREAM_BL)
                                      ; args:   X: pointer to the start of the sequence                                (INIT/DISP_INIT/DISP_STREAM_BL)
                                      ;         D: pointer to the end of the sequence                                  (INIT/DISP_INIT/DISP_STREAM_BL)
                                      ; result: X: points to the byte after the sequence                               (INIT/DISP_INIT/DISP_STREAM_BL)
                                      ; SSTACK: 11 bytes                                                               (INIT/DISP_INIT/DISP_STREAM_BL)
                                      ;         Y and D are preserved                                                  (INIT/DISP_INIT/DISP_STREAM_BL)
00371E 00371E MACRO                                           SSTACK_JOBSR    DISP_STREAM_BL, 11                       (INIT/DISP_INIT/DISP_STREAM_BL)
                                      ;#Check stack and call subroutine                                                (INIT/DISP_INIT/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (INIT/DISP_INIT/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (INIT/DISP_INIT/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (INIT/DISP_INIT/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (INIT/DISP_INIT/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (INIT/DISP_INIT/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (INIT/DISP_INIT/DISP_STREAM_BL/SSTACK_JOBSR)
00371E 00371E 16 37 DA                                        JOBSR   DISP_STREAM_BL                                   (INIT/DISP_INIT/DISP_STREAM_BL/SSTACK_JOBSR)
                                                              ;Indicate readyness
003721 003721 -> $3721                BOOTLOADER_SHOW_READY   EQU     *
                                                              ;Set LEDs
                                                              ;LED_OFF A                              ;not busy anymore
                                                              ;LED_OFF B                              ;no error
                                                              ;Print ready message
003721 003721 CE 38 FA                                        LDX     #BOOTLOADER_MSG_READY           ;message pointer -> X
003724 003724 MACRO                                           STRING_PRINT_BL                         ;print message
                                      ;#Basic print function - blocking                                                (STRING_PRINT_BL)
                                      ; args:   X:      start of the string                                            (STRING_PRINT_BL)
                                      ; result: X;      points to the byte after the string                            (STRING_PRINT_BL)
                                      ; SSTACK: 10 bytes                                                               (STRING_PRINT_BL)
                                      ;         Y and D are preserved                                                  (STRING_PRINT_BL)
003724 003724 MACRO                                           SSTACK_JOBSR    STRING_PRINT_BL, 10                      (STRING_PRINT_BL)
                                      ;#Check stack and call subroutine                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (STRING_PRINT_BL/SSTACK_JOBSR)
003724 003724 16 15 E5                                        JOBSR   STRING_PRINT_BL                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                                              ;Wait for transmission
003727 003727 MACRO                                           SCI_RX_READY_BL
                                      ;#Wait until there is data in the RX queue                                       (SCI_RX_READY_BL)
                                      ; args:   none                                                                   (SCI_RX_READY_BL)
                                      ; result: none                                                                   (SCI_RX_READY_BL)
                                      ; SSTACK: 7 bytes                                                                (SCI_RX_READY_BL)
                                      ;         X, Y and B are preserved                                               (SCI_RX_READY_BL)
003727 003727 MACRO                                           SSTACK_JOBSR    SCI_RX_READY_BL, 7                       (SCI_RX_READY_BL)
                                      ;#Check stack and call subroutine                                                (SCI_RX_READY_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SCI_RX_READY_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SCI_RX_READY_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SCI_RX_READY_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SCI_RX_READY_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SCI_RX_READY_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SCI_RX_READY_BL/SSTACK_JOBSR)
003727 003727 16 14 D0                                        JOBSR   SCI_RX_READY_BL                                  (SCI_RX_READY_BL/SSTACK_JOBSR)
                                                              ;Indicate ongoing firmware transmission
00372A 00372A -> $372A                BOOTLOADER_SHOW_BUSY    EQU     *
                                                              ;Set LEDs
                                                              ;LED_OFF A                              ;not busy anymore
                                                              ;LED_OFF B                              ;no error
                                                              ;Update display
00372A 00372A MACRO                                           DISP_STREAM_FROM_TO_BL  IMG_SEQ_BUSY_START, IMG_SEQ_BUSY_END
                                      ;#Transmit a sequence of commands and data (non-blocking)                        (DISP_STREAM_FROM_TO_BL)
                                      ; args:   1: pointer to the start of the sequence                                (DISP_STREAM_FROM_TO_BL)
                                      ;         2: pointer past the end of the sequence                                (DISP_STREAM_FROM_TO_BL)
                                      ; result: none                                                                   (DISP_STREAM_FROM_TO_BL)
                                      ; SSTACK: 11 bytes                                                               (DISP_STREAM_FROM_TO_BL)
                                      ;         Y is preserved                                                         (DISP_STREAM_FROM_TO_BL)
00372A 00372A CE 3C 02                                        LDX     #IMG_SEQ_BUSY_START                              (DISP_STREAM_FROM_TO_BL)
00372D 00372D CC 3C 68                                        LDD     #IMG_SEQ_BUSY_END                                (DISP_STREAM_FROM_TO_BL)
003730 003730 MACRO                                           DISP_STREAM_BL                                           (DISP_STREAM_FROM_TO_BL)
                                      ;#Transmit a sequence of commands and data (non-blocking)                        (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; args:   X: pointer to the start of the sequence                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;         D: pointer to the end of the sequence                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; result: X: points to the byte after the sequence                               (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; SSTACK: 11 bytes                                                               (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;         Y and D are preserved                                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
003730 003730 MACRO                                           SSTACK_JOBSR    DISP_STREAM_BL, 11                       (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;#Check stack and call subroutine                                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
003730 003730 16 37 DA                                        JOBSR   DISP_STREAM_BL                                   (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                                              ;Execute from RAM
003733 003733 06 14 0F                                        JMP     START_OF_RAM_CODE               ;run LRE code
                                                              ;Check for errors (error code in A)
003736 003736 CD 38 69                BOOTLOADER_DONE         LDY     #(BOOTLOADER_ERR_TAB-2)         ;initialize table pointer
003739 003739 19 42                   BOOTLOADER_DONE_1       LEAY    2,Y                             ;advance table pointer
00373B 00373B 48                                              LSLA                                    ;check next errr bit
00373C 00373C 25 19                                           BCS     BOOTLOADER_DONE_3               ;cause found
00373E 00373E 26 F9                                           BNE     BOOTLOADER_DONE_1               ;check next bit
                                                              ;Indicate successful firmware update
                                                              ;Set LEDs
003740 003740 MACRO                                           LED_OFF A                               ;not busy anymore
                                      ;#Turn off non-blinking LED                                                      (LED_OFF)
                                      ; args:   1: LED index (A..D)                                                    (LED_OFF)
                                      ; result: none                                                                   (LED_OFF)
                                      ; SSTACK: none                                                                   (LED_OFF)
                                      ;         X, Y and D are preserved                                               (LED_OFF)
003740 003740 4C 08 01                                        BSET    LED_A_PORT, #LED_A_PIN        ;set port pin      (LED_OFF)
                                                              ;LED_OFF B                              ;no error
                                                              ;Print message
003743 003743 CE 39 16                                        LDX     #BOOTLOADER_MSG_DONE            ;message pointer -> X
003746 003746 MACRO                                           STRING_PRINT_BL                         ;print message
                                      ;#Basic print function - blocking                                                (STRING_PRINT_BL)
                                      ; args:   X:      start of the string                                            (STRING_PRINT_BL)
                                      ; result: X;      points to the byte after the string                            (STRING_PRINT_BL)
                                      ; SSTACK: 10 bytes                                                               (STRING_PRINT_BL)
                                      ;         Y and D are preserved                                                  (STRING_PRINT_BL)
003746 003746 MACRO                                           SSTACK_JOBSR    STRING_PRINT_BL, 10                      (STRING_PRINT_BL)
                                      ;#Check stack and call subroutine                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (STRING_PRINT_BL/SSTACK_JOBSR)
003746 003746 16 15 E5                                        JOBSR   STRING_PRINT_BL                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                                              ;Update display
003749 003749 MACRO                                           DISP_STREAM_FROM_TO_BL  IMG_SEQ_DONE_START, IMG_SEQ_DONE_END
                                      ;#Transmit a sequence of commands and data (non-blocking)                        (DISP_STREAM_FROM_TO_BL)
                                      ; args:   1: pointer to the start of the sequence                                (DISP_STREAM_FROM_TO_BL)
                                      ;         2: pointer past the end of the sequence                                (DISP_STREAM_FROM_TO_BL)
                                      ; result: none                                                                   (DISP_STREAM_FROM_TO_BL)
                                      ; SSTACK: 11 bytes                                                               (DISP_STREAM_FROM_TO_BL)
                                      ;         Y is preserved                                                         (DISP_STREAM_FROM_TO_BL)
003749 003749 CE 3C 68                                        LDX     #IMG_SEQ_DONE_START                              (DISP_STREAM_FROM_TO_BL)
00374C 00374C CC 3C D0                                        LDD     #IMG_SEQ_DONE_END                                (DISP_STREAM_FROM_TO_BL)
00374F 00374F MACRO                                           DISP_STREAM_BL                                           (DISP_STREAM_FROM_TO_BL)
                                      ;#Transmit a sequence of commands and data (non-blocking)                        (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; args:   X: pointer to the start of the sequence                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;         D: pointer to the end of the sequence                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; result: X: points to the byte after the sequence                               (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; SSTACK: 11 bytes                                                               (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;         Y and D are preserved                                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
00374F 00374F MACRO                                           SSTACK_JOBSR    DISP_STREAM_BL, 11                       (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;#Check stack and call subroutine                                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
00374F 00374F 16 37 DA                                        JOBSR   DISP_STREAM_BL                                   (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                                              ;Read loop
003752 003752 MACRO                   BOOTLOADER_DONE_2       SCI_RX_BL                               ;ignore incoming data
                                      ;#Receive one byte - blocking                                                    (SCI_RX_BL)
                                      ; args:   none                                                                   (SCI_RX_BL)
                                      ; result: A: error flags                                                         (SCI_RX_BL)
                                      ;         B: received data                                                       (SCI_RX_BL)
                                      ; SSTACK: 7 bytes                                                                (SCI_RX_BL)
                                      ;         X and Y are preserved                                                  (SCI_RX_BL)
003752 003752 MACRO                                           SSTACK_JOBSR    SCI_RX_BL, 6                             (SCI_RX_BL)
                                      ;#Check stack and call subroutine                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SCI_RX_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SCI_RX_BL/SSTACK_JOBSR)
003752 003752 16 14 B2                                        JOBSR   SCI_RX_BL                                        (SCI_RX_BL/SSTACK_JOBSR)
003755 003755 20 FB                                           JOB     BOOTLOADER_DONE_2
                                                              ;Indicate failed firmware update (error message in Y)
003757 003757 MACRO                   BOOTLOADER_DONE_3       NVM_STOP                                ;stop the NVM
                                      ;#Stop NVM activity                                                              (NVM_STOP)
                                      ; args:   none                                                                   (NVM_STOP)
                                      ; result: none                                                                   (NVM_STOP)
                                      ; SSTACK:  0 bytes                                                               (NVM_STOP)
                                      ;         All registers are preserved                                            (NVM_STOP)
003757 003757 1D 01 06 80                                     BCLR    FSTAT,#CCIF                                      (NVM_STOP)
00375B 00375B 18 0C 1A AF 1A AE                               MOVB    NVM_BUF_OUT, NVM_BUF_IN                          (NVM_STOP)
003761 003761 CE 39 1D                                        LDX     #BOOTLOADER_MSG_ERROR           ;message pointer -> X
003764 003764 MACRO                                           STRING_PRINT_BL                         ;print message
                                      ;#Basic print function - blocking                                                (STRING_PRINT_BL)
                                      ; args:   X:      start of the string                                            (STRING_PRINT_BL)
                                      ; result: X;      points to the byte after the string                            (STRING_PRINT_BL)
                                      ; SSTACK: 10 bytes                                                               (STRING_PRINT_BL)
                                      ;         Y and D are preserved                                                  (STRING_PRINT_BL)
003764 003764 MACRO                                           SSTACK_JOBSR    STRING_PRINT_BL, 10                      (STRING_PRINT_BL)
                                      ;#Check stack and call subroutine                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (STRING_PRINT_BL/SSTACK_JOBSR)
003764 003764 16 15 E5                                        JOBSR   STRING_PRINT_BL                                  (STRING_PRINT_BL/SSTACK_JOBSR)
003767 003767 EE 40                                           LDX     0,Y                             ;message pointer -> X
003769 003769 MACRO                                           STRING_PRINT_BL                         ;print message
                                      ;#Basic print function - blocking                                                (STRING_PRINT_BL)
                                      ; args:   X:      start of the string                                            (STRING_PRINT_BL)
                                      ; result: X;      points to the byte after the string                            (STRING_PRINT_BL)
                                      ; SSTACK: 10 bytes                                                               (STRING_PRINT_BL)
                                      ;         Y and D are preserved                                                  (STRING_PRINT_BL)
003769 003769 MACRO                                           SSTACK_JOBSR    STRING_PRINT_BL, 10                      (STRING_PRINT_BL)
                                      ;#Check stack and call subroutine                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (STRING_PRINT_BL/SSTACK_JOBSR)
003769 003769 16 15 E5                                        JOBSR   STRING_PRINT_BL                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                                              ;Set LEDs
00376C 00376C MACRO                                           LED_OFF A                               ;not busy anymore
                                      ;#Turn off non-blinking LED                                                      (LED_OFF)
                                      ; args:   1: LED index (A..D)                                                    (LED_OFF)
                                      ; result: none                                                                   (LED_OFF)
                                      ; SSTACK: none                                                                   (LED_OFF)
                                      ;         X, Y and D are preserved                                               (LED_OFF)
00376C 00376C 4C 08 01                                        BSET    LED_A_PORT, #LED_A_PIN        ;set port pin      (LED_OFF)
00376F 00376F MACRO                                           LED_ON  B                               ;flag error
                                      ;#User functions                                                                 (LED_ON)
                                      ;#--------------                                                                 (LED_ON)
                                      ;#Turn on non-blinking LED                                                       (LED_ON)
                                      ; args:   1: LED index (A..D)                                                    (LED_ON)
                                      ; result: none                                                                   (LED_ON)
                                      ; SSTACK: none                                                                   (LED_ON)
                                      ;         X,Y and D are preserved                                                (LED_ON)
00376F 00376F 4D 08 02                                        BCLR    LED_B_PORT, #LED_B_PIN        ;clear port pin    (LED_ON)
                                                              ;Update display
003772 003772 MACRO                                           DISP_STREAM_FROM_TO_BL  IMG_SEQ_ERROR_START, IMG_SEQ_ERROR_END
                                      ;#Transmit a sequence of commands and data (non-blocking)                        (DISP_STREAM_FROM_TO_BL)
                                      ; args:   1: pointer to the start of the sequence                                (DISP_STREAM_FROM_TO_BL)
                                      ;         2: pointer past the end of the sequence                                (DISP_STREAM_FROM_TO_BL)
                                      ; result: none                                                                   (DISP_STREAM_FROM_TO_BL)
                                      ; SSTACK: 11 bytes                                                               (DISP_STREAM_FROM_TO_BL)
                                      ;         Y is preserved                                                         (DISP_STREAM_FROM_TO_BL)
003772 003772 CE 3C D0                                        LDX     #IMG_SEQ_ERROR_START                             (DISP_STREAM_FROM_TO_BL)
003775 003775 CC 3D 32                                        LDD     #IMG_SEQ_ERROR_END                               (DISP_STREAM_FROM_TO_BL)
003778 003778 MACRO                                           DISP_STREAM_BL                                           (DISP_STREAM_FROM_TO_BL)
                                      ;#Transmit a sequence of commands and data (non-blocking)                        (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; args:   X: pointer to the start of the sequence                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;         D: pointer to the end of the sequence                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; result: X: points to the byte after the sequence                               (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ; SSTACK: 11 bytes                                                               (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;         Y and D are preserved                                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
003778 003778 MACRO                                           SSTACK_JOBSR    DISP_STREAM_BL, 11                       (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL)
                                      ;#Check stack and call subroutine                                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
003778 003778 07 60                                           JOBSR   DISP_STREAM_BL                                   (DISP_STREAM_FROM_TO_BL/DISP_STREAM_BL/SSTACK_JOBSR)
00377A 00377A 20 D6                                           JOB     BOOTLOADER_DONE_2
                                                              ;Unexpected interrupt request
00377C 00377C 86 01                   BOOTLOADER_ISR_ERROR    LDAA    #BOOTLOADER_ERR_UNKNOWN                 ;unknown error -> A
00377E 00377E 1B 89                                           LEAS    9,SP                                    ;free stack space
003780 003780 10 EF                                           CLI                                             ;enable interrupts
003782 003782 20 B2                                           JOB     BOOTLOADER_DONE                         ;handle errors
003784 003784 -> $3784                MMAP_CODE_START         EQU     *
003784 003784 -> $3784                MMAP_CODE_START_LIN     EQU     @
003784 003784                                                 ORG     MMAP_CODE_END, MMAP_CODE_END_LIN
003784 003784 -> $3784                GPIO_CODE_START         EQU     *
003784 003784 -> $3784                GPIO_CODE_START_LIN     EQU     @
003784 003784                                                 ORG     GPIO_CODE_END, GPIO_CODE_END_LIN
003784 003784 -> $3784                RESET_CODE_START        EQU     *
003784 003784 -> $3784                RESET_CODE_START_LIN    EQU     @
003796 003796                                                 ORG     RESET_CODE_END, RESET_CODE_END_LIN
003796 003796 -> $3796                CLOCK_CODE_START        EQU     *
003796 003796 -> $3796                CLOCK_CODE_START_LIN    EQU     @
003796 003796                                                 ORG     CLOCK_CODE_END, CLOCK_CODE_END_LIN
003796 003796 -> $3796                LRE_CODE_START          EQU     *
003796 003796 -> $3796                LRE_CODE_START_LIN      EQU     @
003796 003796                                                 ORG     LRE_CODE_END, LRE_CODE_END_LIN
003796 003796 -> $3796                TIM_CODE_START          EQU     *
003796 003796 -> $3796                TIM_CODE_START_LIN      EQU     @
003796 003796                                                 ORG     TIM_CODE_END, TIM_CODE_END_LIN
003796 003796 -> $3796                DISP_CODE_START         EQU     *
003796 003796 -> $3796                DISP_CODE_START_LIN     EQU     @
00386B 00386B                                                 ORG     DISP_CODE_END, DISP_CODE_END_LIN
00386B 00386B -> $386B                LED_CODE_START          EQU     *
00386B 00386B -> $386B                LED_CODE_START_LIN      EQU     @
00386B 00386B                                                 ORG     LED_CODE_END, LED_CODE_END_LIN
00386B 00386B -> $386B                IMG_CODE_START          EQU     *
00386B 00386B -> $386B                IMG_CODE_START_LIN      EQU     @
00386B 00386B                                                 ORG     IMG_CODE_END, IMG_CODE_END_LIN
00386B 00386B -> $386B                CODE_END                EQU     *
00386B 00386B -> $386B                CODE_END_LIN            EQU     @
                                      ;###############################################################################
                                      ;# RAM code space                                                              #
                                      ;###############################################################################
00140F 00300F                                                 ORG     RAM_CODE_START, RAM_CODE_START_LIN
00140F 00300F -> $140F                START_OF_RAM_CODE       EQU     *
                                                              ;Parse incoming S-records
00140F 00300F MACRO                                           SREC_PARSE_SREC
                                      ;#Parse S-Records - blocking                                                     (SREC_PARSE_SREC)
                                      ; args:   none                                                                   (SREC_PARSE_SREC)
                                      ; result: A:      error code                                                     (SREC_PARSE_SREC)
                                      ; SSTACK: 21 bytes                                                               (SREC_PARSE_SREC)
                                      ;         B, X and Y are preserved                                               (SREC_PARSE_SREC)
00140F 00300F MACRO                                           SSTACK_JOBSR    SREC_PARSE_SREC, 21                      (SREC_PARSE_SREC)
                                      ;#Check stack and call subroutine                                                (SREC_PARSE_SREC/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_PARSE_SREC/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_PARSE_SREC/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_PARSE_SREC/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_PARSE_SREC/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_PARSE_SREC/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_PARSE_SREC/SSTACK_JOBSR)
00140F 00300F 16 17 8E                                        JOBSR   SREC_PARSE_SREC                                  (SREC_PARSE_SREC/SSTACK_JOBSR)
                                                              ;Wait for NVM (error code in A)
001412 003012 MACRO                                           NVM_WAIT_IDLE                           ;wait for FTMRG to become idle
                                      ;#Wait until the FTMRG wrapper is idle                                           (NVM_WAIT_IDLE)
                                      ; args:   none                                                                   (NVM_WAIT_IDLE)
                                      ; result: none                                                                   (NVM_WAIT_IDLE)
                                      ; SSTACK:  0 bytes                                                               (NVM_WAIT_IDLE)
                                      ;         All registers are preserved                                            (NVM_WAIT_IDLE)
001412 003012 1F 01 06 80 FB                                  BRCLR   FSTAT,#CCIF,*                                    (NVM_WAIT_IDLE)
001417 003017 06 37 36                                        JOB     BOOTLOADER_DONE                 ;show result
00141A 00301A -> $141A                VECTAB_CODE_START       EQU     *
00141A 00301A -> $301A                VECTAB_CODE_START_LIN   EQU     @
00141A 00301A                                                 ORG     VECTAB_CODE_END, VECTAB_CODE_END_LIN
00141A 00301A -> $141A                SSTACK_CODE_START       EQU     *
00141A 00301A -> $301A                SSTACK_CODE_START_LIN   EQU     @
00141A 00301A                                                 ORG     SSTACK_CODE_END, SSTACK_CODE_END_LIN
00141A 00301A -> $141A                ISTACK_CODE_START       EQU     *
00141A 00301A -> $301A                ISTACK_CODE_START_LIN   EQU     @
00141A 00301A                                                 ORG     ISTACK_CODE_END, ISTACK_CODE_END_LIN
00141A 00301A -> $141A                SCI_CODE_START          EQU     *
00141A 00301A -> $301A                SCI_CODE_START_LIN      EQU     @
0015CB 0031CB                                                 ORG     SCI_CODE_END, SCI_CODE_END_LIN
0015CB 0031CB -> $15CB                STRING_CODE_START       EQU     *
0015CB 0031CB -> $31CB                STRING_CODE_START_LIN   EQU     @
0015FD 0031FD                                                 ORG     STRING_CODE_END, STRING_CODE_END_LIN
0015FD 0031FD -> $15FD                NVM_CODE_START          EQU     *
0015FD 0031FD -> $31FD                NVM_CODE_START_LIN      EQU     @
00178E 00338E                                                 ORG     NVM_CODE_END, NVM_CODE_END_LIN
00178E 00338E -> $178E                SREC_CODE_START         EQU     *
00178E 00338E -> $338E                SREC_CODE_START_LIN     EQU     @
00198B 00358B                                                 ORG     SREC_CODE_END, SREC_CODE_END_LIN
00198B 00358B -> $198B                RAM_CODE_END            EQU     *
00198B 00358B -> $358B                RAM_CODE_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Table space                                                                 #
                                      ;###############################################################################
00386B 00386B                                                 ORG     TABS_START, TABS_START_LIN
00386B 00386B 38 7B                   BOOTLOADER_ERR_TAB      DW      BOOTLOADER_MSG_RX
00386D 00386D 38 90                                           DW      BOOTLOADER_MSG_FORMAT
00386F 00386F 38 A6                                           DW      BOOTLOADER_MSG_CHECKSUM
003871 003871 38 B9                                           DW      BOOTLOADER_MSG_COUNT
003873 003873 38 CE                                           DW      BOOTLOADER_MSG_ADDR
003875 003875 38 DC                                           DW      BOOTLOADER_MSG_HW
003877 003877 38 EC                                           DW      BOOTLOADER_MSG_UNKNOWN
003879 003879 38 EC                                           DW      BOOTLOADER_MSG_UNKNOWN
00387B 00387B 42 72 6F 6B 65 6E 20 64 BOOTLOADER_MSG_RX       FCS     "Broken data transfer!"
              61 74 61 20 74 72 61 6E 
              73 66 65 72 A1          
003890 003890 57 72 6F 6E 67 20 53 2D BOOTLOADER_MSG_FORMAT   FCS     "Wrong S-record format!"
              72 65 63 6F 72 64 20 66 
              6F 72 6D 61 74 A1       
0038A6 0038A6 49 6E 63 6F 72 72 65 63 BOOTLOADER_MSG_CHECKSUM FCS     "Incorrect checksum!"
              74 20 63 68 65 63 6B 73 
              75 6D A1                
0038B9 0038B9 57 72 6F 6E 67 20 53 2D BOOTLOADER_MSG_COUNT    FCS     "Wrong S-record count!"
              72 65 63 6F 72 64 20 63 
              6F 75 6E 74 A1          
0038CE 0038CE 57 72 6F 6E 67 20 61 64 BOOTLOADER_MSG_ADDR     FCS     "Wrong address!"
              64 72 65 73 73 A1       
0038DC 0038DC 48 61 72 64 77 61 72 65 BOOTLOADER_MSG_HW       FCS     "Hardware failur!"
              20 66 61 69 6C 75 72 A1 
0038EC 0038EC 55 6E 6B 6E 6F 77 6E 20 BOOTLOADER_MSG_UNKNOWN  FCS     "Unknown cause!"
              63 61 75 73 65 A1       
0038FA 0038FA MACRO                   BOOTLOADER_MSG_READY    STRING_NL_NONTERM
                                      ;#Non-terminated line break                                                      (STRING_NL_NONTERM)
0038FA 0038FA 0D                                              DB      STRING_NL_1ST                                    (STRING_NL_NONTERM)
0038FB 0038FB 0A                                              DB      STRING_NL_2ND                                    (STRING_NL_NONTERM)
0038FC 0038FC 52 65 61 64 79 20 74 6F                         FCS     "Ready to receive S-record!"
              20 72 65 63 65 69 76 65 
              20 53 2D 72 65 63 6F 72 
              64 A1                   
003916 003916 MACRO                   BOOTLOADER_MSG_DONE     STRING_NL_NONTERM
                                      ;#Non-terminated line break                                                      (STRING_NL_NONTERM)
003916 003916 0D                                              DB      STRING_NL_1ST                                    (STRING_NL_NONTERM)
003917 003917 0A                                              DB      STRING_NL_2ND                                    (STRING_NL_NONTERM)
003918 003918 44 6F 6E 65 A1                                  FCS     "Done!"
00391D 00391D MACRO                   BOOTLOADER_MSG_ERROR    STRING_NL_NONTERM
                                      ;#Non-terminated line break                                                      (STRING_NL_NONTERM)
00391D 00391D 0D                                              DB      STRING_NL_1ST                                    (STRING_NL_NONTERM)
00391E 00391E 0A                                              DB      STRING_NL_2ND                                    (STRING_NL_NONTERM)
00391F 00391F 45 72 72 6F 72 21 A0                            FCS     "Error! "
003926 003926 -> $3926                MMAP_TABS_START         EQU     *
003926 003926 -> $3926                MMAP_TABS_START_LIN     EQU     @
003926 003926                                                 ORG     MMAP_TABS_END, MMAP_TABS_END_LIN
003926 003926 -> $3926                GPIO_TABS_START         EQU     *
003926 003926 -> $3926                GPIO_TABS_START_LIN     EQU     @
003926 003926                                                 ORG     GPIO_TABS_END, GPIO_TABS_END_LIN
003926 003926 -> $3926                RESET_TABS_START        EQU     *
003926 003926 -> $3926                RESET_TABS_START_LIN    EQU     @
003926 003926                                                 ORG     RESET_TABS_END, RESET_TABS_END_LIN
003926 003926 -> $3926                CLOCK_TABS_START        EQU     *
003926 003926 -> $3926                CLOCK_TABS_START_LIN    EQU     @
003926 003926                                                 ORG     CLOCK_TABS_END, CLOCK_TABS_END_LIN
003926 003926 -> $3926                LRE_TABS_START          EQU     *
003926 003926 -> $3926                LRE_TABS_START_LIN      EQU     @
003926 003926                                                 ORG     LRE_TABS_END, LRE_TABS_END_LIN
003926 003926 -> $3926                TIM_TABS_START          EQU     *
003926 003926 -> $3926                TIM_TABS_START_LIN      EQU     @
003926 003926                                                 ORG     TIM_TABS_END, TIM_TABS_END_LIN
003926 003926 -> $3926                DISP_TABS_START         EQU     *
003926 003926 -> $3926                DISP_TABS_START_LIN     EQU     @
003926 003926                                                 ORG     DISP_TABS_END, DISP_TABS_END_LIN
003926 003926 -> $3926                LED_TABS_START          EQU     *
003926 003926 -> $3926                LED_TABS_START_LIN      EQU     @
003926 003926                                                 ORG     LED_TABS_END, LED_TABS_END_LIN
003926 003926 -> $3926                IMG_TABS_START          EQU     *
003926 003926 -> $3926                IMG_TABS_START_LIN      EQU     @
003D32 003D32                                                 ORG     IMG_TABS_END, IMG_TABS_END_LIN
003D32 003D32 -> $3D32                TABS_END                EQU     *
003D32 003D32 -> $3D32                TABS_END_LIN            EQU     @
                                      ;###############################################################################
                                      ;# RAM table space                                                             #
                                      ;###############################################################################
001400 003000                                                 ORG     RAM_TABS_START, RAM_TABS_START_LIN
001400 003000 -> $1400                VECTAB_TABS_START       EQU     *
001400 003000 -> $3000                VECTAB_TABS_START_LIN   EQU     @
001400 003000                                                 ORG     VECTAB_TABS_END, VECTAB_TABS_END_LIN
001400 003000 -> $1400                SSTACK_TABS_START       EQU     *
001400 003000 -> $3000                SSTACK_TABS_START_LIN   EQU     @
001400 003000                                                 ORG     SSTACK_TABS_END, SSTACK_TABS_END_LIN
001400 003000 -> $1400                ISTACK_TABS_START       EQU     *
001400 003000 -> $3000                ISTACK_TABS_START_LIN   EQU     @
001400 003000                                                 ORG     ISTACK_TABS_END, ISTACK_TABS_END_LIN
001400 003000 -> $1400                SCI_TABS_START          EQU     *
001400 003000 -> $3000                SCI_TABS_START_LIN      EQU     @
001400 003000                                                 ORG     SCI_TABS_END, SCI_TABS_END_LIN
001400 003000 -> $1400                STRING_TABS_START       EQU     *
001400 003000 -> $3000                STRING_TABS_START_LIN   EQU     @
001402 003002                                                 ORG     STRING_TABS_END, STRING_TABS_END_LIN
001402 003002 -> $1402                NVM_TABS_START          EQU     *
001402 003002 -> $3002                NVM_TABS_START_LIN      EQU     @
001402 003002                                                 ORG     NVM_TABS_END, NVM_TABS_END_LIN
001402 003002 -> $1402                SREC_TABS_START         EQU     *
001402 003002 -> $3002                SREC_TABS_START_LIN     EQU     @
00140F 00300F                                                 ORG     SREC_TABS_END, SREC_TABS_END_LIN
00140F 00300F -> $140F                RAM_TABS_END            EQU     *
00140F 00300F -> $300F                RAM_TABS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# S12CBase - REGDEF - Register Definitions (S12G-Micro-EVB)                   #
                                      ;###############################################################################
                                      ;#    Copyright 2010-2016 Dirk Heisswolf                                       #
                                      ;#    This file is part of the S12CBase framework for NXP's S12C MCU family.   #
                                      ;#                                                                             #
                                      ;#    S12CBase is free software: you can redistribute it and/or modify         #
                                      ;#    it under the terms of the GNU General Public License as published by     #
                                      ;#    the Free Software Foundation, either version 3 of the License, or        #
                                      ;#    (at your option) any later version.                                      #
                                      ;#                                                                             #
                                      ;#    S12CBase is distributed in the hope that it will be useful,              #
                                      ;#    but WITHOUT ANY WARRANTY; without even the implied warranty of           #
                                      ;#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            #
                                      ;#    GNU General Public License for more details.                             #
                                      ;#                                                                             #
                                      ;#    You should have received a copy of the GNU General Public License        #
                                      ;#    along with S12CBase.  If not, see <http://www.gnu.org/licenses/>.        #
                                      ;###############################################################################
                                      ;# Description:                                                                #
                                      ;#    This module defines the register map of the S12G-family.                 #
                                      ;###############################################################################
                                      ;# Required Modules:                                                           #
                                      ;#    - none                                                                   #
                                      ;#                                                                             #
                                      ;# Requirements to Software Using this Module:                                 #
                                      ;#    - none                                                                   #
                                      ;###############################################################################
                                      ;# Version History:                                                            #
                                      ;#    Apr 1, 2010                                                              #
                                      ;#      - Initial release                                                      #
                                      ;###############################################################################
                                      ;#############################
                                      ;# S12G Register Definitions #
                                      ;#############################
00140F 00300F -> $0000                PORTA           EQU     $0000
00140F 00300F -> $0080                PTA7            EQU     $80
00140F 00300F -> $0040                PTA6            EQU     $40
00140F 00300F -> $0020                PTA5            EQU     $20
00140F 00300F -> $0010                PTA4            EQU     $10
00140F 00300F -> $0008                PTA3            EQU     $08
00140F 00300F -> $0004                PTA2            EQU     $04
00140F 00300F -> $0002                PTA1            EQU     $02
00140F 00300F -> $0001                PTA0            EQU     $01
00140F 00300F -> $0080                PA7             EQU     $80
00140F 00300F -> $0040                PA6             EQU     $40
00140F 00300F -> $0020                PA5             EQU     $20
00140F 00300F -> $0010                PA4             EQU     $10
00140F 00300F -> $0008                PA3             EQU     $08
00140F 00300F -> $0004                PA2             EQU     $04
00140F 00300F -> $0002                PA1             EQU     $02
00140F 00300F -> $0001                PA0             EQU     $01
00140F 00300F -> $0001                PORTB           EQU     $0001
00140F 00300F -> $0080                PTB7            EQU     $80
00140F 00300F -> $0040                PTB6            EQU     $40
00140F 00300F -> $0020                PTB5            EQU     $20
00140F 00300F -> $0010                PTB4            EQU     $10
00140F 00300F -> $0008                PTB3            EQU     $08
00140F 00300F -> $0004                PTB2            EQU     $04
00140F 00300F -> $0002                PTB1            EQU     $02
00140F 00300F -> $0001                PTB0            EQU     $01
00140F 00300F -> $0080                PB7             EQU     $80
00140F 00300F -> $0040                PB6             EQU     $40
00140F 00300F -> $0020                PB5             EQU     $20
00140F 00300F -> $0010                PB4             EQU     $10
00140F 00300F -> $0008                PB3             EQU     $08
00140F 00300F -> $0004                PB2             EQU     $04
00140F 00300F -> $0002                PB1             EQU     $02
00140F 00300F -> $0001                PB0             EQU     $01
00140F 00300F -> $0002                DDRA            EQU     $0002
00140F 00300F -> $0080                DDRA7           EQU     $80
00140F 00300F -> $0040                DDRA6           EQU     $40
00140F 00300F -> $0020                DDRA5           EQU     $20
00140F 00300F -> $0010                DDRA4           EQU     $10
00140F 00300F -> $0008                DDRA3           EQU     $08
00140F 00300F -> $0004                DDRA2           EQU     $04
00140F 00300F -> $0002                DDRA1           EQU     $02
00140F 00300F -> $0001                DDRA0           EQU     $01
00140F 00300F -> $0003                DDRB            EQU     $0003
00140F 00300F -> $0080                DDRB7           EQU     $80
00140F 00300F -> $0040                DDRB6           EQU     $40
00140F 00300F -> $0020                DDRB5           EQU     $20
00140F 00300F -> $0010                DDRB4           EQU     $10
00140F 00300F -> $0008                DDRB3           EQU     $08
00140F 00300F -> $0004                DDRB2           EQU     $04
00140F 00300F -> $0002                DDRB1           EQU     $02
00140F 00300F -> $0001                DDRB0           EQU     $01
00140F 00300F -> $0004                PORTC           EQU     $0004
00140F 00300F -> $0080                PTC7            EQU     $80
00140F 00300F -> $0040                PTC6            EQU     $40
00140F 00300F -> $0020                PTC5            EQU     $20
00140F 00300F -> $0010                PTC4            EQU     $10
00140F 00300F -> $0008                PTC3            EQU     $08
00140F 00300F -> $0004                PTC2            EQU     $04
00140F 00300F -> $0002                PTC1            EQU     $02
00140F 00300F -> $0001                PTC0            EQU     $01
00140F 00300F -> $0080                PC7             EQU     $80
00140F 00300F -> $0040                PC6             EQU     $40
00140F 00300F -> $0020                PC5             EQU     $20
00140F 00300F -> $0010                PC4             EQU     $10
00140F 00300F -> $0008                PC3             EQU     $08
00140F 00300F -> $0004                PC2             EQU     $04
00140F 00300F -> $0002                PC1             EQU     $02
00140F 00300F -> $0001                PC0             EQU     $01
00140F 00300F -> $0005                PORTD           EQU     $0005
00140F 00300F -> $0080                PTD7            EQU     $80
00140F 00300F -> $0040                PTD6            EQU     $40
00140F 00300F -> $0020                PTD5            EQU     $20
00140F 00300F -> $0010                PTD4            EQU     $10
00140F 00300F -> $0008                PTD3            EQU     $08
00140F 00300F -> $0004                PTD2            EQU     $04
00140F 00300F -> $0002                PTD1            EQU     $02
00140F 00300F -> $0001                PTD0            EQU     $01
00140F 00300F -> $0080                PD7             EQU     $80
00140F 00300F -> $0040                PD6             EQU     $40
00140F 00300F -> $0020                PD5             EQU     $20
00140F 00300F -> $0010                PD4             EQU     $10
00140F 00300F -> $0008                PD3             EQU     $08
00140F 00300F -> $0004                PD2             EQU     $04
00140F 00300F -> $0002                PD1             EQU     $02
00140F 00300F -> $0001                PD0             EQU     $01
00140F 00300F -> $0006                DDRC            EQU     $0006
00140F 00300F -> $0080                DDRC7           EQU     $80
00140F 00300F -> $0040                DDRC6           EQU     $40
00140F 00300F -> $0020                DDRC5           EQU     $20
00140F 00300F -> $0010                DDRC4           EQU     $10
00140F 00300F -> $0008                DDRC3           EQU     $08
00140F 00300F -> $0004                DDRC2           EQU     $04
00140F 00300F -> $0007                DDRD            EQU     $0007
00140F 00300F -> $0080                DDRD7           EQU     $80
00140F 00300F -> $0040                DDRD6           EQU     $40
00140F 00300F -> $0020                DDRD5           EQU     $20
00140F 00300F -> $0010                DDRD4           EQU     $10
00140F 00300F -> $0008                DDRD3           EQU     $08
00140F 00300F -> $0004                DDRD2           EQU     $04
00140F 00300F -> $0008                PORTE           EQU     $0008
00140F 00300F -> $0002                PTE1            EQU     $02
00140F 00300F -> $0001                PTE0            EQU     $01
00140F 00300F -> $0002                PE1             EQU     $02
00140F 00300F -> $0001                PE0             EQU     $01
00140F 00300F -> $0009                DDRE            EQU     $0009
00140F 00300F -> $0002                DDRE1           EQU     $02
00140F 00300F -> $0001                DDRE0           EQU     $01
00140F 00300F -> $000B                MODE            EQU     $000B
00140F 00300F -> $0080                MODC            EQU     $80
00140F 00300F -> $000C                PUCR            EQU     $000C
00140F 00300F -> $0040                BKPUE           EQU     $40
00140F 00300F -> $0010                PUPEE           EQU     $10
00140F 00300F -> $0008                PUPDE           EQU     $08
00140F 00300F -> $0004                PUPCE           EQU     $04
00140F 00300F -> $0002                PUPBE           EQU     $02
00140F 00300F -> $0001                PUPAE           EQU     $01
00140F 00300F -> $0011                DIRECT          EQU     $0011
00140F 00300F -> $0080                DP15            EQU     $80
00140F 00300F -> $0040                DP14            EQU     $40
00140F 00300F -> $0020                DP13            EQU     $20
00140F 00300F -> $0010                DP12            EQU     $10
00140F 00300F -> $0008                DP11            EQU     $08
00140F 00300F -> $0004                DP10            EQU     $04
00140F 00300F -> $0002                DP9             EQU     $02
00140F 00300F -> $0001                DP8             EQU     $01
00140F 00300F -> $0013                MMCCTL          EQU     $0013
00140F 00300F -> $0001                NVMRES           EQU     $01
00140F 00300F -> $0015                PPAGE           EQU     $0015
00140F 00300F -> $0008                PIX3            EQU     $08
00140F 00300F -> $0004                PIX2            EQU     $04
00140F 00300F -> $0002                PIX1            EQU     $02
00140F 00300F -> $0001                PIX0            EQU     $01
00140F 00300F -> $001A                PARTIDH         EQU     $001A
00140F 00300F -> $0080                ID15            EQU     $80
00140F 00300F -> $0040                ID14            EQU     $40
00140F 00300F -> $0020                ID13            EQU     $20
00140F 00300F -> $0010                ID12            EQU     $10
00140F 00300F -> $0008                ID11            EQU     $08
00140F 00300F -> $0004                ID10            EQU     $04
00140F 00300F -> $0002                ID9             EQU     $02
00140F 00300F -> $0001                ID8             EQU     $01
00140F 00300F -> $001B                PARTIDL         EQU     $001B
00140F 00300F -> $0080                ID7             EQU     $80
00140F 00300F -> $0040                ID6             EQU     $40
00140F 00300F -> $0020                ID5             EQU     $20
00140F 00300F -> $0010                ID4             EQU     $10
00140F 00300F -> $0008                ID3             EQU     $08
00140F 00300F -> $0004                ID2             EQU     $04
00140F 00300F -> $0002                ID1             EQU     $02
00140F 00300F -> $0001                ID0             EQU     $01
00140F 00300F -> $001C                ECLKCTL         EQU     $001C
00140F 00300F -> $0080                NECLK           EQU     $80
00140F 00300F -> $0040                NCLKX2          EQU     $40
00140F 00300F -> $0020                DIV16           EQU     $20
00140F 00300F -> $0010                EDIV4           EQU     $10
00140F 00300F -> $0008                EDIV3           EQU     $08
00140F 00300F -> $0004                EDIV2           EQU     $04
00140F 00300F -> $0002                EDIV1           EQU     $02
00140F 00300F -> $0001                EDIV0           EQU     $01
00140F 00300F -> $001E                IRQCR           EQU     $001E
00140F 00300F -> $0080                IRQE            EQU     $80
00140F 00300F -> $0040                IRQEN           EQU     $40
00140F 00300F -> $0020                DBGC1           EQU     $0020
00140F 00300F -> $0080                ARM             EQU     $80
00140F 00300F -> $0040                TRIG            EQU     $40
00140F 00300F -> $0010                BDM             EQU     $10
00140F 00300F -> $0004                DBGBRK          EQU     $04
00140F 00300F -> $0003                COMRV           EQU     $03
00140F 00300F -> $0021                DBGSR           EQU     $0021
00140F 00300F -> $0080                TBF             EQU     $80
00140F 00300F -> $0004                SSF2            EQU     $04
00140F 00300F -> $0002                SSF1            EQU     $02
00140F 00300F -> $0001                SSF0            EQU     $01
00140F 00300F -> $0022                DBGTCR          EQU     $0022
00140F 00300F -> $0040                TSOURCE         EQU     $40
00140F 00300F -> $000C                TRCMOD          EQU     $0C
00140F 00300F -> $0001                TALIGN          EQU     $01
00140F 00300F -> $0023                DBGC2           EQU     $0023
00140F 00300F -> $0003                ABCM            EQU     $03
00140F 00300F -> $0024                DBGTBH          EQU     $0024
00140F 00300F -> $0080                DBGTB15         EQU     $80
00140F 00300F -> $0040                DBGTB14         EQU     $40
00140F 00300F -> $0020                DBGTB13         EQU     $20
00140F 00300F -> $0010                DBGTB12         EQU     $10
00140F 00300F -> $0008                DBGTB11         EQU     $08
00140F 00300F -> $0004                DBGTB10         EQU     $04
00140F 00300F -> $0002                DBGTB9          EQU     $02
00140F 00300F -> $0001                DBGTB8          EQU     $01
00140F 00300F -> $0025                DBGTBL          EQU     $0025
00140F 00300F -> $0080                DBGTB7          EQU     $80
00140F 00300F -> $0040                DBGTB6          EQU     $40
00140F 00300F -> $0020                DBGTB5          EQU     $20
00140F 00300F -> $0010                DBGTB4          EQU     $10
00140F 00300F -> $0008                DBGTB3          EQU     $08
00140F 00300F -> $0004                DBGTB2          EQU     $04
00140F 00300F -> $0002                DBGTB1          EQU     $02
00140F 00300F -> $0001                DBGTB0          EQU     $01
00140F 00300F -> $0026                DBGCNT          EQU     $0026
00140F 00300F -> $0080                TBF             EQU     $80
00140F 00300F -> $007F                CNT             EQU     $7F
00140F 00300F -> $0027                DBGSCRX         EQU     $0027
00140F 00300F -> $0008                SC3             EQU     $08
00140F 00300F -> $0004                SC2             EQU     $04
00140F 00300F -> $0002                SC1             EQU     $02
00140F 00300F -> $0001                SC0             EQU     $01
00140F 00300F -> $0027                DBGMFR          EQU     $0027
00140F 00300F -> $0004                MC2             EQU     $04
00140F 00300F -> $0002                MC1             EQU     $02
00140F 00300F -> $0001                MC0             EQU     $01
00140F 00300F -> $0028                DBGXCTL         EQU     $0028
00140F 00300F -> $0080                SZE             EQU     $80
00140F 00300F -> $0040                SZ              EQU     $40
00140F 00300F -> $0020                TAG             EQU     $20
00140F 00300F -> $0010                BRK             EQU     $10
00140F 00300F -> $0008                RW              EQU     $08
00140F 00300F -> $0004                RWE             EQU     $04
00140F 00300F -> $0002                NDB             EQU     $02
00140F 00300F -> $0001                COMPE           EQU     $01
00140F 00300F -> $0029                DBGXAH          EQU    $0029
00140F 00300F -> $0002                DBGXA17         EQU    $02
00140F 00300F -> $0001                DBGXA16         EQU    $01
00140F 00300F -> $002A                DBGXAM          EQU     $002A
00140F 00300F -> $0080                DBGXA15         EQU     $80
00140F 00300F -> $0040                DBGXA14         EQU     $40
00140F 00300F -> $0020                DBGXA13         EQU     $20
00140F 00300F -> $0010                DBGXA12         EQU     $10
00140F 00300F -> $0008                DBGXA11         EQU     $08
00140F 00300F -> $0004                DBGXA10         EQU     $04
00140F 00300F -> $0002                DBGXA9          EQU     $02
00140F 00300F -> $0001                DBGXA8          EQU     $01
00140F 00300F -> $002B                DBGXAL          EQU     $002B
00140F 00300F -> $0080                DBGXA7          EQU     $80
00140F 00300F -> $0040                DBGXA6          EQU     $40
00140F 00300F -> $0020                DBGXA5          EQU     $20
00140F 00300F -> $0010                DBGXA4          EQU     $10
00140F 00300F -> $0008                DBGXA3          EQU     $08
00140F 00300F -> $0004                DBGXA2          EQU     $04
00140F 00300F -> $0002                DBGXA1          EQU     $02
00140F 00300F -> $0001                DBGXA0          EQU     $01
00140F 00300F -> $002C                DBGADH          EQU     $002C
00140F 00300F -> $0080                DBGAD15         EQU     $80
00140F 00300F -> $0040                DBGAD14         EQU     $40
00140F 00300F -> $0020                DBGAD13         EQU     $20
00140F 00300F -> $0010                DBGAD12         EQU     $10
00140F 00300F -> $0008                DBGAD11         EQU     $08
00140F 00300F -> $0004                DBGAD10         EQU     $04
00140F 00300F -> $0002                DBGAD9          EQU     $02
00140F 00300F -> $0001                DBGAD8          EQU     $01
00140F 00300F -> $002D                DBGADL          EQU     $002D
00140F 00300F -> $0080                DBGAD7          EQU     $80
00140F 00300F -> $0040                DBGAD6          EQU     $40
00140F 00300F -> $0020                DBGAD5          EQU     $20
00140F 00300F -> $0010                DBGAD4          EQU     $10
00140F 00300F -> $0008                DBGAD3          EQU     $08
00140F 00300F -> $0004                DBGAD2          EQU     $04
00140F 00300F -> $0002                DBGAD1          EQU     $02
00140F 00300F -> $0001                DBGAD0          EQU     $01
00140F 00300F -> $002E                DBGADHM         EQU     $002E
00140F 00300F -> $0080                DBGADM15        EQU     $80
00140F 00300F -> $0040                DBGADM14        EQU     $40
00140F 00300F -> $0020                DBGADM13        EQU     $20
00140F 00300F -> $0010                DBGADM12        EQU     $10
00140F 00300F -> $0008                DBGADM11        EQU     $08
00140F 00300F -> $0004                DBGADM10        EQU     $04
00140F 00300F -> $0002                DBGADM9         EQU     $02
00140F 00300F -> $0001                DBGADM8         EQU     $01
00140F 00300F -> $002F                DBGADLM         EQU     $002F
00140F 00300F -> $0080                DBGADM7         EQU     $80
00140F 00300F -> $0040                DBGADM6         EQU     $40
00140F 00300F -> $0020                DBGADM5         EQU     $20
00140F 00300F -> $0010                DBGADM4         EQU     $10
00140F 00300F -> $0008                DBGADM3         EQU     $08
00140F 00300F -> $0004                DBGADM2         EQU     $04
00140F 00300F -> $0002                DBGADM1         EQU     $02
00140F 00300F -> $0001                DBGADM0         EQU     $01
00140F 00300F -> $0034                CPMUSYNR        EQU     $0034
00140F 00300F -> $0034                SYNR            EQU     $0034
00140F 00300F -> $0080                VCOFRQ1         EQU     $80
00140F 00300F -> $0040                VCOFRQ0         EQU     $40
00140F 00300F -> $0020                SYNDIV5         EQU     $20
00140F 00300F -> $0010                SYNDIV4         EQU     $10
00140F 00300F -> $0008                SYNDIV3         EQU     $08
00140F 00300F -> $0004                SYNDIV2         EQU     $04
00140F 00300F -> $0002                SYNDIV1         EQU     $02
00140F 00300F -> $0001                SYNDIV0         EQU     $01
00140F 00300F -> $0035                CPMUREFDV       EQU     $0035
00140F 00300F -> $0035                REFDV           EQU     $0035
00140F 00300F -> $0080                REFFRQ1         EQU     $80
00140F 00300F -> $0040                REFFRQ0         EQU     $40
00140F 00300F -> $0008                REFDIV3         EQU     $08
00140F 00300F -> $0004                REFDIV2         EQU     $04
00140F 00300F -> $0002                REFDIV1         EQU     $02
00140F 00300F -> $0001                REFDIV0         EQU     $01
00140F 00300F -> $0036                CPMUPOSTDIV     EQU     $0036
00140F 00300F -> $0036                POSTDIV         EQU     $0036
00140F 00300F -> $0010                POSTDIV4        EQU     $10
00140F 00300F -> $0008                POSTDIV3        EQU     $08
00140F 00300F -> $0004                POSTDIV2        EQU     $04
00140F 00300F -> $0002                POSTDIV1        EQU     $02
00140F 00300F -> $0001                POSTDIV0        EQU     $01
00140F 00300F -> $0037                CPMUFLG         EQU     $0037
00140F 00300F -> $0080                RTIF            EQU     $80
00140F 00300F -> $0040                PORF            EQU     $40
00140F 00300F -> $0020                LVRF            EQU     $20
00140F 00300F -> $0010                LOCKIF          EQU     $10
00140F 00300F -> $0008                LOCK            EQU     $08
00140F 00300F -> $0004                ILAF            EQU     $04
00140F 00300F -> $0002                OSCIF           EQU     $02
00140F 00300F -> $0001                UPOSC           EQU     $01
00140F 00300F -> $0038                CPMUINT         EQU     $0038
00140F 00300F -> $0080                RTIE            EQU     $80
00140F 00300F -> $0010                LOCKIE          EQU     $10
00140F 00300F -> $0002                OSCIE           EQU     $02
00140F 00300F -> $0039                CPMUCLKS        EQU     $0039
00140F 00300F -> $0080                PLLSEL          EQU     $80
00140F 00300F -> $0040                PSTP            EQU     $40
00140F 00300F -> $0008                PRE             EQU     $08
00140F 00300F -> $0004                PCE             EQU     $04
00140F 00300F -> $0002                RTIOSCSEL       EQU     $02
00140F 00300F -> $0001                COPOSCSEL       EQU     $01
00140F 00300F -> $003A                CPMUPLL         EQU     $003A
00140F 00300F -> $0020                FM1             EQU     $20
00140F 00300F -> $0010                FM0             EQU     $10
00140F 00300F -> $003B                CPMURTI         EQU     $003B
00140F 00300F -> $0080                RTDEC           EQU     $80
00140F 00300F -> $0040                RTR6            EQU     $40
00140F 00300F -> $0020                RTR5            EQU     $20
00140F 00300F -> $0010                RTR4            EQU     $10
00140F 00300F -> $0008                RTR3            EQU     $08
00140F 00300F -> $0004                RTR2            EQU     $04
00140F 00300F -> $0002                RTR1            EQU     $02
00140F 00300F -> $0001                RTR0            EQU     $01
00140F 00300F -> $003C                CPMUCOP         EQU     $003C
00140F 00300F -> $0080                WCOP            EQU     $80
00140F 00300F -> $0040                RSBCK           EQU     $40
00140F 00300F -> $0020                WRTMASK         EQU     $20
00140F 00300F -> $0004                CR2             EQU     $04
00140F 00300F -> $0002                CR1             EQU     $02
00140F 00300F -> $0001                CR0             EQU     $01
00140F 00300F -> $003F                CPMUARMCOP      EQU     $003F
00140F 00300F -> $003F                ARMCOP          EQU     $003F
00140F 00300F -> $0040                TIM             EQU     $0040
00140F 00300F -> $0040                TIOS            EQU     $0040
00140F 00300F -> $0080                IOS7            EQU     $80
00140F 00300F -> $0040                IOS6            EQU     $40
00140F 00300F -> $0020                IOS5            EQU     $20
00140F 00300F -> $0010                IOS4            EQU     $10
00140F 00300F -> $0008                IOS3            EQU     $08
00140F 00300F -> $0004                IOS2            EQU     $04
00140F 00300F -> $0002                IOS1            EQU     $02
00140F 00300F -> $0001                IOS0            EQU     $01
00140F 00300F -> $0041                TCFORC          EQU     $0041
00140F 00300F -> $0080                FOC7            EQU     $80
00140F 00300F -> $0040                FOC6            EQU     $40
00140F 00300F -> $0020                FOC5            EQU     $20
00140F 00300F -> $0010                FOC4            EQU     $10
00140F 00300F -> $0008                FOC3            EQU     $08
00140F 00300F -> $0004                FOC2            EQU     $04
00140F 00300F -> $0002                FOC1            EQU     $02
00140F 00300F -> $0001                FOC0            EQU     $01
00140F 00300F -> $0042                TOC7M           EQU     $0042
00140F 00300F -> $0080                OC7M7           EQU     $80
00140F 00300F -> $0040                OC7M6           EQU     $40
00140F 00300F -> $0020                OC7M5           EQU     $20
00140F 00300F -> $0010                OC7M4           EQU     $10
00140F 00300F -> $0008                OC7M3           EQU     $08
00140F 00300F -> $0004                OC7M2           EQU     $04
00140F 00300F -> $0002                OC7M1           EQU     $02
00140F 00300F -> $0001                OC7M0           EQU     $01
00140F 00300F -> $0043                TOC7D           EQU     $0043
00140F 00300F -> $0080                OC7D7           EQU     $80
00140F 00300F -> $0040                OC7D6           EQU     $40
00140F 00300F -> $0020                OC7D5           EQU     $20
00140F 00300F -> $0010                OC7D4           EQU     $10
00140F 00300F -> $0008                OC7D3           EQU     $08
00140F 00300F -> $0004                OC7D2           EQU     $04
00140F 00300F -> $0002                OC7D1           EQU     $02
00140F 00300F -> $0001                OC7D0           EQU     $01
00140F 00300F -> $0044                TCNT            EQU     $0044
00140F 00300F -> $0046                TSCR1           EQU     $0046
00140F 00300F -> $0080                TEN             EQU     $80
00140F 00300F -> $0040                TSWAI           EQU     $40
00140F 00300F -> $0020                TSFRZ           EQU     $20
00140F 00300F -> $0010                TFFCA           EQU     $10
00140F 00300F -> $0008                PRNT            EQU     $08
00140F 00300F -> $0047                TTOV            EQU     $0047
00140F 00300F -> $0080                TOV7            EQU     $80
00140F 00300F -> $0040                TOV6            EQU     $40
00140F 00300F -> $0020                TOV5            EQU     $20
00140F 00300F -> $0010                TOV4            EQU     $10
00140F 00300F -> $0008                TOV3            EQU     $08
00140F 00300F -> $0004                TOV2            EQU     $04
00140F 00300F -> $0002                TOV1            EQU     $02
00140F 00300F -> $0001                TOV0            EQU     $01
00140F 00300F -> $0048                TCTL1           EQU     $0048
00140F 00300F -> $0080                OM7             EQU     $80
00140F 00300F -> $0040                OL7             EQU     $40
00140F 00300F -> $0020                OM6             EQU     $20
00140F 00300F -> $0010                OL6             EQU     $10
00140F 00300F -> $0008                OM5             EQU     $08
00140F 00300F -> $0004                OL5             EQU     $04
00140F 00300F -> $0002                OM4             EQU     $02
00140F 00300F -> $0001                OL4             EQU     $01
00140F 00300F -> $0049                TCTL2           EQU     $0049
00140F 00300F -> $0080                OM3             EQU     $80
00140F 00300F -> $0040                OL3             EQU     $40
00140F 00300F -> $0020                OM2             EQU     $20
00140F 00300F -> $0010                OL2             EQU     $10
00140F 00300F -> $0008                OM1             EQU     $08
00140F 00300F -> $0004                OL1             EQU     $04
00140F 00300F -> $0002                OM0             EQU     $02
00140F 00300F -> $0001                OL0             EQU     $01
00140F 00300F -> $004A                TCTL3           EQU     $004A
00140F 00300F -> $0080                EDG7B           EQU     $80
00140F 00300F -> $0040                EDG7A           EQU     $40
00140F 00300F -> $0020                EDG6B           EQU     $20
00140F 00300F -> $0010                EDG6A           EQU     $10
00140F 00300F -> $0008                EDG5B           EQU     $08
00140F 00300F -> $0004                EDG5A           EQU     $04
00140F 00300F -> $0002                EDG4B           EQU     $02
00140F 00300F -> $0001                EDG4A           EQU     $01
00140F 00300F -> $004B                TCTL4           EQU     $004B
00140F 00300F -> $0080                EDG3B           EQU     $80
00140F 00300F -> $0040                EDG3A           EQU     $40
00140F 00300F -> $0020                EDG2B           EQU     $20
00140F 00300F -> $0010                EDG2A           EQU     $10
00140F 00300F -> $0008                EDG1B           EQU     $08
00140F 00300F -> $0004                EDG1A           EQU     $04
00140F 00300F -> $0002                EDG0B           EQU     $02
00140F 00300F -> $0001                EDG0A           EQU     $01
00140F 00300F -> $004C                TIE             EQU     $004C
00140F 00300F -> $0080                C7I             EQU     $80
00140F 00300F -> $0040                C6I             EQU     $40
00140F 00300F -> $0020                C5I             EQU     $20
00140F 00300F -> $0010                C4I             EQU     $10
00140F 00300F -> $0008                C3I             EQU     $08
00140F 00300F -> $0004                C2I             EQU     $04
00140F 00300F -> $0002                C1I             EQU     $02
00140F 00300F -> $0001                C0I             EQU     $01
00140F 00300F -> $004D                TSCR2           EQU     $004D
00140F 00300F -> $0080                TOI             EQU     $80
00140F 00300F -> $0008                TCRE            EQU     $08
00140F 00300F -> $0004                PR2             EQU     $04
00140F 00300F -> $0002                PR1             EQU     $02
00140F 00300F -> $0001                PR0             EQU     $01
00140F 00300F -> $004E                TFLG1           EQU     $004E
00140F 00300F -> $0080                C7F             EQU     $80
00140F 00300F -> $0040                C6F             EQU     $40
00140F 00300F -> $0020                C5F             EQU     $20
00140F 00300F -> $0010                C4F             EQU     $10
00140F 00300F -> $0008                C3F             EQU     $08
00140F 00300F -> $0004                C2F             EQU     $04
00140F 00300F -> $0002                C1F             EQU     $02
00140F 00300F -> $0001                C0F             EQU     $01
00140F 00300F -> $004F                TFLG2           EQU     $004F
00140F 00300F -> $0080                TOF             EQU     $80
00140F 00300F -> $0050                TC0             EQU     $0050
00140F 00300F -> $0052                TC1             EQU     $0052
00140F 00300F -> $0054                TC2             EQU     $0054
00140F 00300F -> $0056                TC3             EQU     $0056
00140F 00300F -> $0058                TC4             EQU     $0058
00140F 00300F -> $005A                TC5             EQU     $005A
00140F 00300F -> $005C                TC6             EQU     $005C
00140F 00300F -> $005E                TC7             EQU     $005E
00140F 00300F -> $0060                PACTL           EQU     $0060
00140F 00300F -> $0040                PAEN            EQU     $40
00140F 00300F -> $0020                PAMOD           EQU     $20
00140F 00300F -> $0010                PEDGE           EQU     $10
00140F 00300F -> $0008                CLK1            EQU     $08
00140F 00300F -> $0004                CLK0            EQU     $04
00140F 00300F -> $0002                PAOVI           EQU     $02
00140F 00300F -> $0001                PAI             EQU     $01
00140F 00300F -> $0061                PAFLG           EQU     $0061
00140F 00300F -> $0002                PAOVF           EQU     $02
00140F 00300F -> $0001                PAIF            EQU     $01
00140F 00300F -> $0062                PACNT           EQU     $0062
00140F 00300F -> $006C                OCPD            EQU     $006C
00140F 00300F -> $0080                OCPD7           EQU     $80
00140F 00300F -> $0040                OCPD6           EQU     $40
00140F 00300F -> $0020                OCPD5           EQU     $20
00140F 00300F -> $0010                OCPD4           EQU     $10
00140F 00300F -> $0008                OCPD3           EQU     $08
00140F 00300F -> $0004                OCPD2           EQU     $04
00140F 00300F -> $0002                OCPD1           EQU     $02
00140F 00300F -> $0001                OCPD0           EQU     $01
00140F 00300F -> $006E                PTPSR           EQU     $006E
00140F 00300F -> $0080                PTPS7           EQU     $80
00140F 00300F -> $0040                PTPS6           EQU     $40
00140F 00300F -> $0020                PTPS5           EQU     $20
00140F 00300F -> $0010                PTPS4           EQU     $10
00140F 00300F -> $0008                PTPS3           EQU     $08
00140F 00300F -> $0004                PTPS2           EQU     $04
00140F 00300F -> $0002                PTPS1           EQU     $02
00140F 00300F -> $0001                PTPS0           EQU     $01
00140F 00300F -> $0070                ATDCTL0         EQU     $0070
00140F 00300F -> $0008                WRAP3           EQU     $08
00140F 00300F -> $0004                WRAP2           EQU     $04
00140F 00300F -> $0002                WRAP1           EQU     $02
00140F 00300F -> $0001                WRAP0           EQU     $01
00140F 00300F -> $0071                ATDCTL1         EQU     $0071
00140F 00300F -> $0080                ETRIGSEL        EQU     $80
00140F 00300F -> $0040                SRES1           EQU     $40
00140F 00300F -> $0020                SRES0           EQU     $20
00140F 00300F -> $0010                DIS             EQU     $10
00140F 00300F -> $0008                ETRIGCH3        EQU     $08
00140F 00300F -> $0004                ETRIGCH2        EQU     $04
00140F 00300F -> $0002                ETRIGCH1        EQU     $02
00140F 00300F -> $0001                ETRIGCH0        EQU     $01
00140F 00300F -> $0072                ATDCTL2         EQU     $0072
00140F 00300F -> $0040                AFFC            EQU     $40
00140F 00300F -> $0010                ETRIGLE         EQU     $10
00140F 00300F -> $0008                ETRIGP          EQU     $08
00140F 00300F -> $0004                ETRIGE          EQU     $04
00140F 00300F -> $0002                ASCIE           EQU     $02
00140F 00300F -> $0001                ASCIF           EQU     $01
00140F 00300F -> $0073                ATDCTL3         EQU     $0073
00140F 00300F -> $0080                DJM             EQU     $80
00140F 00300F -> $0040                S8C             EQU     $40
00140F 00300F -> $0020                S4C             EQU     $20
00140F 00300F -> $0010                S2C             EQU     $10
00140F 00300F -> $0008                S1C             EQU     $08
00140F 00300F -> $0004                FIFO            EQU     $04
00140F 00300F -> $0002                FRZ1            EQU     $02
00140F 00300F -> $0001                FRZ0            EQU     $01
00140F 00300F -> $0074                ATDCTL4         EQU     $0074
00140F 00300F -> $0080                SMP2            EQU     $80
00140F 00300F -> $0040                SMP1            EQU     $40
00140F 00300F -> $0020                SMP0            EQU     $20
00140F 00300F -> $0010                PRS4            EQU     $10
00140F 00300F -> $0008                PRS3            EQU     $08
00140F 00300F -> $0004                PRS2            EQU     $04
00140F 00300F -> $0002                PRS1            EQU     $02
00140F 00300F -> $0001                PRS0            EQU     $01
00140F 00300F -> $0075                ATDCTL5         EQU     $0075
00140F 00300F -> $0040                SC              EQU     $40
00140F 00300F -> $0020                SCAN            EQU     $20
00140F 00300F -> $0010                MULT            EQU     $10
00140F 00300F -> $0008                CD              EQU     $08
00140F 00300F -> $0004                CC              EQU     $04
00140F 00300F -> $0002                CB              EQU     $02
00140F 00300F -> $0001                CA              EQU     $01
00140F 00300F -> $0076                ATDSTAT0        EQU     $0076
00140F 00300F -> $0080                SCF             EQU     $80
00140F 00300F -> $0020                ETORF           EQU     $20
00140F 00300F -> $0010                FIFOR           EQU     $10
00140F 00300F -> $0004                CC3             EQU     $04
00140F 00300F -> $0004                CC2             EQU     $04
00140F 00300F -> $0002                CC1             EQU     $02
00140F 00300F -> $0001                CC0             EQU     $01
00140F 00300F -> $0078                ATDCMPEH        EQU     $0078
00140F 00300F -> $0080                CMPE15          EQU     $80
00140F 00300F -> $0040                CMPE14          EQU     $40
00140F 00300F -> $0020                CMPE13          EQU     $20
00140F 00300F -> $0010                CMPE12          EQU     $10
00140F 00300F -> $0008                CMPE11          EQU     $08
00140F 00300F -> $0004                CMPE10          EQU     $04
00140F 00300F -> $0002                CMPE9           EQU     $02
00140F 00300F -> $0001                CMPE8           EQU     $01
00140F 00300F -> $0079                ATDCMPEL        EQU     $0079
00140F 00300F -> $0080                CMPE7           EQU     $80
00140F 00300F -> $0040                CMPE6           EQU     $40
00140F 00300F -> $0020                CMPE5           EQU     $20
00140F 00300F -> $0010                CMPE4           EQU     $10
00140F 00300F -> $0008                CMPE3           EQU     $08
00140F 00300F -> $0004                CMPE2           EQU     $04
00140F 00300F -> $0002                CMPE1           EQU     $02
00140F 00300F -> $0001                CMPE0           EQU     $01
00140F 00300F -> $007A                ATDSTAT2H       EQU     $007A
00140F 00300F -> $0080                CCF15           EQU     $80
00140F 00300F -> $0040                CCF14           EQU     $40
00140F 00300F -> $0020                CCF13           EQU     $20
00140F 00300F -> $0010                CCF12           EQU     $10
00140F 00300F -> $0008                CCF11           EQU     $08
00140F 00300F -> $0004                CCF10           EQU     $04
00140F 00300F -> $0002                CCF9            EQU     $02
00140F 00300F -> $0001                CCF8            EQU     $01
00140F 00300F -> $007B                ATDSTAT2L       EQU     $007B
00140F 00300F -> $0080                CCF7            EQU     $80
00140F 00300F -> $0040                CCF6            EQU     $40
00140F 00300F -> $0020                CCF5            EQU     $20
00140F 00300F -> $0010                CCF4            EQU     $10
00140F 00300F -> $0008                CCF3            EQU     $08
00140F 00300F -> $0004                CCF2            EQU     $04
00140F 00300F -> $0002                CCF1            EQU     $02
00140F 00300F -> $0001                CCF0            EQU     $01
00140F 00300F -> $007C                ATDDIENH        EQU     $007C
00140F 00300F -> $007C                ATDDIEN         EQU     $007C
00140F 00300F -> $0080                IEN15           EQU     $80
00140F 00300F -> $0040                IEN14           EQU     $40
00140F 00300F -> $0020                IEN13           EQU     $20
00140F 00300F -> $0010                IEN12           EQU     $10
00140F 00300F -> $0008                IEN11           EQU     $08
00140F 00300F -> $0004                IEN10           EQU     $04
00140F 00300F -> $0002                IEN9            EQU     $02
00140F 00300F -> $0001                IEN8            EQU     $01
00140F 00300F -> $007D                ATDDIENL        EQU     $007D
00140F 00300F -> $0080                IEN7            EQU     $80
00140F 00300F -> $0040                IEN6            EQU     $40
00140F 00300F -> $0020                IEN5            EQU     $20
00140F 00300F -> $0010                IEN4            EQU     $10
00140F 00300F -> $0008                IEN3            EQU     $08
00140F 00300F -> $0004                IEN2            EQU     $04
00140F 00300F -> $0002                IEN1            EQU     $02
00140F 00300F -> $0001                IEN0            EQU     $01
00140F 00300F -> $007E                ATDCMPHTH       EQU     $007E
00140F 00300F -> $0080                CMPHT15         EQU     $80
00140F 00300F -> $0040                CMPHT14         EQU     $40
00140F 00300F -> $0020                CMPHT13         EQU     $20
00140F 00300F -> $0010                CMPHT12         EQU     $10
00140F 00300F -> $0008                CMPHT11         EQU     $08
00140F 00300F -> $0004                CMPHT10         EQU     $04
00140F 00300F -> $0002                CMPHT9          EQU     $02
00140F 00300F -> $0001                CMPHT8          EQU     $01
00140F 00300F -> $007F                ATDCMPHTL       EQU     $007F
00140F 00300F -> $0001                CMPHT0          EQU     $01
00140F 00300F -> $0002                CMPHT1          EQU     $02
00140F 00300F -> $0004                CMPHT2          EQU     $04
00140F 00300F -> $0008                CMPHT3          EQU     $08
00140F 00300F -> $0010                CMPHT4          EQU     $10
00140F 00300F -> $0020                CMPHT5          EQU     $20
00140F 00300F -> $0040                CMPHT6          EQU     $40
00140F 00300F -> $0080                CMPHT7          EQU     $80
00140F 00300F -> $0080                ATDDR0          EQU     $0080
00140F 00300F -> $0080                ATDDR0H         EQU     $0080
00140F 00300F -> $0081                ATDDR0L         EQU     $0081
00140F 00300F -> $0082                ATDDR1          EQU     $0082
00140F 00300F -> $0082                ATDDR1H         EQU     $0082
00140F 00300F -> $0083                ATDDR1L         EQU     $0083
00140F 00300F -> $0084                ATDDR2          EQU     $0084
00140F 00300F -> $0084                ATDDR2H         EQU     $0084
00140F 00300F -> $0085                ATDDR2L         EQU     $0085
00140F 00300F -> $0086                ATDDR3          EQU     $0086
00140F 00300F -> $0086                ATDDR3H         EQU     $0086
00140F 00300F -> $0087                ATDDR3L         EQU     $0087
00140F 00300F -> $0088                ATDDR4          EQU     $0088
00140F 00300F -> $0088                ATDDR4H         EQU     $0088
00140F 00300F -> $0089                ATDDR4L         EQU     $0089
00140F 00300F -> $008A                ATDDR5          EQU     $008A
00140F 00300F -> $008A                ATDDR5H         EQU     $008A
00140F 00300F -> $008B                ATDDR5L         EQU     $008B
00140F 00300F -> $008C                ATDDR6          EQU     $008C
00140F 00300F -> $008C                ATDDR6H         EQU     $008C
00140F 00300F -> $008D                ATDDR6L         EQU     $008D
00140F 00300F -> $008E                ATDDR7          EQU     $008E
00140F 00300F -> $008E                ATDDR7H         EQU     $008E
00140F 00300F -> $008F                ATDDR7L         EQU     $008F
00140F 00300F -> $0090                ATDDR8          EQU     $0090
00140F 00300F -> $0090                ATDDR8H         EQU     $0090
00140F 00300F -> $0091                ATDDR8L         EQU     $0091
00140F 00300F -> $0092                ATDDR9          EQU     $0092
00140F 00300F -> $0092                ATDDR9H         EQU     $0092
00140F 00300F -> $0093                ATDDR9L         EQU     $0093
00140F 00300F -> $0093                ATDDR10         EQU     $0093
00140F 00300F -> $0093                ATDDR10H        EQU     $0093
00140F 00300F -> $0095                ATDDR10L        EQU     $0095
00140F 00300F -> $0096                ATDDR11         EQU     $0096
00140F 00300F -> $0096                ATDDR11H        EQU     $0096
00140F 00300F -> $0097                ATDDR11L        EQU     $0097
00140F 00300F -> $0098                ATDDR12         EQU     $0098
00140F 00300F -> $0098                ATDDR12H        EQU     $0098
00140F 00300F -> $0099                ATDDR12L        EQU     $0099
00140F 00300F -> $009A                ATDDR13         EQU     $009A
00140F 00300F -> $009A                ATDDR13H        EQU     $009A
00140F 00300F -> $009B                ATDDR13L        EQU     $009B
00140F 00300F -> $009C                ATDDR14         EQU     $009C
00140F 00300F -> $009C                ATDDR14H        EQU     $009C
00140F 00300F -> $009D                ATDDR14L        EQU     $009D
00140F 00300F -> $009E                ATDDR15         EQU     $009E
00140F 00300F -> $009E                ATDDR15H        EQU     $009E
00140F 00300F -> $009F                ATDDR15L        EQU     $009F
00140F 00300F -> $00A0                PWME            EQU     $00A0
00140F 00300F -> $0080                PWME7           EQU     $80
00140F 00300F -> $0040                PWME6           EQU     $40
00140F 00300F -> $0020                PWME5           EQU     $20
00140F 00300F -> $0010                PWME4           EQU     $10
00140F 00300F -> $0008                PWME3           EQU     $08
00140F 00300F -> $0004                PWME2           EQU     $04
00140F 00300F -> $0002                PWME1           EQU     $02
00140F 00300F -> $0001                PWME0           EQU     $01
00140F 00300F -> $00A1                PWMPOL          EQU     $00A1
00140F 00300F -> $0080                PPOL7           EQU     $80
00140F 00300F -> $0040                PPOL6           EQU     $40
00140F 00300F -> $0020                PPOL5           EQU     $20
00140F 00300F -> $0010                PPOL4           EQU     $10
00140F 00300F -> $0008                PPOL3           EQU     $08
00140F 00300F -> $0004                PPOL2           EQU     $04
00140F 00300F -> $0002                PPOL1           EQU     $02
00140F 00300F -> $0001                PPOL0           EQU     $01
00140F 00300F -> $00A2                PWMCLK          EQU     $00A2
00140F 00300F -> $0080                PCLK7           EQU     $80
00140F 00300F -> $0040                PCLK6           EQU     $40
00140F 00300F -> $0020                PCLK5           EQU     $20
00140F 00300F -> $0010                PCLK4           EQU     $10
00140F 00300F -> $0008                PCLK3           EQU     $08
00140F 00300F -> $0004                PCLK2           EQU     $04
00140F 00300F -> $0002                PCLK1           EQU     $02
00140F 00300F -> $0001                PCLK0           EQU     $01
00140F 00300F -> $00A3                PWMPRCLK        EQU     $00A3
00140F 00300F -> $0040                PCKB2           EQU     $40
00140F 00300F -> $0020                PCKB1           EQU     $20
00140F 00300F -> $0010                PCKB0           EQU     $10
00140F 00300F -> $0004                PCKA2           EQU     $04
00140F 00300F -> $0002                PCKA1           EQU     $02
00140F 00300F -> $0001                PCKA0           EQU     $01
00140F 00300F -> $00A4                PWMCAE          EQU     $00A4
00140F 00300F -> $0080                CAE7            EQU     $80
00140F 00300F -> $0040                CAE6            EQU     $40
00140F 00300F -> $0020                CAE5            EQU     $20
00140F 00300F -> $0010                CAE4            EQU     $10
00140F 00300F -> $0008                CAE3            EQU     $08
00140F 00300F -> $0004                CAE2            EQU     $04
00140F 00300F -> $0002                CAE1            EQU     $02
00140F 00300F -> $0001                CAE0            EQU     $01
00140F 00300F -> $00A5                PWMCTL          EQU     $00A5
00140F 00300F -> $0080                CON67           EQU     $80
00140F 00300F -> $0040                CON45           EQU     $40
00140F 00300F -> $0020                CON23           EQU     $20
00140F 00300F -> $0010                CON01           EQU     $10
00140F 00300F -> $0008                PSWAI           EQU     $08
00140F 00300F -> $0004                PFRZ            EQU     $04
00140F 00300F -> $00A6                PWMCLKAB        EQU     $00A6
00140F 00300F -> $0080                PCLKAB7         EQU     $80
00140F 00300F -> $0040                PCLKAB6         EQU     $40
00140F 00300F -> $0020                PCLKAB5         EQU     $20
00140F 00300F -> $0010                PCLKAB4         EQU     $10
00140F 00300F -> $0008                PCLKAB3         EQU     $08
00140F 00300F -> $0004                PCLKAB2         EQU     $04
00140F 00300F -> $0002                PCLKAB1         EQU     $02
00140F 00300F -> $0001                PCLKAB0         EQU     $01
00140F 00300F -> $00A8                PWMSCNTA        EQU     $00A8
00140F 00300F -> $00A9                PWMSCNTB        EQU     $00A9
00140F 00300F -> $00AC                PWMCNT0         EQU     $00AC
00140F 00300F -> $00AD                PWMCNT1         EQU     $00AD
00140F 00300F -> $00AE                PWMCNT2         EQU     $00AE
00140F 00300F -> $00AF                PWMCNT3         EQU     $00AF
00140F 00300F -> $00B0                PWMCNT4         EQU     $00B0
00140F 00300F -> $00B1                PWMCNT5         EQU     $00B1
00140F 00300F -> $00B2                PWMCNT6         EQU     $00B2
00140F 00300F -> $00B3                PWMCNT7         EQU     $00B3
00140F 00300F -> $00B4                PWMPER0         EQU     $00B4
00140F 00300F -> $00B5                PWMPER1         EQU     $00B5
00140F 00300F -> $00B6                PWMPER2         EQU     $00B6
00140F 00300F -> $00B7                PWMPER3         EQU     $00B7
00140F 00300F -> $00B8                PWMPER4         EQU     $00B8
00140F 00300F -> $00B9                PWMPER5         EQU     $00B9
00140F 00300F -> $00BA                PWMPER6         EQU     $00BA
00140F 00300F -> $00BB                PWMPER7         EQU     $00BB
00140F 00300F -> $00BC                PWMDTY0         EQU     $00BC
00140F 00300F -> $00BD                PWMDTY1         EQU     $00BD
00140F 00300F -> $00BE                PWMDTY2         EQU     $00BE
00140F 00300F -> $00BF                PWMDTY3         EQU     $00BF
00140F 00300F -> $00C0                PWMDTY4         EQU     $00C0
00140F 00300F -> $00C1                PWMDTY5         EQU     $00C1
00140F 00300F -> $00C2                PWMDTY6         EQU     $00C2
00140F 00300F -> $00C3                PWMDTY7         EQU     $00C3
00140F 00300F -> $00C8                SCIBDH          EQU     $00C8
00140F 00300F -> $00C8                SCI0BDH         EQU     $00C8
00140F 00300F -> $0080                IREN            EQU     $80
00140F 00300F -> $0040                TNP1            EQU     $40
00140F 00300F -> $0020                TNP0            EQU     $20
00140F 00300F -> $0010                SBR12           EQU     $10
00140F 00300F -> $0008                SBR11           EQU     $08
00140F 00300F -> $0004                SBR10           EQU     $04
00140F 00300F -> $0002                SBR9            EQU     $02
00140F 00300F -> $0001                SBR8            EQU     $01
00140F 00300F -> $00C9                SCI0ASR1        EQU     $00C9
00140F 00300F -> $0080                RXEDGIF         EQU     $80
00140F 00300F -> $0004                BERRV           EQU     $04
00140F 00300F -> $0002                BERRIF          EQU     $02
00140F 00300F -> $0001                BKDIF           EQU     $01
00140F 00300F -> $00C9                SCIBDL          EQU     $00C9
00140F 00300F -> $00C9                SCI0BDL         EQU     $00C9
00140F 00300F -> $0080                SBR7            EQU     $80
00140F 00300F -> $0040                SBR6            EQU     $40
00140F 00300F -> $0020                SBR5            EQU     $20
00140F 00300F -> $0010                SBR4            EQU     $10
00140F 00300F -> $0008                SBR3            EQU     $08
00140F 00300F -> $0004                SBR2            EQU     $04
00140F 00300F -> $0002                SBR1            EQU     $02
00140F 00300F -> $0001                SBR0            EQU     $01
00140F 00300F -> $00C9                SCI0ACR1        EQU     $00C9
00140F 00300F -> $0080                RXEDGIE         EQU     $80
00140F 00300F -> $0002                BERRIE          EQU     $02
00140F 00300F -> $0001                BKDIE           EQU     $01
00140F 00300F -> $00CA                SCICR1          EQU     $00CA
00140F 00300F -> $00CA                SCI0CR1         EQU     $00CA
00140F 00300F -> $0080                LOOPS           EQU     $80
00140F 00300F -> $0040                SCISWAI         EQU     $40
00140F 00300F -> $0020                RSRC            EQU     $20
00140F 00300F -> $0010                M               EQU     $10
00140F 00300F -> $0008                WAKE            EQU     $08
00140F 00300F -> $0004                ILT             EQU     $04
00140F 00300F -> $0002                PE              EQU     $02
00140F 00300F -> $0001                PT              EQU     $01
00140F 00300F -> $00CA                SCI0ACR2        EQU     $00CA
00140F 00300F -> $0004                BERRM1          EQU     $04
00140F 00300F -> $0002                BERRM0          EQU     $02
00140F 00300F -> $0001                BKDFE           EQU     $01
00140F 00300F -> $00CB                SCICR2          EQU     $00CB
00140F 00300F -> $00CB                SCI0CR2         EQU     $00CB
00140F 00300F -> $0080                TXIE            EQU     $80
00140F 00300F -> $0040                TCIE            EQU     $40
00140F 00300F -> $0020                RIE             EQU     $20
00140F 00300F -> $0010                ILIE            EQU     $10
00140F 00300F -> $0008                TE              EQU     $08
00140F 00300F -> $0004                RE              EQU     $04
00140F 00300F -> $0002                RWU             EQU     $02
00140F 00300F -> $0001                SBK             EQU     $01
00140F 00300F -> $00CC                SCISR1          EQU     $00CC
00140F 00300F -> $00CC                SCI0SR1         EQU     $00CC
00140F 00300F -> $0080                TDRE            EQU     $80
00140F 00300F -> $0040                TC              EQU     $40
00140F 00300F -> $0020                RDRFF           EQU     $20
00140F 00300F -> $0010                IDLE            EQU     $10
00140F 00300F -> $0008                OR              EQU     $08
00140F 00300F -> $0004                NF              EQU     $04
00140F 00300F -> $0002                FE              EQU     $02
00140F 00300F -> $0001                PF              EQU     $01
00140F 00300F -> $00CD                SCISR2          EQU     $00CD
00140F 00300F -> $00CD                SCI0SR2         EQU     $00CD
00140F 00300F -> $0008                AMAP            EQU     $08
00140F 00300F -> $0010                TXPOL           EQU     $10
00140F 00300F -> $0008                RXPOL           EQU     $08
00140F 00300F -> $0004                BRK13           EQU     $04
00140F 00300F -> $0002                TXDIR           EQU     $02
00140F 00300F -> $0001                RAF             EQU     $01
00140F 00300F -> $00CE                SCIDRH          EQU     $00CE
00140F 00300F -> $00CE                SCI0DRH         EQU     $00CE
00140F 00300F -> $0080                R8              EQU     $80
00140F 00300F -> $0040                T8              EQU     $40
00140F 00300F -> $00CF                SCIDRL          EQU     $00CF
00140F 00300F -> $00CF                SCI0DRL         EQU     $00CF
00140F 00300F -> $00D0                SCI1BDH         EQU     $00D0
00140F 00300F -> $00D0                SCI1ASR1        EQU     $00D0
00140F 00300F -> $00D1                SCI1BDL         EQU     $00D1
00140F 00300F -> $00D1                SCI1ACR1        EQU     $00D1
00140F 00300F -> $00D2                SCI1CR1         EQU     $00D2
00140F 00300F -> $00D2                SCI1ACR2        EQU     $00D2
00140F 00300F -> $00D3                SCI1CR2         EQU     $00D3
00140F 00300F -> $00D4                SCI1SR1         EQU     $00D4
00140F 00300F -> $00D5                SCI1SR2         EQU     $00D5
00140F 00300F -> $00D6                SCI1DRH         EQU     $00D6
00140F 00300F -> $00D7                SCI1DRL         EQU     $00D7
00140F 00300F -> $00D8                SPICR1          EQU     $00D8
00140F 00300F -> $00D8                SPI0CR1         EQU     $00D8
00140F 00300F -> $0080                SPIE            EQU     $80
00140F 00300F -> $0040                SPE             EQU     $40
00140F 00300F -> $0020                SPTIE           EQU     $20
00140F 00300F -> $0010                MSTR            EQU     $10
00140F 00300F -> $0008                CPOL            EQU     $08
00140F 00300F -> $0004                CPHA            EQU     $04
00140F 00300F -> $0002                SSOE            EQU     $02
00140F 00300F -> $0001                LSBFE           EQU     $01
00140F 00300F -> $00D9                SPICR2          EQU     $00D9
00140F 00300F -> $00D9                SPI0CR2         EQU     $00D9
00140F 00300F -> $0040                XFRW            EQU     $40
00140F 00300F -> $0010                MODFEN          EQU     $10
00140F 00300F -> $0008                BIDIROE         EQU     $08
00140F 00300F -> $0002                SPISWAI         EQU     $02
00140F 00300F -> $0001                SPC0            EQU     $01
00140F 00300F -> $00DA                SPIBR           EQU     $00DA
00140F 00300F -> $00DA                SPI0BR          EQU     $00DA
00140F 00300F -> $0040                SPPR2           EQU     $40
00140F 00300F -> $0020                SPPR1           EQU     $20
00140F 00300F -> $0010                SPPR0           EQU     $10
00140F 00300F -> $0004                SPR2            EQU     $04
00140F 00300F -> $0002                SPR1            EQU     $02
00140F 00300F -> $0001                SPR0            EQU     $01
00140F 00300F -> $00DB                SPISR           EQU     $00DB
00140F 00300F -> $00DB                SPI0SR          EQU     $00DB
00140F 00300F -> $0080                SPIF            EQU     $80
00140F 00300F -> $0020                SPTEF           EQU     $20
00140F 00300F -> $0010                MODF            EQU     $10
00140F 00300F -> $00DC                SPIDRH          EQU     $00DC
00140F 00300F -> $00DC                SPI0DRH         EQU     $00DC
00140F 00300F -> $00DD                SPIDRL          EQU     $00DD
00140F 00300F -> $00DD                SPI0DRL         EQU     $00DD
00140F 00300F -> $00E8                SCI2BDH         EQU     $00E8
00140F 00300F -> $00E8                SCI2ASR1        EQU     $00E8
00140F 00300F -> $00E9                SCI2BDL         EQU     $00E9
00140F 00300F -> $00E9                SCI2ACR1        EQU     $00E9
00140F 00300F -> $00EA                SCI2CR1         EQU     $00EA
00140F 00300F -> $00EA                SCI2ACR2        EQU     $00EA
00140F 00300F -> $00EB                SCI2CR2         EQU     $00EB
00140F 00300F -> $00EC                SCI2SR1         EQU     $00EC
00140F 00300F -> $00ED                SCI2SR2         EQU     $00ED
00140F 00300F -> $00EE                SCI2DRH         EQU     $00EE
00140F 00300F -> $00EF                SCI2DRL         EQU     $00EF
00140F 00300F -> $00F0                SPI1CR1         EQU     $00F0
00140F 00300F -> $00F1                SPI1CR2         EQU     $00F1
00140F 00300F -> $00F2                SPI1BR          EQU     $00F2
00140F 00300F -> $00F3                SPI1SR          EQU     $00F3
00140F 00300F -> $00F4                SPI1DRH         EQU     $00F4
00140F 00300F -> $00F5                SPI1DRL         EQU     $00F5
00140F 00300F -> $00F8                SPI2CR1         EQU     $00F8
00140F 00300F -> $00F9                SPI2CR2         EQU     $00F9
00140F 00300F -> $00FA                SPI2BR          EQU     $00FA
00140F 00300F -> $00FB                SPI2SR          EQU     $00FB
00140F 00300F -> $00FC                SPI2DRH         EQU     $00FC
00140F 00300F -> $00FD                SPI2DRL         EQU     $00FD
00140F 00300F -> $0100                FCLKDIV         EQU     $0100
00140F 00300F -> $0080                FDIVLD          EQU     $80
00140F 00300F -> $0040                FDIVLCK         EQU     $40
00140F 00300F -> $0020                FDIV5           EQU     $20
00140F 00300F -> $0010                FDIV4           EQU     $10
00140F 00300F -> $0008                FDIV3           EQU     $08
00140F 00300F -> $0004                FDIV2           EQU     $04
00140F 00300F -> $0002                FDIV1           EQU     $02
00140F 00300F -> $0001                FDIV0           EQU     $01
00140F 00300F -> $0101                FSEC            EQU     $0101
00140F 00300F -> $0080                KEYEN1          EQU     $80
00140F 00300F -> $0040                KEYEN2          EQU     $40
00140F 00300F -> $0020                RNV5            EQU     $20
00140F 00300F -> $0010                RNV4            EQU     $10
00140F 00300F -> $0008                RNV3            EQU     $08
00140F 00300F -> $0004                RNV2            EQU     $04
00140F 00300F -> $0002                SEC1            EQU     $02
00140F 00300F -> $0001                SEC0            EQU     $01
00140F 00300F -> $0102                FCCOBIX         EQU     $0102
00140F 00300F -> $0004                CCOBIX2         EQU     $04
00140F 00300F -> $0002                CCOBIX1         EQU     $02
00140F 00300F -> $0001                CCOBIX0         EQU     $01
00140F 00300F -> $0104                FCNFG           EQU     $0104
00140F 00300F -> $0080                CCIE            EQU     $80
00140F 00300F -> $0010                IGNSF           EQU     $10
00140F 00300F -> $0002                FDFD            EQU     $02
00140F 00300F -> $0001                FSFD            EQU     $01
00140F 00300F -> $0105                FERCNFG         EQU     $0105
00140F 00300F -> $0002                DFDIE           EQU     $02
00140F 00300F -> $0001                SFDIE           EQU     $01
00140F 00300F -> $0106                FSTAT           EQU     $0106
00140F 00300F -> $0080                CCIF            EQU     $80
00140F 00300F -> $0020                ACCERR          EQU     $20
00140F 00300F -> $0010                FPVIOL          EQU     $10
00140F 00300F -> $0008                MGBUSY          EQU     $08
00140F 00300F -> $0002                MGSTAT1         EQU     $02
00140F 00300F -> $0001                MGSTAT0         EQU     $01
00140F 00300F -> $0107                FERSTAT         EQU     $0107
00140F 00300F -> $0002                DFDIF           EQU     $02
00140F 00300F -> $0001                SFDIF           EQU     $01
00140F 00300F -> $0108                FPROT           EQU     $0108
00140F 00300F -> $0080                FPOPEN          EQU     $80
00140F 00300F -> $0040                RNV6            EQU     $40
00140F 00300F -> $0020                FPHDIS          EQU     $20
00140F 00300F -> $0010                FPHS1           EQU     $10
00140F 00300F -> $0008                FPHS0           EQU     $08
00140F 00300F -> $0004                FPLDIS          EQU     $04
00140F 00300F -> $0002                FPLS1           EQU     $02
00140F 00300F -> $0001                FPLS0           EQU     $01
00140F 00300F -> $0109                DPROT           EQU     $0109
00140F 00300F -> $0109                EPROT           EQU     $0109
00140F 00300F -> $0080                DPOPEN          EQU     $80
00140F 00300F -> $0080                EPOPEN          EQU     $80
00140F 00300F -> $0008                EPDIS           EQU     $08
00140F 00300F -> $0004                EPS2            EQU     $04
00140F 00300F -> $0002                EPS1            EQU     $02
00140F 00300F -> $0001                EPS0            EQU     $01
00140F 00300F -> $010A                FCCOBHI         EQU     $010A
00140F 00300F -> $0080                CCOB15          EQU     $80
00140F 00300F -> $0040                CCOB14          EQU     $40
00140F 00300F -> $0020                CCOB13          EQU     $20
00140F 00300F -> $0010                CCOB12          EQU     $10
00140F 00300F -> $0008                CCOB11          EQU     $08
00140F 00300F -> $0004                CCOB10          EQU     $04
00140F 00300F -> $0002                CCOB9           EQU     $02
00140F 00300F -> $0001                CCOB8           EQU     $01
00140F 00300F -> $010B                FCCOBLO         EQU     $010B
00140F 00300F -> $0080                CCOB7           EQU     $80
00140F 00300F -> $0040                CCOB6           EQU     $40
00140F 00300F -> $0020                CCOB5           EQU     $20
00140F 00300F -> $0010                CCOB4           EQU     $10
00140F 00300F -> $0008                CCOB3           EQU     $08
00140F 00300F -> $0004                CCOB2           EQU     $04
00140F 00300F -> $0002                CCOB1           EQU     $02
00140F 00300F -> $0001                CCOB0           EQU     $01
00140F 00300F -> $0110                FOPT            EQU     $0110
00140F 00300F -> $0080                NV7             EQU     $80
00140F 00300F -> $0040                NV6             EQU     $40
00140F 00300F -> $0020                NV5             EQU     $20
00140F 00300F -> $0010                NV4             EQU     $10
00140F 00300F -> $0008                NV3             EQU     $08
00140F 00300F -> $0004                NV2             EQU     $04
00140F 00300F -> $0002                NV1             EQU     $02
00140F 00300F -> $0001                NV0             EQU     $01
00140F 00300F -> $0120                IVBR            EQU     $0120
00140F 00300F -> $0140                CANCTL0         EQU     $0140
00140F 00300F -> $0080                RXFRM           EQU     $80
00140F 00300F -> $0040                RXACT           EQU     $40
00140F 00300F -> $0020                CSWAI           EQU     $20
00140F 00300F -> $0010                SYNCH           EQU     $10
00140F 00300F -> $0008                TIMEN           EQU     $08 ;RENAMED
00140F 00300F -> $0004                WUPE            EQU     $04
00140F 00300F -> $0002                SLPRQ           EQU     $02
00140F 00300F -> $0001                INITRQ          EQU     $01
00140F 00300F -> $0141                CANCTL1         EQU     $0141
00140F 00300F -> $0080                CANE            EQU     $80
00140F 00300F -> $0040                CLKSRC          EQU     $40
00140F 00300F -> $0020                LOOPB           EQU     $20
00140F 00300F -> $0010                LISTEN          EQU     $10
00140F 00300F -> $0004                WUPM            EQU     $04
00140F 00300F -> $0002                SLPAK           EQU     $02
00140F 00300F -> $0001                INITAK          EQU     $01
00140F 00300F -> $0142                CANBTR0         EQU     $0142
00140F 00300F -> $0080                SJW1            EQU     $80
00140F 00300F -> $0040                SJW0            EQU     $40
00140F 00300F -> $0020                BRP5            EQU     $20
00140F 00300F -> $0010                BRP4            EQU     $10
00140F 00300F -> $0008                BRP3            EQU     $08
00140F 00300F -> $0004                BRP2            EQU     $04
00140F 00300F -> $0002                BRP1            EQU     $02
00140F 00300F -> $0001                BRP0            EQU     $01
00140F 00300F -> $0143                CANBTR1         EQU     $0143
00140F 00300F -> $0080                SAMP            EQU     $80
00140F 00300F -> $0040                TSEG22          EQU     $40
00140F 00300F -> $0020                TSEG21          EQU     $20
00140F 00300F -> $0010                TSEG20          EQU     $10
00140F 00300F -> $0008                TSEG13          EQU     $08
00140F 00300F -> $0004                TSEG12          EQU     $04
00140F 00300F -> $0002                TSEG11          EQU     $02
00140F 00300F -> $0001                TESG10          EQU     $01
00140F 00300F -> $0144                CANRFLG         EQU     $0144
00140F 00300F -> $0080                WUPIF           EQU     $80
00140F 00300F -> $0040                CSCIF           EQU     $40
00140F 00300F -> $0020                RSTAT1          EQU     $20
00140F 00300F -> $0010                RSTAT0          EQU     $10
00140F 00300F -> $0008                TSTAT1          EQU     $08
00140F 00300F -> $0004                TSTAT0          EQU     $04
00140F 00300F -> $0002                OVRIF           EQU     $02
00140F 00300F -> $0001                RXF             EQU     $01
00140F 00300F -> $0145                CANRIER         EQU     $0145
00140F 00300F -> $0080                WUPIE           EQU     $80
00140F 00300F -> $0040                CSCIE           EQU     $40
00140F 00300F -> $0020                RSTATE1         EQU     $20
00140F 00300F -> $0010                RSTATE0         EQU     $10
00140F 00300F -> $0008                TSTATE1         EQU     $08
00140F 00300F -> $0004                TSTATE0         EQU     $04
00140F 00300F -> $0002                OVRIE           EQU     $02
00140F 00300F -> $0001                RXFIE           EQU     $01
00140F 00300F -> $0146                CANTFLG         EQU     $0146
00140F 00300F -> $0004                TXE2            EQU     $04
00140F 00300F -> $0002                TXE1            EQU     $02
00140F 00300F -> $0001                TXE0            EQU     $01
00140F 00300F -> $0147                CANTIER         EQU     $0147
00140F 00300F -> $0004                TXEIE2          EQU     $04
00140F 00300F -> $0002                TXEIE1          EQU     $02
00140F 00300F -> $0001                TXEIE0          EQU     $01
00140F 00300F -> $0148                CANTARQ         EQU     $0148
00140F 00300F -> $0004                ABTRQ2          EQU     $04
00140F 00300F -> $0002                ABTRQ1          EQU     $02
00140F 00300F -> $0001                ABTRQ0          EQU     $01
00140F 00300F -> $0149                CANTAAK         EQU     $0149
00140F 00300F -> $0004                ABTAK2          EQU     $04
00140F 00300F -> $0002                ABTAK1          EQU     $02
00140F 00300F -> $0001                ABTAK0          EQU     $01
00140F 00300F -> $014A                CANTBSEL        EQU     $014A
00140F 00300F -> $0004                TX2             EQU     $04
00140F 00300F -> $0002                TX1             EQU     $02
00140F 00300F -> $0001                TX0             EQU     $01
00140F 00300F -> $014B                CANIDAC         EQU     $014B
00140F 00300F -> $0020                IDAM1           EQU     $20
00140F 00300F -> $0010                IDAM0           EQU     $10
00140F 00300F -> $0004                IDHIT2          EQU     $04
00140F 00300F -> $0002                IDHIT1          EQU     $02
00140F 00300F -> $0001                IDHIT0          EQU     $01
00140F 00300F -> $014E                CANRXERR        EQU     $014E
00140F 00300F -> $014F                CANTXERR        EQU     $014F
00140F 00300F -> $0150                CANIDAR0        EQU     $0150
00140F 00300F -> $0151                CANIDAR1        EQU     $0151
00140F 00300F -> $0152                CANIDAR2        EQU     $0152
00140F 00300F -> $0153                CANIDAR3        EQU     $0153
00140F 00300F -> $0154                CANIDMR0        EQU     $0154
00140F 00300F -> $0155                CANIDMR1        EQU     $0155
00140F 00300F -> $0156                CANIDMR2        EQU     $0156
00140F 00300F -> $0157                CANIDMR3        EQU     $0157
00140F 00300F -> $0158                CANIDAR4        EQU     $0158
00140F 00300F -> $0159                CANIDAR5        EQU     $0159
00140F 00300F -> $015A                CANIDAR6        EQU     $015A
00140F 00300F -> $015B                CANIDAR7        EQU     $015B
00140F 00300F -> $015C                CANIDMR4        EQU     $015C
00140F 00300F -> $015D                CANIDMR5        EQU     $015D
00140F 00300F -> $015E                CANIDMR6        EQU     $015E
00140F 00300F -> $015F                CANIDMR7        EQU     $015F
00140F 00300F -> $0160                CANRXIDR0       EQU     $0160
00140F 00300F -> $0161                CANRXIDR1       EQU     $0161
00140F 00300F -> $0162                CANRXIDR2       EQU     $0162
00140F 00300F -> $0163                CANRXIDR3       EQU     $0163
00140F 00300F -> $0164                CANRXDSR0       EQU     $0164
00140F 00300F -> $0165                CANRXDSR1       EQU     $0165
00140F 00300F -> $0166                CANRXDSR2       EQU     $0166
00140F 00300F -> $0167                CANRXDSR3       EQU     $0167
00140F 00300F -> $0168                CANRXDSR4       EQU     $0168
00140F 00300F -> $0169                CANRXDSR5       EQU     $0169
00140F 00300F -> $016A                CANRXDSR6       EQU     $016A
00140F 00300F -> $016B                CANRXDSR7       EQU     $016B
00140F 00300F -> $016C                CANRXDLR        EQU     $016C
00140F 00300F -> $016E                CANRTSRH        EQU     $016E
00140F 00300F -> $016F                CANRTSRL        EQU     $016F
00140F 00300F -> $0170                CANTXIDR0       EQU     $0170
00140F 00300F -> $0171                CANTXIDR1       EQU     $0171
00140F 00300F -> $0172                CANTXIDR2       EQU     $0172
00140F 00300F -> $0173                CANTXIDR3       EQU     $0173
00140F 00300F -> $0174                CANTXDSR0       EQU     $0174
00140F 00300F -> $0175                CANTXDSR1       EQU     $0175
00140F 00300F -> $0176                CANTXDSR2       EQU     $0176
00140F 00300F -> $0177                CANTXDSR3       EQU     $0177
00140F 00300F -> $0178                CANTXDSR4       EQU     $0178
00140F 00300F -> $0179                CANTXDSR5       EQU     $0179
00140F 00300F -> $017A                CANTXDSR6       EQU     $017A
00140F 00300F -> $017B                CANTXDSR7       EQU     $017B
00140F 00300F -> $017C                CANTXDLR        EQU     $017C
00140F 00300F -> $017D                CANTXTBPR       EQU     $017D
00140F 00300F -> $017E                CANTXTSRH       EQU     $017E
00140F 00300F -> $017F                CANTXTSRL       EQU     $017F
00140F 00300F -> $0240                PTT             EQU     $0240
00140F 00300F -> $0080                PTT7            EQU     $80
00140F 00300F -> $0040                PTT6            EQU     $40
00140F 00300F -> $0020                PTT5            EQU     $20
00140F 00300F -> $0010                PTT4            EQU     $10
00140F 00300F -> $0008                PTT3            EQU     $08
00140F 00300F -> $0004                PTT2            EQU     $04
00140F 00300F -> $0002                PTT1            EQU     $02
00140F 00300F -> $0001                PTT0            EQU     $01
00140F 00300F -> $0080                PT7             EQU     $80
00140F 00300F -> $0040                PT6             EQU     $40
00140F 00300F -> $0020                PT5             EQU     $20
00140F 00300F -> $0010                PT4             EQU     $10
00140F 00300F -> $0008                PT3             EQU     $08
00140F 00300F -> $0004                PT2             EQU     $04
00140F 00300F -> $0002                PT1             EQU     $02
00140F 00300F -> $0001                PT0             EQU     $01
00140F 00300F -> $0241                PTIT            EQU     $0241
00140F 00300F -> $0080                PTIT7           EQU     $80
00140F 00300F -> $0040                PTIT6           EQU     $40
00140F 00300F -> $0020                PTIT5           EQU     $20
00140F 00300F -> $0010                PTIT4           EQU     $10
00140F 00300F -> $0008                PTIT3           EQU     $08
00140F 00300F -> $0004                PTIT2           EQU     $04
00140F 00300F -> $0002                PTIT1           EQU     $02
00140F 00300F -> $0001                PTIT0           EQU     $01
00140F 00300F -> $0242                DDRT            EQU     $0242
00140F 00300F -> $0080                DDRT7           EQU     $80
00140F 00300F -> $0040                DDRT6           EQU     $40
00140F 00300F -> $0020                DDRT5           EQU     $20
00140F 00300F -> $0010                DDRT4           EQU     $10
00140F 00300F -> $0008                DDRT3           EQU     $08
00140F 00300F -> $0004                DDRT2           EQU     $04
00140F 00300F -> $0002                DDRT1           EQU     $02
00140F 00300F -> $0001                DDRT0           EQU     $01
00140F 00300F -> $0244                PERT            EQU     $0244
00140F 00300F -> $0080                PERT7           EQU     $80
00140F 00300F -> $0040                PERT6           EQU     $40
00140F 00300F -> $0020                PERT5           EQU     $20
00140F 00300F -> $0010                PERT4           EQU     $10
00140F 00300F -> $0008                PERT3           EQU     $08
00140F 00300F -> $0004                PERT2           EQU     $04
00140F 00300F -> $0002                PERT1           EQU     $02
00140F 00300F -> $0001                PERT0           EQU     $01
00140F 00300F -> $0245                PPST            EQU     $0245
00140F 00300F -> $0080                PPST7           EQU     $80
00140F 00300F -> $0040                PPST6           EQU     $40
00140F 00300F -> $0020                PPST5           EQU     $20
00140F 00300F -> $0010                PPST4           EQU     $10
00140F 00300F -> $0008                PPST3           EQU     $08
00140F 00300F -> $0004                PPST2           EQU     $04
00140F 00300F -> $0002                PPST1           EQU     $02
00140F 00300F -> $0001                PPST0           EQU     $01
00140F 00300F -> $0248                PTS             EQU     $0248
00140F 00300F -> $0080                PTS7            EQU     $80
00140F 00300F -> $0040                PTS6            EQU     $40
00140F 00300F -> $0020                PTS5            EQU     $20
00140F 00300F -> $0010                PTS4            EQU     $10
00140F 00300F -> $0008                PTS3            EQU     $08
00140F 00300F -> $0004                PTS2            EQU     $04
00140F 00300F -> $0002                PTS1            EQU     $02
00140F 00300F -> $0001                PTS0            EQU     $01
00140F 00300F -> $0080                PS7             EQU     $80
00140F 00300F -> $0040                PS6             EQU     $40
00140F 00300F -> $0020                PS5             EQU     $20
00140F 00300F -> $0010                PS4             EQU     $10
00140F 00300F -> $0008                PS3             EQU     $08
00140F 00300F -> $0004                PS2             EQU     $04
00140F 00300F -> $0002                PS1             EQU     $02
00140F 00300F -> $0001                PS0             EQU     $01
00140F 00300F -> $0249                PTIS            EQU     $0249
00140F 00300F -> $0080                PTIS7           EQU     $80
00140F 00300F -> $0040                PTIS6           EQU     $40
00140F 00300F -> $0020                PTIS5           EQU     $20
00140F 00300F -> $0010                PTIS4           EQU     $10
00140F 00300F -> $0008                PTIS3           EQU     $08
00140F 00300F -> $0004                PTIS2           EQU     $04
00140F 00300F -> $0002                PTIS1           EQU     $02
00140F 00300F -> $0001                PTIS0           EQU     $01
00140F 00300F -> $024A                DDRS            EQU     $024A
00140F 00300F -> $0080                DDRS7           EQU     $80
00140F 00300F -> $0040                DDRS6           EQU     $40
00140F 00300F -> $0020                DDRS5           EQU     $20
00140F 00300F -> $0010                DDRS4           EQU     $10
00140F 00300F -> $0008                DDRS3           EQU     $08
00140F 00300F -> $0004                DDRS2           EQU     $04
00140F 00300F -> $0002                DDRS1           EQU     $02
00140F 00300F -> $0001                DDRS0           EQU     $01
00140F 00300F -> $024C                PERS            EQU     $024C
00140F 00300F -> $0080                PERS7           EQU     $80
00140F 00300F -> $0040                PERS6           EQU     $40
00140F 00300F -> $0020                PERS5           EQU     $20
00140F 00300F -> $0010                PERS4           EQU     $10
00140F 00300F -> $0008                PERS3           EQU     $08
00140F 00300F -> $0004                PERS2           EQU     $04
00140F 00300F -> $0002                PERS1           EQU     $02
00140F 00300F -> $0001                PERS0           EQU     $01
00140F 00300F -> $024D                PPSS            EQU     $024D
00140F 00300F -> $0080                PPSS7           EQU     $80
00140F 00300F -> $0040                PPSS6           EQU     $40
00140F 00300F -> $0020                PPSS5           EQU     $20
00140F 00300F -> $0010                PPSS4           EQU     $10
00140F 00300F -> $0008                PPSS3           EQU     $08
00140F 00300F -> $0004                PPSS2           EQU     $04
00140F 00300F -> $0002                PPSS1           EQU     $02
00140F 00300F -> $0001                PPSS0           EQU     $01
00140F 00300F -> $024E                WOMS            EQU     $024E
00140F 00300F -> $0080                WOMS7           EQU     $80
00140F 00300F -> $0040                WOMS6           EQU     $40
00140F 00300F -> $0020                WOMS5           EQU     $20
00140F 00300F -> $0010                WOMS4           EQU     $10
00140F 00300F -> $0008                WOMS3           EQU     $08
00140F 00300F -> $0004                WOMS2           EQU     $04
00140F 00300F -> $0002                WOMS1           EQU     $02
00140F 00300F -> $0001                WOMS0           EQU     $01
00140F 00300F -> $024F                PRR0            EQU     $024F
00140F 00300F -> $0080                PRR0P3          EQU     $80
00140F 00300F -> $0040                PRR0P2          EQU     $40
00140F 00300F -> $0020                PRR0T31         EQU     $20
00140F 00300F -> $0010                PRR0T30         EQU     $10
00140F 00300F -> $0008                PRR0T21         EQU     $08
00140F 00300F -> $0004                PRR0T20         EQU     $04
00140F 00300F -> $0002                PRR0S1          EQU     $02
00140F 00300F -> $0001                PRR0S0          EQU     $01
00140F 00300F -> $0250                PTM             EQU     $0250
00140F 00300F -> $0008                PTM3            EQU     $08
00140F 00300F -> $0004                PTM2            EQU     $04
00140F 00300F -> $0002                PTM1            EQU     $02
00140F 00300F -> $0001                PTM0            EQU     $01
00140F 00300F -> $0008                PM3             EQU     $08
00140F 00300F -> $0004                PM2             EQU     $04
00140F 00300F -> $0002                PM1             EQU     $02
00140F 00300F -> $0001                PM0             EQU     $01
00140F 00300F -> $0251                PTIM            EQU     $0251
00140F 00300F -> $0008                PTIM3           EQU     $08
00140F 00300F -> $0004                PTIM2           EQU     $04
00140F 00300F -> $0002                PTIM1           EQU     $02
00140F 00300F -> $0001                PTIM0           EQU     $01
00140F 00300F -> $0252                DDRM            EQU     $0252
00140F 00300F -> $0008                DDRM3           EQU     $08
00140F 00300F -> $0004                DDRM2           EQU     $04
00140F 00300F -> $0002                DDRM1           EQU     $02
00140F 00300F -> $0001                DDRM0           EQU     $01
00140F 00300F -> $0254                PERM            EQU     $0254
00140F 00300F -> $0008                PERM3           EQU     $08
00140F 00300F -> $0004                PERM2           EQU     $04
00140F 00300F -> $0002                PERM1           EQU     $02
00140F 00300F -> $0001                PERM0           EQU     $01
00140F 00300F -> $0255                PPSM            EQU     $0255
00140F 00300F -> $0008                PPSM3           EQU     $08
00140F 00300F -> $0004                PPSM2           EQU     $04
00140F 00300F -> $0002                PPSM1           EQU     $02
00140F 00300F -> $0001                PPSM0           EQU     $01
00140F 00300F -> $0256                WOMM            EQU     $0256
00140F 00300F -> $0008                WOMM3           EQU     $08
00140F 00300F -> $0004                WOMM2           EQU     $04
00140F 00300F -> $0002                WOMM1           EQU     $02
00140F 00300F -> $0001                WOMM0           EQU     $01
00140F 00300F -> $0257                PKGCR           EQU     $0257
00140F 00300F -> $0080                APICLKS7        EQU     $80
00140F 00300F -> $0004                PKGCR2          EQU     $04
00140F 00300F -> $0002                PKGCR1          EQU     $02
00140F 00300F -> $0001                PKGCR0          EQU     $01
00140F 00300F -> $0258                PTP             EQU     $0258
00140F 00300F -> $0080                PTP7            EQU     $80
00140F 00300F -> $0040                PTP6            EQU     $40
00140F 00300F -> $0020                PTP5            EQU     $20
00140F 00300F -> $0010                PTP4            EQU     $10
00140F 00300F -> $0008                PTP3            EQU     $08
00140F 00300F -> $0004                PTP2            EQU     $04
00140F 00300F -> $0002                PTP1            EQU     $02
00140F 00300F -> $0001                PTP0            EQU     $01
00140F 00300F -> $0080                PP7             EQU     $80
00140F 00300F -> $0040                PP6             EQU     $40
00140F 00300F -> $0020                PP5             EQU     $20
00140F 00300F -> $0010                PP4             EQU     $10
00140F 00300F -> $0008                PP3             EQU     $08
00140F 00300F -> $0004                PP2             EQU     $04
00140F 00300F -> $0002                PP1             EQU     $02
00140F 00300F -> $0001                PP0             EQU     $01
00140F 00300F -> $0259                PTIP            EQU     $0259
00140F 00300F -> $0080                PTIP7           EQU     $80
00140F 00300F -> $0040                PTIP6           EQU     $40
00140F 00300F -> $0020                PTIP5           EQU     $20
00140F 00300F -> $0010                PTIP4           EQU     $10
00140F 00300F -> $0008                PTIP3           EQU     $08
00140F 00300F -> $0004                PTIP2           EQU     $04
00140F 00300F -> $0002                PTIP1           EQU     $02
00140F 00300F -> $0001                PTIP0           EQU     $01
00140F 00300F -> $025A                DDRP            EQU     $025A
00140F 00300F -> $0080                DDRP7           EQU     $80
00140F 00300F -> $0040                DDRP6           EQU     $40
00140F 00300F -> $0020                DDRP5           EQU     $20
00140F 00300F -> $0010                DDRP4           EQU     $10
00140F 00300F -> $0008                DDRP3           EQU     $08
00140F 00300F -> $0004                DDRP2           EQU     $04
00140F 00300F -> $0002                DDRP1           EQU     $02
00140F 00300F -> $0001                DDRP0           EQU     $01
00140F 00300F -> $025C                PERP            EQU     $025C
00140F 00300F -> $0080                PERP7           EQU     $80
00140F 00300F -> $0040                PERP6           EQU     $40
00140F 00300F -> $0020                PERP5           EQU     $20
00140F 00300F -> $0010                PERP4           EQU     $10
00140F 00300F -> $0008                PERP3           EQU     $08
00140F 00300F -> $0004                PERP2           EQU     $04
00140F 00300F -> $0002                PERP1           EQU     $02
00140F 00300F -> $0001                PERP0           EQU     $01
00140F 00300F -> $025D                PPSP            EQU     $025D
00140F 00300F -> $0080                PPSP7           EQU     $80
00140F 00300F -> $0040                PPSP6           EQU     $40
00140F 00300F -> $0020                PPSP5           EQU     $20
00140F 00300F -> $0010                PPSP4           EQU     $10
00140F 00300F -> $0008                PPSP3           EQU     $08
00140F 00300F -> $0004                PPSP2           EQU     $04
00140F 00300F -> $0002                PPSP1           EQU     $02
00140F 00300F -> $0001                PPSP0           EQU     $01
00140F 00300F -> $025E                PIEP            EQU     $025E
00140F 00300F -> $0080                PIEP7           EQU     $80
00140F 00300F -> $0040                PIEP6           EQU     $40
00140F 00300F -> $0020                PIEP5           EQU     $20
00140F 00300F -> $0010                PIEP4           EQU     $10
00140F 00300F -> $0008                PIEP3           EQU     $08
00140F 00300F -> $0004                PIEP2           EQU     $04
00140F 00300F -> $0002                PIEP1           EQU     $02
00140F 00300F -> $0001                PIEP0           EQU     $01
00140F 00300F -> $025F                PIFP            EQU     $025F
00140F 00300F -> $0080                PIFP7           EQU     $80
00140F 00300F -> $0040                PIFP6           EQU     $40
00140F 00300F -> $0020                PIFP5           EQU     $20
00140F 00300F -> $0010                PIFP4           EQU     $10
00140F 00300F -> $0008                PIFP3           EQU     $08
00140F 00300F -> $0004                PIFP2           EQU     $04
00140F 00300F -> $0002                PIFP1           EQU     $02
00140F 00300F -> $0001                PIFP0           EQU     $01
00140F 00300F -> $0260                ACMPC           EQU     $260
00140F 00300F -> $0080                ACIE            EQU     $80
00140F 00300F -> $0040                ACOPE           EQU     $40
00140F 00300F -> $0020                ACICE           EQU     $20
00140F 00300F -> $0008                ACMOD1          EQU     $08
00140F 00300F -> $0004                ACMOD0          EQU     $04
00140F 00300F -> $0001                ACE             EQU     $01
00140F 00300F -> $0261                ACMPS           EQU     $261
00140F 00300F -> $0080                ACIF            EQU     $80
00140F 00300F -> $0040                ACO             EQU     $40
00140F 00300F -> $0268                PTJ             EQU     $0268
00140F 00300F -> $0080                PTJ7            EQU     $80
00140F 00300F -> $0040                PTJ6            EQU     $40
00140F 00300F -> $0020                PTJ5            EQU     $20
00140F 00300F -> $0010                PTJ4            EQU     $10
00140F 00300F -> $0008                PTJ3            EQU     $08
00140F 00300F -> $0004                PTJ2            EQU     $04
00140F 00300F -> $0002                PTJ1            EQU     $02
00140F 00300F -> $0001                PTJ0            EQU     $01
00140F 00300F -> $0080                PJ7             EQU     $80
00140F 00300F -> $0040                PJ6             EQU     $40
00140F 00300F -> $0020                PJ5             EQU     $20
00140F 00300F -> $0010                PJ4             EQU     $10
00140F 00300F -> $0008                PJ3             EQU     $08
00140F 00300F -> $0004                PJ2             EQU     $04
00140F 00300F -> $0002                PJ1             EQU     $02
00140F 00300F -> $0001                PJ0             EQU     $01
00140F 00300F -> $0269                PTIJ            EQU     $0269
00140F 00300F -> $0080                PTIJ7           EQU     $80
00140F 00300F -> $0040                PTIJ6           EQU     $40
00140F 00300F -> $0020                PTIJ5           EQU     $20
00140F 00300F -> $0010                PTIJ4           EQU     $10
00140F 00300F -> $0008                PTIJ3           EQU     $08
00140F 00300F -> $0004                PTIJ2           EQU     $04
00140F 00300F -> $0002                PTIJ1           EQU     $02
00140F 00300F -> $0001                PTIJ0           EQU     $01
00140F 00300F -> $026A                DDRJ            EQU     $026A
00140F 00300F -> $0080                DDRJ7           EQU     $80
00140F 00300F -> $0040                DDRJ6           EQU     $40
00140F 00300F -> $0020                DDRJ5           EQU     $20
00140F 00300F -> $0010                DDRJ4           EQU     $10
00140F 00300F -> $0008                DDRJ3           EQU     $08
00140F 00300F -> $0004                DDRJ2           EQU     $04
00140F 00300F -> $0002                DDRJ1           EQU     $02
00140F 00300F -> $0001                DDRJ0           EQU     $01
00140F 00300F -> $026C                PERJ            EQU     $026C
00140F 00300F -> $0080                PERJ7           EQU     $80
00140F 00300F -> $0040                PERJ6           EQU     $40
00140F 00300F -> $0020                PERJ5           EQU     $20
00140F 00300F -> $0010                PERJ4           EQU     $10
00140F 00300F -> $0008                PERJ3           EQU     $08
00140F 00300F -> $0004                PERJ2           EQU     $04
00140F 00300F -> $0002                PERJ1           EQU     $02
00140F 00300F -> $0001                PERJ0           EQU     $01
00140F 00300F -> $026D                PPSJ            EQU     $026D
00140F 00300F -> $0080                PPSJ7           EQU     $80
00140F 00300F -> $0040                PPSJ6           EQU     $40
00140F 00300F -> $0020                PPSJ5           EQU     $20
00140F 00300F -> $0010                PPSJ4           EQU     $10
00140F 00300F -> $0008                PPSJ3           EQU     $08
00140F 00300F -> $0004                PPSJ2           EQU     $04
00140F 00300F -> $0002                PPSJ1           EQU     $02
00140F 00300F -> $0001                PPSJ0           EQU     $01
00140F 00300F -> $026E                PIEJ            EQU     $026E
00140F 00300F -> $0080                PIEJ7           EQU     $80
00140F 00300F -> $0040                PIEJ6           EQU     $40
00140F 00300F -> $0020                PIEJ5           EQU     $20
00140F 00300F -> $0010                PIEJ4           EQU     $10
00140F 00300F -> $0008                PIEJ3           EQU     $08
00140F 00300F -> $0004                PIEJ2           EQU     $04
00140F 00300F -> $0002                PIEJ1           EQU     $02
00140F 00300F -> $0001                PIEJ0           EQU     $01
00140F 00300F -> $026F                PIFJ            EQU     $026F
00140F 00300F -> $0080                PIFJ7           EQU     $80
00140F 00300F -> $0040                PIFJ6           EQU     $40
00140F 00300F -> $0020                PIFJ5           EQU     $20
00140F 00300F -> $0010                PIFJ4           EQU     $10
00140F 00300F -> $0008                PIFJ3           EQU     $08
00140F 00300F -> $0004                PIFJ2           EQU     $04
00140F 00300F -> $0002                PIFJ1           EQU     $02
00140F 00300F -> $0001                PIFJ0           EQU     $01
00140F 00300F -> $0270                PT0AD           EQU     $0270
00140F 00300F -> $0080                PT0AD7          EQU     $80
00140F 00300F -> $0040                PT0AD6          EQU     $40
00140F 00300F -> $0020                PT0AD5          EQU     $20
00140F 00300F -> $0010                PT0AD4          EQU     $10
00140F 00300F -> $0008                PT0AD3          EQU     $08
00140F 00300F -> $0004                PT0AD2          EQU     $04
00140F 00300F -> $0002                PT0AD1          EQU     $02
00140F 00300F -> $0001                PT0AD0          EQU     $01
00140F 00300F -> $0271                PT1AD           EQU     $0271
00140F 00300F -> $0080                PT1AD7          EQU     $80
00140F 00300F -> $0040                PT1AD6          EQU     $40
00140F 00300F -> $0020                PT1AD5          EQU     $20
00140F 00300F -> $0010                PT1AD4          EQU     $10
00140F 00300F -> $0008                PT1AD3          EQU     $08
00140F 00300F -> $0004                PT1AD2          EQU     $04
00140F 00300F -> $0002                PT1AD1          EQU     $02
00140F 00300F -> $0001                PT1AD0          EQU     $01
00140F 00300F -> $0272                PTI0AD          EQU     $0272
00140F 00300F -> $0080                PTI0AD7         EQU     $80
00140F 00300F -> $0040                PTI0AD6         EQU     $40
00140F 00300F -> $0020                PTI0AD5         EQU     $20
00140F 00300F -> $0010                PTI0AD4         EQU     $10
00140F 00300F -> $0008                PTI0AD3         EQU     $08
00140F 00300F -> $0004                PTI0AD2         EQU     $04
00140F 00300F -> $0002                PTI0AD1         EQU     $02
00140F 00300F -> $0001                PTI0AD0         EQU     $01
00140F 00300F -> $0273                PTI1AD          EQU     $0273
00140F 00300F -> $0080                PTI1AD7         EQU     $80
00140F 00300F -> $0040                PTI1AD6         EQU     $40
00140F 00300F -> $0020                PTI1AD5         EQU     $20
00140F 00300F -> $0010                PTI1AD4         EQU     $10
00140F 00300F -> $0008                PTI1AD3         EQU     $08
00140F 00300F -> $0004                PTI1AD2         EQU     $04
00140F 00300F -> $0002                PTI1AD1         EQU     $02
00140F 00300F -> $0001                PTI1AD0         EQU     $01
00140F 00300F -> $0274                DDR0AD          EQU     $0274
00140F 00300F -> $0080                DDR0AD7         EQU     $80
00140F 00300F -> $0040                DDR0AD6         EQU     $40
00140F 00300F -> $0020                DDR0AD5         EQU     $20
00140F 00300F -> $0010                DDR0AD4         EQU     $10
00140F 00300F -> $0008                DDR0AD3         EQU     $08
00140F 00300F -> $0004                DDR0AD2         EQU     $04
00140F 00300F -> $0002                DDR0AD1         EQU     $02
00140F 00300F -> $0001                DDR0AD0         EQU     $01
00140F 00300F -> $0275                DDR1AD          EQU     $0275
00140F 00300F -> $0080                DDR1AD7         EQU     $80
00140F 00300F -> $0040                DDR1AD6         EQU     $40
00140F 00300F -> $0020                DDR1AD5         EQU     $20
00140F 00300F -> $0010                DDR1AD4         EQU     $10
00140F 00300F -> $0008                DDR1AD3         EQU     $08
00140F 00300F -> $0004                DDR1AD2         EQU     $04
00140F 00300F -> $0002                DDR1AD1         EQU     $02
00140F 00300F -> $0001                DDR1AD0         EQU     $01
00140F 00300F -> $0276                RVACTL          EQU     $0276
00140F 00300F -> $0001                RVAON           EQU     $01
00140F 00300F -> $0277                PRR1            EQU     $0277
00140F 00300F -> $0001                PRR1AN          EQU     $01
00140F 00300F -> $0278                PER0AD          EQU     $0278
00140F 00300F -> $0080                PER0AD7         EQU     $80
00140F 00300F -> $0040                PER0AD6         EQU     $40
00140F 00300F -> $0020                PER0AD5         EQU     $20
00140F 00300F -> $0010                PER0AD4         EQU     $10
00140F 00300F -> $0008                PER0AD3         EQU     $08
00140F 00300F -> $0004                PER0AD2         EQU     $04
00140F 00300F -> $0002                PER0AD1         EQU     $02
00140F 00300F -> $0001                PER0AD0         EQU     $01
00140F 00300F -> $0279                PER1AD          EQU     $0279
00140F 00300F -> $0080                PER1AD7         EQU     $80
00140F 00300F -> $0040                PER1AD6         EQU     $40
00140F 00300F -> $0020                PER1AD5         EQU     $20
00140F 00300F -> $0010                PER1AD4         EQU     $10
00140F 00300F -> $0008                PER1AD3         EQU     $08
00140F 00300F -> $0004                PER1AD2         EQU     $04
00140F 00300F -> $0002                PER1AD1         EQU     $02
00140F 00300F -> $0001                PER1AD0         EQU     $01
00140F 00300F -> $027A                PPS0AD          EQU     $027A
00140F 00300F -> $0080                PPS0AD7         EQU     $80
00140F 00300F -> $0040                PPS0AD6         EQU     $40
00140F 00300F -> $0020                PPS0AD5         EQU     $20
00140F 00300F -> $0010                PPS0AD4         EQU     $10
00140F 00300F -> $0008                PPS0AD3         EQU     $08
00140F 00300F -> $0004                PPS0AD2         EQU     $04
00140F 00300F -> $0002                PPS0AD1         EQU     $02
00140F 00300F -> $0001                PPS0AD0         EQU     $01
00140F 00300F -> $027B                PPS1AD          EQU     $027B
00140F 00300F -> $0080                PPS1AD7         EQU     $80
00140F 00300F -> $0040                PPS1AD6         EQU     $40
00140F 00300F -> $0020                PPS1AD5         EQU     $20
00140F 00300F -> $0010                PPS1AD4         EQU     $10
00140F 00300F -> $0008                PPS1AD3         EQU     $08
00140F 00300F -> $0004                PPS1AD2         EQU     $04
00140F 00300F -> $0002                PPS1AD1         EQU     $02
00140F 00300F -> $0001                PPS1AD0         EQU     $01
00140F 00300F -> $027C                PIE0AD          EQU     $027C
00140F 00300F -> $0080                PIE0AD7         EQU     $80
00140F 00300F -> $0040                PIE0AD6         EQU     $40
00140F 00300F -> $0020                PIE0AD5         EQU     $20
00140F 00300F -> $0010                PIE0AD4         EQU     $10
00140F 00300F -> $0008                PIE0AD3         EQU     $08
00140F 00300F -> $0004                PIE0AD2         EQU     $04
00140F 00300F -> $0002                PIE0AD1         EQU     $02
00140F 00300F -> $0001                PIE0AD0         EQU     $01
00140F 00300F -> $027D                PIE1AD          EQU     $027D
00140F 00300F -> $0080                PIE1AD7         EQU     $80
00140F 00300F -> $0040                PIE1AD6         EQU     $40
00140F 00300F -> $0020                PIE1AD5         EQU     $20
00140F 00300F -> $0010                PIE1AD4         EQU     $10
00140F 00300F -> $0008                PIE1AD3         EQU     $08
00140F 00300F -> $0004                PIE1AD2         EQU     $04
00140F 00300F -> $0002                PIE1AD1         EQU     $02
00140F 00300F -> $0001                PIE1AD0         EQU     $01
00140F 00300F -> $027E                PIF0AD          EQU     $027E
00140F 00300F -> $0080                PIF0AD7         EQU     $80
00140F 00300F -> $0040                PIF0AD6         EQU     $40
00140F 00300F -> $0020                PIF0AD5         EQU     $20
00140F 00300F -> $0010                PIF0AD4         EQU     $10
00140F 00300F -> $0008                PIF0AD3         EQU     $08
00140F 00300F -> $0004                PIF0AD2         EQU     $04
00140F 00300F -> $0002                PIF0AD1         EQU     $02
00140F 00300F -> $0001                PIF0AD0         EQU     $01
00140F 00300F -> $027F                PIF1AD          EQU     $027F
00140F 00300F -> $0080                PIF1AD7         EQU     $80
00140F 00300F -> $0040                PIF1AD6         EQU     $40
00140F 00300F -> $0020                PIF1AD5         EQU     $20
00140F 00300F -> $0010                PIF1AD4         EQU     $10
00140F 00300F -> $0008                PIF1AD3         EQU     $08
00140F 00300F -> $0004                PIF1AD2         EQU     $04
00140F 00300F -> $0002                PIF1AD1         EQU     $02
00140F 00300F -> $0001                PIF1AD0         EQU     $01
00140F 00300F -> $02F1                CPMULVCTL       EQU     $02F1
00140F 00300F -> $0004                LVDS            EQU     $04
00140F 00300F -> $0002                LVIE            EQU     $02
00140F 00300F -> $0001                LVIF            EQU     $01
00140F 00300F -> $02F2                CPMUAPICTL      EQU     $02F2
00140F 00300F -> $0080                APICLK          EQU     $80
00140F 00300F -> $0010                APIES           EQU     $10
00140F 00300F -> $0008                APIEA           EQU     $08
00140F 00300F -> $0004                APIFE           EQU     $04
00140F 00300F -> $0002                APIE            EQU     $02
00140F 00300F -> $0001                APIF            EQU     $01
00140F 00300F -> $02F3                CPMUAPITR       EQU     $02F3
00140F 00300F -> $0080                APITR5          EQU     $80
00140F 00300F -> $0040                APITR4          EQU     $40
00140F 00300F -> $0020                APITR3          EQU     $20
00140F 00300F -> $0010                APITR2          EQU     $10
00140F 00300F -> $0008                APITR1          EQU     $08
00140F 00300F -> $0004                APITR0          EQU     $04
00140F 00300F -> $02F4                CPMUAPIRH       EQU     $02F4
00140F 00300F -> $0080                APIR15          EQU     $80
00140F 00300F -> $0040                APIR14          EQU     $40
00140F 00300F -> $0020                APIR13          EQU     $20
00140F 00300F -> $0010                APIR12          EQU     $10
00140F 00300F -> $0008                APIR11          EQU     $08
00140F 00300F -> $0004                APIR10          EQU     $04
00140F 00300F -> $0002                APIR9           EQU     $02
00140F 00300F -> $0001                APIR8           EQU     $01
00140F 00300F -> $02F5                CPMUAPIRL       EQU     $02F5
00140F 00300F -> $0080                APIR7           EQU     $80
00140F 00300F -> $0040                APIR6           EQU     $40
00140F 00300F -> $0020                APIR5           EQU     $20
00140F 00300F -> $0010                APIR4           EQU     $10
00140F 00300F -> $0008                APIR3           EQU     $08
00140F 00300F -> $0004                APIR2           EQU     $04
00140F 00300F -> $0002                APIR1           EQU     $02
00140F 00300F -> $0001                APIR0           EQU     $01
00140F 00300F -> $02F8                CPMUIRCTRIMH    EQU     $02F8
00140F 00300F -> $0080                TCTRIM3         EQU     $80
00140F 00300F -> $0040                TCTRIM2         EQU     $40
00140F 00300F -> $0020                TCTRIM1         EQU     $20
00140F 00300F -> $0010                TCTRIM0         EQU     $10
00140F 00300F -> $0002                IRCTRIM9        EQU     $02
00140F 00300F -> $0001                IRCTRIM8        EQU     $01
00140F 00300F -> $02F9                CPMUIRCTRIML    EQU     $02F9
00140F 00300F -> $0080                IRCTRIM7        EQU     $80
00140F 00300F -> $0040                IRCTRIM6        EQU     $40
00140F 00300F -> $0020                IRCTRIM5        EQU     $20
00140F 00300F -> $0010                IRCTRIM4        EQU     $10
00140F 00300F -> $0008                IRCTRIM3        EQU     $08
00140F 00300F -> $0004                IRCTRIM2        EQU     $04
00140F 00300F -> $0002                IRCTRIM1        EQU     $02
00140F 00300F -> $0001                IRCTRIM0        EQU     $01
00140F 00300F -> $02FA                CPMUOSC         EQU     $02FA
00140F 00300F -> $0080                OSCE            EQU     $80
00140F 00300F -> $0020                OSCPINS_EN      EQU     $20
00140F 00300F -> $02FB                CPMUPROT        EQU     $02FB
00140F 00300F -> $0001                PROT            EQU     $01
00140F 00300F -> $03C0                DAC0CTL         EQU     $03C0
00140F 00300F -> $0080                FVR             EQU     $80
00140F 00300F -> $0040                DRIVE           EQU     $40
00140F 00300F -> $0004                MODE2           EQU     $04
00140F 00300F -> $0002                MODE1           EQU     $02
00140F 00300F -> $0001                MODE0           EQU     $01
00140F 00300F -> $03C2                DAC0VOLTAGE     EQU     $03C2
00140F 00300F -> $0080                VOLTAGE7        EQU     $80
00140F 00300F -> $0040                VOLTAGE6        EQU     $40
00140F 00300F -> $0020                VOLTAGE5        EQU     $20
00140F 00300F -> $0010                VOLTAGE4        EQU     $10
00140F 00300F -> $0008                VOLTAGE3        EQU     $08
00140F 00300F -> $0004                VOLTAGE2        EQU     $04
00140F 00300F -> $0002                VOLTAGE1        EQU     $02
00140F 00300F -> $0001                VOLTAGE0        EQU     $01
00140F 00300F -> $03C8                DAC1CTL         EQU     $03C8
00140F 00300F -> $03CA                DAC1VOLTAGE     EQU     $03CA
                                      ;###############################################################################
                                      ;# Configuration                                                               #
                                      ;###############################################################################
                                      ;# MCU (S12G32, S12G64, S12G128, or S12G240)
00140F 00300F -> $0001                MMAP_S12G240            EQU     1       ;default is S12G240
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;# Memory Sizes:
00140F 00300F -> $0400                MMAP_REG_SIZE           EQU      $0400  ;  1k
00140F 00300F -> $1000                MMAP_EEPROM_SIZE        EQU      $1000  ;  4k
00140F 00300F -> $2C00                MMAP_RAM_SIZE           EQU      $2C00  ; 11k
00140F 00300F -> $3C000               MMAP_FLASH_SIZE         EQU     $3C000  ;240k
                                      ;# Memory Locations
00140F 00300F -> $0000                MMAP_REG_START          EQU     $0000
00140F 00300F -> $0400                MMAP_REG_END            EQU     $0400
00140F 00300F -> $0000                MMAP_REG_START_LIN      EQU     MMAP_REG_START
00140F 00300F -> $0400                MMAP_REG_END_LIN        EQU     MMAP_REG_END
00140F 00300F -> $0400                MMAP_EEPROM_START       EQU     $0400
00140F 00300F -> $1400                MMAP_EEPROM_END         EQU     $0400+MMAP_EEPROM_SIZE
00140F 00300F -> $0400                MMAP_EEPROM_START_LIN   EQU     MMAP_EEPROM_START
00140F 00300F -> $1400                MMAP_EEPROM_END_LIN     EQU     MMAP_EEPROM_END
00140F 00300F -> $1400                MMAP_RAM_START          EQU     $4000-MMAP_RAM_SIZE
00140F 00300F -> $4000                MMAP_RAM_END            EQU     $4000
00140F 00300F -> $1400                MMAP_RAM_START_LIN      EQU     MMAP_RAM_START
00140F 00300F -> $4000                MMAP_RAM_END_LIN        EQU     MMAP_RAM_END
00140F 00300F -> $8000                MMAP_FLASHWIN_START     EQU     $8000
00140F 00300F -> $C000                MMAP_FLASHWIN_END       EQU     $C000
00140F 00300F -> $1400                MMAP_FLASH_C_START      EQU     MMAP_EEPROM_END
00140F 00300F -> $1400                MMAP_FLASH_C_END        EQU     MMAP_RAM_START
00140F 00300F -> $31400               MMAP_FLASH_C_START_LIN  EQU     $3_0000+MMAP_FLASH_C_START
00140F 00300F -> $31400               MMAP_FLASH_C_END_LIN    EQU     $3_0000+MMAP_FLASH_C_END
00140F 00300F -> $4000                MMAP_FLASH_D_START      EQU     $4000
00140F 00300F -> $8000                MMAP_FLASH_D_END        EQU     $8000
00140F 00300F -> $34000               MMAP_FLASH_D_START_LIN  EQU     $3_4000
00140F 00300F -> $38000               MMAP_FLASH_D_END_LIN    EQU     $3_8000
00140F 00300F -> $C000                MMAP_FLASH_F_START      EQU     $C000
00140F 00300F -> $10000               MMAP_FLASH_F_END        EQU     $1_0000
00140F 00300F -> $3C000               MMAP_FLASH_F_START_LIN  EQU     $3_C000
00140F 00300F -> $40000               MMAP_FLASH_F_END_LIN    EQU     $4_0000
                                      ;# Bootloader
00140F 00300F -> $F000                BOOTLOADER_START        EQU     MMAP_FLASH_F_END-BOOTLOADER_SIZE
00140F 00300F -> $3F000               BOOTLOADER_START_LIN    EQU     MMAP_FLASH_F_END_LIN-BOOTLOADER_SIZE
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     MMAP_VARS_START, MMAP_VARS_START_LIN
00198B 00198B -> $198B                MMAP_VARS_END           EQU     *
00198B 00198B -> $198B                MMAP_VARS_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
003784 003784                                                 ORG     MMAP_CODE_START, MMAP_CODE_START_LIN
003784 003784 -> $3784                MMAP_CODE_END           EQU     *
003784 003784 -> $3784                MMAP_CODE_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     MMAP_TABS_START, MMAP_TABS_START_LIN
003926 003926 -> $3926                MMAP_TABS_END           EQU     *
003926 003926 -> $3926                MMAP_TABS_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     GPIO_VARS_START, GPIO_VARS_START_LIN
00198B 00198B -> $198B                GPIO_VARS_END           EQU     *
00198B 00198B -> $198B                GPIO_VARS_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
003784 003784                                                 ORG     GPIO_CODE_START, GPIO_CODE_START_LIN
003784 003784 -> $3784                GPIO_CODE_END           EQU     *
003784 003784 -> $3784                GPIO_CODE_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     GPIO_TABS_START, GPIO_TABS_START_LIN
003926 003926 -> $3926                GPIO_TABS_END           EQU     *
003926 003926 -> $3926                GPIO_TABS_END_LIN       EQU     @
                                      ;#Baud rate
003926 003926 -> $B71B00              DISP_BAUD               EQU     12000000        ;default is 12 Mbit/s
                                      ;#RESET output
003926 003926 -> $0248                DISP_RESET_PORT         EQU     PTS             ;default is port S
003926 003926 -> $0008                DISP_RESET_PIN          EQU     PS3             ;default is PS3
                                      ;#A0 output
003926 003926 -> $0248                DISP_A0_PORT            EQU     PTS             ;default is port S
003926 003926 -> $0010                DISP_A0_PIN             EQU     PS4             ;default is PS4
                                      ;#Buffer size
003926 003926 -> $0010                DISP_BUF_SIZE           EQU     16              ;depth of the command buffer
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;#Baud rate divider
003926 003926 -> $0000                DISP_SPPR               EQU     ((CLOCK_BUS_FREQ/(2*DISP_BAUD))-1)&7
003926 003926 -> $0000                DISP_SPR                EQU     0
                                      ;#SPI configuration
003926 003926 -> $001E                DISP_SPICR1_CONFIG      EQU     %00011110       ;only SPE and SPTIE will be modified
                                                                      ;SSSMCCSL
                                                                      ;PPPSPPSS
                                                                      ;IETTOHOB
                                                                      ;E IRLAEF
                                                                      ;  E    E
003926 003926 -> $0019                DISP_SPICR2_CONFIG      EQU     %00011001
                                                                      ; X MB SS
                                                                      ; F OI PP
                                                                      ; R DD IC
                                                                      ; W FI S0
                                                                      ;   ER W
                                                                      ;   NO A
                                                                      ;    E I
003926 003926 -> $0000                DISP_SPIBR_CONFIG       EQU     ((DISP_SPPR<<4|(DISP_SPR)))
                                      ;#Escape sequences
003926 003926 -> $00E3                DISP_ESC_START          EQU     $E3             ;start of eccape sequence (NOP)
003926 003926 -> $00FF                DISP_ESC_ESC            EQU     $FF             ;transmit escape character
003926 003926 -> $00FE                DISP_ESC_CMD            EQU     $FE             ;switch to command mode
003926 003926 -> $00FD                DISP_ESC_DATA           EQU     $FD             ;switch to data mode
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
0019DA 0019DA                                                 ORG     DISP_VARS_START, DISP_VARS_START_LIN
0019DA 0019DA -> $19DA                DISP_AUTO_LOC1          EQU     *               ;1st auto-place location
0019DA 0019DA                                                 ALIGN   1
                                      ;#Command buffer
0019DA 0019DA                         DISP_BUF                DS      DISP_BUF_SIZE
0019EA 0019EA                         DISP_BUF_IN             DS      1               ;points to the next free space
0019EB 0019EB                         DISP_BUF_OUT            DS      1               ;points to the oldest entry
0019EC 0019EC -> $19EC                DISP_AUTO_LOC2          EQU     *               ;2nd auto-place location
0019EC 0019EC                                                 UNALIGN ((~DISP_AUTO_LOC1)&1)
                                      ;#Repeat counter (0=no repeat, $FF=handle escape character)
0019ED 0019ED -> $19EC                DISP_RPTCNT             EQU     ((DISP_AUTO_LOC1&1)*DISP_AUTO_LOC1)+((~(DISP_AUTO_LOC1)&1)*DISP_AUTO_LOC2)
0019ED 0019ED -> $19ED                DISP_VARS_END           EQU     *
0019ED 0019ED -> $19ED                DISP_VARS_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
003796 003796                                                 ORG     DISP_CODE_START, DISP_CODE_START_LIN
                                      ;# Essential functions
                                      ;---------------------
                                      ;#Transmit commands and data (non-blocking)
                                      ; args:   B: buffer entry
                                      ; result: C: 1 = successful, 0=buffer full
                                      ; SSTACK: 5 bytes
                                      ;         X, Y and D are preserved
003796 003796 -> $3796                DISP_TX_NB              EQU     *
                                                              ;Save registers (buffer entry in B)
003796 003796 34                                              PSHX                                                    ;push index X onto the SSTACK
003797 003797 36                                              PSHA                                                    ;push accu A onto the SSTACK
                                                              ;Store buffer entry (buffer entry in B)
003798 003798 CE 19 DA                                        LDX     #DISP_BUF                                       ;buffer address->X
00379B 00379B B6 19 EA                                        LDAA    DISP_BUF_IN
00379E 00379E 6B E4                                           STAB    A,X                                             ;write data into buffer
0037A0 0037A0 42                                              INCA                                                    ;advance IN index
0037A1 0037A1 84 0F                                           ANDA    #(DISP_BUF_SIZE-1)                              ;buffer usage->A
0037A3 0037A3 B1 19 EB                                        CMPA    DISP_BUF_OUT                                    ;check if the buffer is full
0037A6 0037A6 27 0D                                           BEQ     DISP_TX_NB_2                                    ;buffer is full
0037A8 0037A8 7A 19 EA                                        STAA    DISP_BUF_IN
                                                              ;Enable SPI transmit interrupt
0037AB 0037AB 18 0B 7E 00 D8                                  MOVB    #(SPE|SPTIE|DISP_SPICR1_CONFIG), SPICR1
                                                              ;Return positive status
0037B0 0037B0 MACRO                                           SSTACK_PREPULL  5
0037B0 0037B0 14 01                                           SEC                                                     ;return positive status
0037B2 0037B2 32                      DISP_TX_NB_1            PULA                                                    ;pull accu A from the SSTACK
0037B3 0037B3 30                                              PULX                                                    ;pull index B from the SSTACK
                                                              ;Done
0037B4 0037B4 3D                                              RTS
                                                              ;Return negative status
0037B5 0037B5 MACRO                   DISP_TX_NB_2            SSTACK_PREPULL  5
0037B5 0037B5 10 FE                                           CLC                                                     ;return negative status
0037B7 0037B7 20 F9                                           JOB     DISP_TX_NB_1
                                      ;#Transmit commands and data (blocking)
                                      ; args:   B: buffer entry
                                      ; result: none
                                      ; SSTACK: 7 bytes
                                      ;         X, Y and D are preserved
0037B9 0037B9 -> $37B9                DISP_TX_BL              EQU     *
0037B9 0037B9 MACRO                                           DISP_MAKE_BL    DISP_TX_NB, 5
                                      ;# Macros for internal use                                                       (DISP_MAKE_BL)
                                      ;-------------------------                                                       (DISP_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (DISP_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (DISP_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (DISP_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (DISP_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (DISP_MAKE_BL)
0037B9 0037B9 MACRO                                           SCI_MAKE_BL DISP_TX_NB 5                                 (DISP_MAKE_BL)
                                      ;#Helper functions                                                               (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;#----------------                                                               (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (DISP_MAKE_BL/SCI_MAKE_BL)
0037B9 0037B9 14 10                   LOOP                    SEI                                                      (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (DISP_MAKE_BL/SCI_MAKE_BL)
0037BB 0037BB 07 D9                                           JOBSR   DISP_TX_NB                                       (DISP_MAKE_BL/SCI_MAKE_BL)
0037BD 0037BD 24 03                                           BCC     WAIT            ;function unsuccessful           (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (DISP_MAKE_BL/SCI_MAKE_BL)
0037BF 0037BF 10 EF                                           CLI                                                      (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Done                                                    (DISP_MAKE_BL/SCI_MAKE_BL)
0037C1 0037C1 MACRO                                           SSTACK_PREPULL  2                                        (DISP_MAKE_BL/SCI_MAKE_BL)
0037C1 0037C1 3D                                              RTS                                                      (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (DISP_MAKE_BL/SCI_MAKE_BL)
0037C2 0037C2 MACRO                   WAIT                    ISTACK_WAIT                                              (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
0037C2 0037C2 10 EF                                           CLI                                                      (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (DISP_MAKE_BL/SCI_MAKE_BL)
0037C4 0037C4 MACRO                                           SSTACK_PREPUSH  5                                        (DISP_MAKE_BL/SCI_MAKE_BL)
0037C4 0037C4 20 F3                                           JOB     LOOP                                             (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;#Transmit a sequence of commands and data (non-blocking)
                                      ; args:   X: pointer to the start of the sequence
                                      ;         D: pointer to the end of the sequence
                                      ; result: X: pointer to the start of the remaining sequence
                                      ;         C: 1 = successful, 0=buffer full
                                      ; SSTACK: 9 bytes
                                      ;         Y and D are preserved
0037C6 0037C6 -> $37C6                DISP_STREAM_NB          EQU     *
                                                              ;Save registers (start pointer in X, end pointer in D)
0037C6 0037C6 3B                                              PSHD                                                    ;push accu D onto the SSTACK
                                                              ;Transmit next byte (start pointer in X, end pointer in D)
0037C7 0037C7 E6 30                   DISP_STREAM_NB_1        LDAB    1,X+                                            ;get data
0037C9 0037C9 MACRO                                           DISP_TX_NB                                              ;transmit data (SSTACK: 5 bytes)
                                      ;#Transmit commands and data (non-blocking)                                      (DISP_TX_NB)
                                      ; args:   B: buffer entry                                                        (DISP_TX_NB)
                                      ; result: C: 1=successful, 0=nothing has been done                               (DISP_TX_NB)
                                      ; SSTACK: 5 bytes                                                                (DISP_TX_NB)
                                      ;         X, Y and D are preserved                                               (DISP_TX_NB)
0037C9 0037C9 MACRO                                           SSTACK_JOBSR    DISP_TX_NB, 5                            (DISP_TX_NB)
                                      ;#Check stack and call subroutine                                                (DISP_TX_NB/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (DISP_TX_NB/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (DISP_TX_NB/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (DISP_TX_NB/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (DISP_TX_NB/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (DISP_TX_NB/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (DISP_TX_NB/SSTACK_JOBSR)
0037C9 0037C9 07 CB                                           JOBSR   DISP_TX_NB                                       (DISP_TX_NB/SSTACK_JOBSR)
0037CB 0037CB 24 08                                           BCC     DISP_STREAM_NB_3                                ;TX buffer is full
0037CD 0037CD AE 80                                           CPX     0,SP                                            ;check if stream is complete
0037CF 0037CF 25 F6                                           BLO     DISP_STREAM_NB_1                                ;transmit next byte
                                                              ;Successful transmission (new start pointer in X, $0000 in Y)
0037D1 0037D1 MACRO                                           SSTACK_PREPULL  3
0037D1 0037D1 14 01                                           SEC                                                     ;signal success
0037D3 0037D3 3A                      DISP_STREAM_NB_2        PULD                                                    ;pull accu B from the SSTACK
                                                              ;Done
0037D4 0037D4 3D                                              RTS
                                                              ;TX buffer is full (new start pointer+1 in X, new byte count in Y)
0037D5 0037D5 09                      DISP_STREAM_NB_3        DEX                                                     ;restore pointer
                                                              ;Unsucessful transmission (new start pointer in X, new byte count in Y)
0037D6 0037D6 MACRO                                           SSTACK_PREPULL  3
0037D6 0037D6 10 FE                                           CLC                                                     ;signal success
0037D8 0037D8 20 F9                                           JOB     DISP_STREAM_NB_2                                ; done
                                      ;#Transmit a sequence of commands and data (non-blocking)
                                      ; args:   X: pointer to the start of the sequence
                                      ;         D: pointer to the end of the sequence
                                      ; result: X: points to the byte after the sequence
                                      ; SSTACK: 11 bytes
                                      ;         Y and D are preserved
0037DA 0037DA -> $37DA                DISP_STREAM_BL          EQU     *
0037DA 0037DA MACRO                                           DISP_MAKE_BL    DISP_STREAM_NB, 8
                                      ;# Macros for internal use                                                       (DISP_MAKE_BL)
                                      ;-------------------------                                                       (DISP_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (DISP_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (DISP_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (DISP_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (DISP_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (DISP_MAKE_BL)
0037DA 0037DA MACRO                                           SCI_MAKE_BL DISP_STREAM_NB 8                             (DISP_MAKE_BL)
                                      ;#Helper functions                                                               (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;#----------------                                                               (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (DISP_MAKE_BL/SCI_MAKE_BL)
0037DA 0037DA 14 10                   LOOP                    SEI                                                      (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (DISP_MAKE_BL/SCI_MAKE_BL)
0037DC 0037DC 07 E8                                           JOBSR   DISP_STREAM_NB                                   (DISP_MAKE_BL/SCI_MAKE_BL)
0037DE 0037DE 24 03                                           BCC     WAIT            ;function unsuccessful           (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (DISP_MAKE_BL/SCI_MAKE_BL)
0037E0 0037E0 10 EF                                           CLI                                                      (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Done                                                    (DISP_MAKE_BL/SCI_MAKE_BL)
0037E2 0037E2 MACRO                                           SSTACK_PREPULL  2                                        (DISP_MAKE_BL/SCI_MAKE_BL)
0037E2 0037E2 3D                                              RTS                                                      (DISP_MAKE_BL/SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (DISP_MAKE_BL/SCI_MAKE_BL)
0037E3 0037E3 MACRO                   WAIT                    ISTACK_WAIT                                              (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
0037E3 0037E3 10 EF                                           CLI                                                      (DISP_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (DISP_MAKE_BL/SCI_MAKE_BL)
0037E5 0037E5 MACRO                                           SSTACK_PREPUSH  8                                        (DISP_MAKE_BL/SCI_MAKE_BL)
0037E5 0037E5 20 F3                                           JOB     LOOP                                             (DISP_MAKE_BL/SCI_MAKE_BL)
                                      ;#SPI ISR for transmitting data to the ST7565R display controller
                                      ;----------------------------------------------------------------
                                      ;+-------------------------------------------------------------+
                                      ;| !!! This ISR will not work if a mode switch is required !!! |
                                      ;| !!!   before the first character has been transmitted   !!! |
                                      ;+-------------------------------------------------------------+
0037E7 0037E7 -> $37E7                DISP_ISR                EQU     *
                                                              ;Check and clear SPIF flag
                                                              ;SPIF cleared: transmssion still ongoing
                                                              ;SPIF set:     transmssion complete
                                                              ;Check if DISP buffer is empty
0037E7 0037E7 FC 19 EA                                        LDD     DISP_BUF_IN                                     ;IN->A, OUT->B
0037EA 0037EA 18 17                                           CBA                                                     ;check if
0037EC 0037EC 27 2A                                           BEQ     DISP_ISR_6                                      ;DISP buffer is empty
                                                              ;Check repeat/escape status (OUT in B)
                                                              ;DISP_RPTCNT = $00:      no repeat loop, escaping enabled
                                                              ;DISP_RPTCNT = $01:      last iteration if a repeat loop, escaping disabled
                                                              ;DISP_RPTCNT = $02..$FD: repeat loop ongoing, escaping disabled
                                                              ;DISP_RPTCNT = $FF:      escape sequence started
0037EE 0037EE CE 19 DA                                        LDX     #DISP_BUF                                       ;buffer pointer -> X
0037F1 0037F1 E6 E5                                           LDAB    B,X                                             ;char -> B
0037F3 0037F3 B6 19 EC                                        LDAA    DISP_RPTCNT                                     ;repeat counter -> A
0037F6 0037F6 26 27                                           BNE     DISP_ISR_7                                      ;repeat loop or escape sequence in progress
                                                              ;Check for new escape character (repeat counter in A, char in B)
0037F8 0037F8 C1 E3                                           CMPB    #DISP_ESC_START                                 ;check for escape character
0037FA 0037FA 27 37                                           BEQ     DISP_ISR_8                                      ;escape character found
                                                              ;Transmit character (repeat counter in A, char in B)
0037FC 0037FC 4F DB 20 17             DISP_ISR_1              BRCLR   SPISR,#SPTEF,DISP_ISR_5                         ;wait for TX buffer to be empty
003800 003800 F7 00 DD                DISP_ISR_2              TST     SPIDRL                                          ;clear SPIF flag
003803 003803 5B DD                                           STAB    SPIDRL                                          ;transmit character
                                                              ;Check repeat count (repeat counter in A)
003805 003805 04 40 06                                        TBEQ    A, DISP_ISR_4                                   ;repeat count is zero
003808 003808 04 20 2F                                        DBNE    A, DISP_ISR_9                                   ;decrement repeat count
00380B 00380B 79 19 EC                DISP_ISR_3              CLR     DISP_RPTCNT                                     ;clear repeat count
                                                              ;Advance OUT index
00380E 00380E F6 19 EB                DISP_ISR_4              LDAB    DISP_BUF_OUT                                    ;OUT -> B
003811 003811 52                                              INCB                                                    ;increment OUT
003812 003812 C4 0F                                           ANDB    #(DISP_BUF_SIZE-1)                              ;wrap OUT
003814 003814 7B 19 EB                                        STAB    DISP_BUF_OUT                                    ;update OUT
                                                              ;Done
003817 003817 MACRO                   DISP_ISR_5              ISTACK_RTI                                              ;return
                                      ;#Return from interrupt                                                          (ISTACK_RTI)
                                      ; args:   none                                                                   (ISTACK_RTI)
                                      ; ISTACK: -9 (S12)/-10 (S12X)                                                    (ISTACK_RTI)
                                      ;         X, Y, and D are pulled from the interrupt stack                        (ISTACK_RTI)
                                                              ;End ISR                                                 (ISTACK_RTI)
003817 003817 0B                                              RTI                                                      (ISTACK_RTI)
                                                              ;DISP buffer is empty
003818 003818 18 0B 5E 00 D8          DISP_ISR_6              MOVB    #(SPE|DISP_SPICR1_CONFIG), SPICR1               ;disable transmit buffer empty interrupt
00381D 00381D 20 F8                                           JOB     DISP_ISR_5                                      ;done
                                                              ;Repeat loop or escape sequence in progress (repeat counter in A, char in B)
00381F 00381F 81 FF                   DISP_ISR_7              CMPA    #$FF                                            ;check for ongoing escape sequence
003821 003821 26 D9                                           BNE     DISP_ISR_1                                      ;repeat loop in progress
                                                              ;Conclude ongoing escape sequence(escaped char in B)
003823 003823 04 81 19                                        IBEQ    B, DISP_ISR_10                                  ;$FF: transmit escape character
003826 003826 18 0F                                           TBA                                                     ;repeat count+1 -> A
003828 003828 04 81 20                                        IBEQ    B, DISP_ISR_11                                  ;$FE: switch to command mode
00382B 00382B 04 81 2D                                        IBEQ    B, DISP_ISR_12                                  ;$FD: switch to data mode
                                                              ;Set new repeat count
00382E 00382E 7A 19 EC                                        STAA    DISP_RPTCNT                                     ;update repeat count
003831 003831 20 DB                                           JOB     DISP_ISR_4                                      ;advance out index
                                                              ;Escape character found
003833 003833 18 0B FF 19 EC          DISP_ISR_8              MOVB    #DISP_ESC_ESC, DISP_RPTCNT                      ;flag new escape sequence
003838 003838 20 D4                                           JOB     DISP_ISR_4                                      ;advance out index
                                                              ;Update repeat count (decremented repeat counter in A)
00383A 00383A 7A 19 EC                DISP_ISR_9              STAA    DISP_RPTCNT                                     ;update repeat count
00383D 00383D 20 D8                                           JOB     DISP_ISR_5                                      ;done
                                                              ;Transmit escape character
00383F 00383F 4F DB 20 D4             DISP_ISR_10             BRCLR   SPISR,#SPTEF,DISP_ISR_5                         ;wait for TX buffer to be empty
003843 003843 CC 00 E3                                        LDD     #DISP_ESC_START                                 ;repeat counter -> A, escape char -> B
003846 003846 7A 19 EC                                        STAA    DISP_RPTCNT                                     ;update repeat count
003849 003849 20 B5                                           JOB     DISP_ISR_2                                      ;transmit escape char
                                                              ;Switch to command mode
00384B 00384B 1F 02 48 10 BB          DISP_ISR_11             BRCLR   DISP_A0_PORT,#DISP_A0_PIN,DISP_ISR_3            ;command mode already set
003850 003850 4F DB 80 C3                                     BRCLR   SPISR,#SPIF,DISP_ISR_5                          ;wait for TX to be complete
                                                              ;BCLR   DISP_A0_PORT, #DISP_A0_PIN                      ;switch to command mode
003854 003854 18 0B 08 02 48                                  MOVB    #DISP_RESET_PIN, DISP_A0_PORT                   ; shortcut
003859 003859 20 B0                                           JOB     DISP_ISR_3                                      ;clear repeat counter and advance OUT
                                                              ;Switch to data mode
00385B 00385B 1E 02 48 10 AB          DISP_ISR_12             BRSET   DISP_A0_PORT,#DISP_A0_PIN,DISP_ISR_3            ;command mode already set
003860 003860 4F DB 80 B3                                     BRCLR   SPISR,#SPIF,DISP_ISR_5                          ;wait for TX to be complete
                                                              ;BSET   DISP_A0_PORT, #DISP_A0_PIN                      ;switch to data mode
003864 003864 18 0B 18 02 48                                  MOVB    #(DISP_A0_PIN|DISP_RESET_PIN), DISP_A0_PORT     ; shortcut
003869 003869 20 A0                                           JOB     DISP_ISR_3                                      ;clear repeat counter and advance OUT
00386B 00386B -> $386B                DISP_CODE_END           EQU     *
00386B 00386B -> $386B                DISP_CODE_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     DISP_TABS_START, DISP_TABS_START_LIN
003926 003926 -> $3926                DISP_TABS_END           EQU     *
003926 003926 -> $3926                DISP_TABS_END_LIN       EQU     @
                                      ;#Reference clock divider
003926 003926 -> $0000                CLOCK_REFDV             EQU     (CLOCK_OSC_FREQ/CLOCK_REF_FREQ)-1
                                      ;#Reference clock multiplier
003926 003926 -> $0018                CLOCK_SYNR              EQU     (CLOCK_BUS_FREQ/CLOCK_REF_FREQ)-1
                                      ;#Overall PLL configuration
003926 003926 -> $5800                CLOCK_PLL_CONFIG        EQU     (CLOCK_VCOFRQ<<14)|(CLOCK_SYNR<<8)|(CLOCK_REFFRQ<<6)|CLOCK_REFDV
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     CLOCK_VARS_START, CLOCK_VARS_START_LIN
00198B 00198B -> $198B                CLOCK_VARS_END          EQU     *
00198B 00198B -> $198B                CLOCK_VARS_END_LIN      EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
003796 003796                                                 ORG     CLOCK_CODE_START, CLOCK_CODE_START_LIN
003796 003796 -> $3796                CLOCK_CODE_END          EQU     *
003796 003796 -> $3796                CLOCK_CODE_END_LIN      EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     CLOCK_TABS_START, CLOCK_TABS_START_LIN
003926 003926 -> $3926                CLOCK_TABS_END          EQU     *
003926 003926 -> $3926                CLOCK_TABS_END_LIN      EQU     @
                                      ;###############################################################################
                                      ;# Configuration                                                               #
                                      ;###############################################################################
                                      ;Clock divider
                                      ;-------------
003926 003926 -> $0001                TIM_DIV_OFF             EQU     1       ;default no clock divider
                                      ;OCPD checks (only disable timer if all OCPD bits are set)
                                      ;---------------------------------------------------------
003926 003926 -> $0001                TIM_OCPD_CHECK_OFF      EQU     1               ;disable OCPD checks
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;Timer frequency
                                      ;---------------
003926 003926 -> $17D7840             TIM_FREQ                EQU     CLOCK_BUS_FREQ          ;frequency in Hz
                                      ;Register offsets
                                      ;-----------------
003926 003926 -> $0000                TIOS_OFFSET             EQU     $0000
                                      ;TCFORC_OFFSET          EQU     $0001
                                      ;TOC7M_OFFSET           EQU     $0002
                                      ;TOC7D_OFFSET           EQU     $0003
003926 003926 -> $0004                TCNT_OFFSET             EQU     $0004
003926 003926 -> $0006                TSCR1_OFFSET            EQU     $0006
                                      ;TTOV_OFFSET            EQU     $0007
003926 003926 -> $0008                TCTL1_OFFSET            EQU     $0008
003926 003926 -> $0009                TCTL2_OFFSET            EQU     $0009
003926 003926 -> $000A                TCTL3_OFFSET            EQU     $000A
003926 003926 -> $000B                TCTL4_OFFSET            EQU     $000B
003926 003926 -> $000C                TIE_OFFSET              EQU     $000C
003926 003926 -> $000D                TSCR2_OFFSET            EQU     $000D
003926 003926 -> $000E                TFLG1_OFFSET            EQU     $000E
003926 003926 -> $000F                TFLG2_OFFSET            EQU     $000F
003926 003926 -> $0010                TC0_OFFSET              EQU     $0010
                                      ;TC1_OFFSET             EQU     $0012
                                      ;TC2_OFFSET             EQU     $0014
                                      ;TC3_OFFSET             EQU     $0016
                                      ;TC4_OFFSET             EQU     $0018
                                      ;TC5_OFFSET             EQU     $001A
                                      ;TC6_OFFSET             EQU     $001C
                                      ;TC7_OFFSET             EQU     $001E
                                      ;PACTL_OFFSET           EQU     $0020
                                      ;PAFLG_OFFSET           EQU     $0021
                                      ;PACNT_OFFSET           EQU     $0022
003926 003926 -> $002C                OCPD_OFFSET             EQU     $002C
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     TIM_VARS_START, TIM_VARS_START_LIN
00198B 00198B -> $198B                TIM_VARS_END            EQU     *
00198B 00198B -> $198B                TIM_VARS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
003796 003796                                                 ORG     TIM_CODE_START, TIM_CODE_START_LIN
003796 003796 -> $3796                TIM_CODE_END            EQU     *
003796 003796 -> $3796                TIM_CODE_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     TIM_TABS_START, TIM_TABS_START_LIN
003926 003926 -> $3926                TIM_TABS_END            EQU     *
003926 003926 -> $3926                TIM_TABS_END_LIN        EQU     @
                                      ;Range checks
                                      ;------------
                                      ;General stack range check enable
003926 003926 -> $0001                SSTACK_CHECK_OFF        EQU     1               ;default is off
                                      ;Debug code
                                      ;----------
003926 003926 -> $0001                SSTACK_DEBUG_OFF        EQU     1               ;default is off
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;Stack size
                                      ;----------
003926 003926 -> $1488                SSTACK_SIZE             EQU     (SSTACK_BOTTOM-SSTACK_TOP)
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     SSTACK_VARS_START, SSTACK_VARS_START_LIN
00198B 00198B -> $198B                SSTACK_VARS_END         EQU     *
00198B 00198B -> $198B                SSTACK_VARS_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Stack space                                                                 #
                                      ;###############################################################################
001AF8 001AF8                                                 ORG     SSTACK_TOP, SSTACK_TOP_LIN
                                                              ;Declare RAM space (to be recognized by the assembler)
001AF8 001AF8                                                 DS      SSTACK_BOTTOM-SSTACK_TOP
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
00141A 00301A                                                 ORG     SSTACK_CODE_START, SSTACK_CODE_START_LIN
00141A 00301A -> $141A                SSTACK_CODE_END         EQU     *
00141A 00301A -> $301A                SSTACK_CODE_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
001400 003000                                                 ORG     SSTACK_TABS_START, SSTACK_TABS_START_LIN
001400 003000 -> $1400                SSTACK_TABS_END         EQU     *
001400 003000 -> $3000                SSTACK_TABS_END_LIN     EQU     @
                                      ;Range checks
                                      ;------------
                                      ;General stack range checkenable
001400 003000 -> $0001                ISTACK_CHECK_OFF        EQU     1               ;default is off
                                      ;Debug code
                                      ;----------
001400 003000 -> $0001                ISTACK_DEBUG_OFF        EQU     1               ;default is off
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;Stack allocation
                                      ;----------------
001400 003000 -> $1AF8                ISTACK_TOP              EQU     SSTACK_TOP
001400 003000 -> $2F80                ISTACK_BOTTOM           EQU     SSTACK_BOTTOM
001400 003000 -> $1488                ISTACK_SIZE             EQU     SSTACK_SIZE
                                      ;S12 stack layout:
                                      ;        +----------------+
                                      ;        |      CCR       | SP+0
                                      ;        +----------------+
                                      ;        |       B        | SP+1
                                      ;        +----------------+
                                      ;        |       A        | SP+2
                                      ;        +----------------+
                                      ;        |       Xh       | SP+3
                                      ;        +----------------+
                                      ;        |       Xl       | SP+4
                                      ;        +----------------+
                                      ;        |       Yh       | SP+5
                                      ;        +----------------+
                                      ;        |       Yl       | SP+6
                                      ;        +----------------+
                                      ;        |      RTNh      | SP+7
                                      ;        +----------------+
                                      ;        |      RTNl      | SP+8
                                      ;        +----------------+
001400 003000 -> $0009                ISTACK_FRAME_SIZE       EQU     9
001400 003000 -> $0000                ISTACK_FRAME_CCR        EQU     0
001400 003000 -> $0001                ISTACK_FRAME_D          EQU     1
001400 003000 -> $0003                ISTACK_FRAME_X          EQU     3
001400 003000 -> $0005                ISTACK_FRAME_Y          EQU     5
001400 003000 -> $0007                ISTACK_FRAME_RTN        EQU     7
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     ISTACK_VARS_START, ISTACK_VARS_START_LIN
00198B 00198B -> $198B                ISTACK_VARS_END         EQU     *
00198B 00198B -> $198B                ISTACK_VARS_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
00141A 00301A                                                 ORG     ISTACK_CODE_START, ISTACK_CODE_START_LIN
00141A 00301A -> $141A                ISTACK_CODE_END         EQU     *
00141A 00301A -> $301A                ISTACK_CODE_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
001400 003000                                                 ORG     ISTACK_TABS_START, ISTACK_TABS_START_LIN
001400 003000 -> $1400                ISTACK_TABS_END         EQU     *
001400 003000 -> $3000                ISTACK_TABS_END_LIN     EQU     @
                                      ;TIM configuration
                                      ;TIM instance for baud rate detection
001400 003000 -> $0040                SCI_IC_TIM              EQU     TIOS            ;default is the TIM instance associated with TIOS
                                      ;Input capture channel for baud rate detection
001400 003000 -> $0001                SCI_IC                  EQU     1               ;default is IC1
                                      ;TIM instance for baud rate detection and flow control
                                      ;Output compare channel for baud rate detection and flow control
                                      ;Past baud rate detection, the OC will always measure time periods of roughly 2 SCI frames
                                      ;TIM instance for the MUCts00510 workaround
001400 003000 -> $0040                SCI_IRQBUG_TIM          EQU     TIOS            ;default is the TIM instance associated with TIOS
                                      ;Output compare channel for the MUCts00510 workaround
                                      ;Past baud rate detection, the OC will always measure time periods of roughly 2 SCI frames
001400 003000 -> $0002                SCI_IRQBUG_OC           EQU     2               ;default is OC02
                                      ;Frame format
                                      ;------------
001400 003000                         SCI_FORMAT_8N1
                                      ;SCI V02.00 IRQ workaround (MUCts00510)
                                      ;--------------------------------------
                                      ;###############################################################################
                                      ;# Relevant for the folowing parts:                                            #
                                      ;#    MC9S12DP256 mask sets 0K79X, 1K79X, 2K79X, 0L58F                         #
                                      ;#    MC9S12H256  mask sets 0K78X, 1K78X, 2K78X                                #
                                      ;# The will SCI only request interrupts if an odd number of interrupt flags is #
                                      ;# This will cause disabled and spourious interrupts.                          #
                                      ;# -> The RX/TX ISR must be periodically triggered by a timer interrupt.       #
                                      ;#    The timer period should be about as long as two SCI frames:              #
                                      ;#    RT cycle = SCIBD * bus cycles                                            #
                                      ;#    bit time = 16 * RT cycles = 16 * SCIBD * bus cycles                      #
                                      ;#    frame time = 10 * bit times = 160 RT cycles = 160 * SCIBD * bus cycles   #
                                      ;#    2 * frame times = 320 * SCIBD * bus cycles = 0x140 * SCIBD * bus cycles  #
                                      ;#    Simplification:                                                          #
                                      ;#    TIM period = 0x100 * SCIBD * bus cycles                                  #
                                      ;###############################################################################
                                      ;Enable workaround for MUCts00510
001400 003000 -> $0001                SCI_IRQBUG_OFF          EQU     1               ;IRQ workaround disabled on newer SCIs
                                      ;#Baud rate
001400 003000 -> $2580                SCI_BAUD                EQU     9600
                                      ;#Baud rate divider (SCIBD)
                                      ; SCI V5: SCIBD = bus clock / (16*baud rate)
                                      ;         25MHz:   9600 -> $A2
                                      ;                 14400 -> $6C
                                      ;                 19200 -> $51
                                      ;                 28800 -> $36
                                      ;                 38400 -> $28
                                      ;                 57600 -> $1B
                                      ;                 76800 -> $14
                                      ;                115200 -> $0D
                                      ;                153600 -> $0A
                                      ; SCI V6: SCIBD = bus clock / baud rate
                                      ;         25MHz:   9600 -> $A2C
                                      ;                 14400 -> $6C8
                                      ;                 19200 -> $516
                                      ;                 28800 -> $364
                                      ;                 38400 -> $28B
                                      ;                 57600 -> $1B2
                                      ;                 76800 -> $145
                                      ;                115200 -> $0D9
                                      ;                153600 -> $0A2
001400 003000 -> $00A3                SCI_BDIV                EQU     (CLOCK_BUS_FREQ/(16*SCI_BAUD))+(((2*CLOCK_BUS_FREQ)/(16*SCI_BAUD))&1)
                                      ;#Pulse range for faud rate detection
                                      ;max. baud rate:  153600 baud +10% = 168960 baud
                                      ;min. baud rate:  TIM_FREQ/$FFFF   ~   381 baud (TIM_FREQ=25MHz)
001400 003000 -> $29400               SCI_BD_MAX_BAUD         EQU     168960                          ;highest baud rate
001400 003000 -> $017D                SCI_BD_MIN_BAUD         EQU     TIM_FREQ/$FFFF                  ;lowest baud rate
001400 003000 -> $0093                SCI_BD_MIN_PULSE        EQU     TIM_FREQ/SCI_BD_MAX_BAUD        ;shortest bit pulse
001400 003000 -> $FFFF                SCI_BD_MAX_PULSE        EQU     $FFFF                           ;longest bit pulse
                                      ;#Frame format
001400 003000 -> $0004                SCI_8N1                 EQU       ILT           ;8N1
001400 003000 -> $0006                SCI_8E1                 EQU       ILT|PE        ;8E1
001400 003000 -> $0007                SCI_8O1                 EQU       ILT|PE|PT     ;8O1
001400 003000 -> $0014                SCI_8N2                 EQU     M|ILT           ;8N2 TX8=1
001400 003000 -> $0004                SCI_FORMAT              EQU     SCI_8N1
                                      ;#C0 characters
001400 003000 -> $00E0                SCI_C0_MASK             EQU     $E0             ;mask for C0 character range
001400 003000 -> $0003                SCI_C0_BREAK            EQU     $03             ;ctrl-c (break signal)
001400 003000 -> $0010                SCI_C0_DLE              EQU     $10             ;data link escape (treat next byte as data)
001400 003000 -> $0011                SCI_C0_XON              EQU     $11             ;unblock transmission
001400 003000 -> $0013                SCI_C0_XOFF             EQU     $13             ;block transmission
001400 003000 -> $0018                SCI_C0_CANCEL           EQU     $18             ;ctrl-x (cancel signal)
001400 003000 -> $001A                SCI_C0_SUSPEND          EQU     $1A             ;ctrl-z (suspend signal)
001400 003000 -> $001B                SCI_C0_ESCAPE           EQU     $1B             ;ESC (escape signal)
001400 003000 -> $001A                SCI_C0_US               EQU     $1A             ;last C0 character (unit separator)
001400 003000 -> $007F                SCI_C0_DEL              EQU     $7F             ;DELETE
                                      ;#C1 characters
001400 003000 -> $0010                SCI_C1_MASK             EQU     $10             ;mask for C1 character range
                                      ;#Buffer masks
001400 003000 -> $003F                SCI_RXBUF_MASK          EQU     SCI_RXBUF_SIZE-1;mask for rolling over the RX buffer
001400 003000 -> $0007                SCI_TXBUF_MASK          EQU     SCI_TXBUF_SIZE-1;mask for rolling over the TX buffer
                                      ;#Flow control thresholds
001400 003000 -> $0036                SCI_RX_FULL_LEVEL       EQU     SCI_RXBUF_SIZE-10;RX buffer threshold to block transmissions
001400 003000 -> $0004                SCI_RX_EMPTY_LEVEL      EQU     2*2             ;RX buffer threshold to unblock transmissions
                                      ;#Action flags
001400 003000 -> $0080                SCI_EXCPT_RXFC          EQU     $80             ;handle RX flow control
001400 003000 -> $0000                SCI_EXCPT_BREAK         EQU     $00             ;no BREAK request
001400 003000 -> $0000                SCI_EXCPT_CANCEL        EQU     $00             ;no CANCEL request
001400 003000 -> $0000                SCI_EXCPT_SUSPEND       EQU     $00             ;no SUSPEND request
001400 003000 -> $0000                SCI_EXCPT_ESCAPE        EQU     $00             ;no ESCAPE request
001400 003000 -> $0080                SCI_EXCPT_ANY           EQU     SCI_EXCPT_RXFC|SCI_EXCPT_BREAK|SCI_EXCPT_CANCEL|SCI_EXCPT_SUSPEND|SCI_EXCPT_ESCAPE
                                      ;#Status Flags
001400 003000 -> $0080                SCI_STAT_TCVALID        EQU     $80             ;timestamp is valid
001400 003000 -> $0040                SCI_STAT_TXDLE          EQU     $40             ;atomic TX sequence
001400 003000 -> $0020                SCI_STAT_RXDLE          EQU     $20             ;next RX character is escaped
001400 003000 -> $0010                SCI_STAT_SWOR           EQU     $10             ;software buffer overrun (RX buffer)
001400 003000 -> $0008                SCI_STAT_NOTX           EQU     $08             ;don't transmit (XOFF received)
001400 003000 -> $0004                SCI_STAT_RXERR          EQU     $04             ;RX error state
001400 003000 -> $0002                SCI_STAT_BDIVOK         EQU     $02             ;BDIV is valid
                                      ;#Meta Data
001400 003000 -> $0080                SCI_META_C1             EQU     $80             ;C1 character
001400 003000 -> $0040                SCI_META_C0             EQU     $40             ;C0 Character (incl. DEL)
001400 003000 -> $0020                SCI_META_DLE            EQU     $20             ;character is escaped
001400 003000 -> $0010                SCI_META_SWOR           EQU     $10             ;software overrun (previous data lost)
001400 003000 -> $0008                SCI_META_HWOR           EQU     $08             ;hardware overrun (previous data lost)
001400 003000 -> $0004                SCI_META_NF             EQU     $04             ;data received with noise
001400 003000 -> $0002                SCI_META_FE             EQU     $02             ;data received with frame error
001400 003000 -> $0001                SCI_META_PF             EQU     $01             ;data received with parity error
                                      ;#Shortcuts
001400 003000 -> $0010                SWOR                    EQU     SCI_META_SWOR   ;shortcut
                                      ;#Timer usage and configuration
001400 003000 -> $0000                SCI_IC_TCTL34_INIT      EQU     0               ;no IC needed
001400 003000 -> $0001                SCI_OC_TIOS_INIT        EQU     1<<SCI_OC       ;use OC
001400 003000 -> $0004                SCI_IRQBUG_TIOS_INIT    EQU     1<<SCI_IRQBUG_OC;use OC
                                      ;#Timer channels
001400 003000 -> $0052                SCI_IC_TC               EQU     SCI_IC_TIM+TC0_OFFSET+(2*SCI_IC)        ;IC capture register
001400 003000 -> $0050                SCI_OC_TC               EQU     SCI_OC_TIM+TC0_OFFSET+(2*SCI_OC)        ;OC compare register
001400 003000 -> $0044                SCI_OC_TCNT             EQU     SCI_OC_TIM+TCNT_OFFSET                  ;OC counter register
001400 003000 -> $0054                SCI_IRQBUG_TC           EQU     SCI_IRQBUG_TIM+TC0_OFFSET+(2*SCI_IRQBUG_OC);OC counter register
001400 003000 -> $0044                SCI_IRQBUG_TCNT         EQU     SCI_IRQBUG_TIM+TCNT_OFFSET              ;OC counter register
                                      ;#OC delays
001400 003000 -> $0EE2                SCI_XONXOFF_DLY         EQU     10*(TIM_FREQ/65536)                     ;XON/XOFF reminder intervall (~10sec)
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     SCI_VARS_START, SCI_VARS_START_LIN
00198B 00198B                                                 ALIGN   1
                                      ;#Receive buffer
00198C 00198C                         SCI_RXBUF               DS      SCI_RXBUF_SIZE
0019CC 0019CC                         SCI_RXBUF_IN            DS      1               ;points to the next free space
0019CD 0019CD                         SCI_RXBUF_OUT           DS      1               ;points to the oldest entry
                                      ;#Transmit buffer
0019CE 0019CE                         SCI_TXBUF               DS      SCI_TXBUF_SIZE
0019D6 0019D6                         SCI_TXBUF_IN            DS      1               ;points to the next free space
0019D7 0019D7                         SCI_TXBUF_OUT           DS      1               ;points to the oldest entry
                                      ;#Event flags
0019D8 0019D8                         SCI_EXCPT               DS      1               ; flags
                                      ;#Status flags
0019D9 0019D9                         SCI_STAT                DS      1               ;status flags
0019DA 0019DA -> $19DA                SCI_VARS_END            EQU     *
0019DA 0019DA -> $19DA                SCI_VARS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
00141A 00301A                                                 ORG     SCI_CODE_START, SCI_CODE_START_LIN
                                      ;#Transmit one byte - non-blocking
                                      ; args:   B: data to be send
                                      ; result: C-flag: set if successful
                                      ; SSTACK: 6 bytes
                                      ;         X, Y, and D are preserved
00141A 00301A -> $141A                SCI_TX_NB               EQU     *
                                                              ;Save registers (data in B)
00141A 00301A 34                                              PSHX                                            ;save X
00141B 00301B 36                                              PSHA                                            ;save A
00141C 00301C 10 FE                                           CLC                                             ;signal failure by default
00141E 00301E 39                                              PSHC                                            ;save CCR
                                                              ;Write data into the TX buffer (data in B)
00141F 00301F CE 19 CE                                        LDX     #SCI_TXBUF                              ;buffer pointer -> X
001422 003022 B6 19 D6                                        LDAA    SCI_TXBUF_IN                            ;in -> A
001425 003025 6B E4                                           STAB    A,X                                     ;store data in buffer
                                                              ;Check if there is room for this entry (data in B, in-index in A, TX buffer pointer in X)
001427 003027 42                                              INCA                                            ;increment index
001428 003028 84 07                                           ANDA    #SCI_TXBUF_MASK                         ;wrap index
00142A 00302A B1 19 D7                                        CMPA    SCI_TXBUF_OUT                           ;check if buffer is full
00142D 00302D 27 09                                           BEQ     SCI_TX_NB_1                             ;buffer is full
                                                              ;Update buffer
00142F 00302F 7A 19 D6                                        STAA    SCI_TXBUF_IN                            ;update in
                                                              ;Enable interrupts
001432 003032 4C CB 80                                        BSET    SCICR2,#TXIE                            ;enable TX interrupt
                                                              ;Signal success
001435 003035 0C 80 01                                        BSET    0,SP, #$01                              ;set C-flag
                                                              ;Restore registers
001438 003038 MACRO                   SCI_TX_NB_1             SSTACK_PREPULL  6                               ;check SSTACK
001438 003038 38                                              PULC                                            ;restore CCR (incl. result)
001439 003039 32                                              PULA                                            ;restore A
00143A 00303A 30                                              PULX                                            ;restore X
                                                              ;Done
00143B 00303B 3D                                              RTS
                                      ;#Transmit one byte - blocking
                                      ; args:   B: data to be send
                                      ; result: none
                                      ; SSTACK: 8 bytes
                                      ;         X, Y, and D are preserved
00143C 00303C -> $143C                SCI_TX_BL               EQU     *
00143C 00303C MACRO                                           SCI_MAKE_BL     SCI_TX_NB, 6
                                      ;#Helper functions                                                               (SCI_MAKE_BL)
                                      ;#----------------                                                               (SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (SCI_MAKE_BL)
00143C 00303C 14 10                   LOOP                    SEI                                                      (SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (SCI_MAKE_BL)
00143E 00303E 07 DA                                           JOBSR   SCI_TX_NB                                        (SCI_MAKE_BL)
001440 003040 24 03                                           BCC     WAIT            ;function unsuccessful           (SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (SCI_MAKE_BL)
001442 003042 10 EF                                           CLI                                                      (SCI_MAKE_BL)
                                                              ;Done                                                    (SCI_MAKE_BL)
001444 003044 MACRO                                           SSTACK_PREPULL  2                                        (SCI_MAKE_BL)
001444 003044 3D                                              RTS                                                      (SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (SCI_MAKE_BL)
001445 003045 MACRO                   WAIT                    ISTACK_WAIT                                              (SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (SCI_MAKE_BL/ISTACK_WAIT)
001445 003045 10 EF                                           CLI                                                      (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (SCI_MAKE_BL)
001447 003047 MACRO                                           SSTACK_PREPUSH  6                                        (SCI_MAKE_BL)
001447 003047 20 F3                                           JOB     LOOP                                             (SCI_MAKE_BL)
                                      ;#Check if TX queue can hold further data
                                      ; args:   none
                                      ; result: C-flag: set if successful
                                      ; SSTACK: 4 bytes
                                      ;         X, Y, and D are preserved
001449 003049 -> $1449                SCI_TX_READY_NB         EQU     *
                                                              ;Save registers
001449 003049 36                                              PSHA                                            ;sace A
00144A 00304A 10 FE                                           CLC                                             ;default result: failure
00144C 00304C 39                                              PSHC                                            ;save CCR (incl. default result)
                                                              ;Check if there is room for this entry
00144D 00304D B6 19 D6                                        LDAA    SCI_TXBUF_IN                            ;in -> A
001450 003050 42                                              INCA                                            ;increment in
001451 003051 84 07                                           ANDA    #SCI_TXBUF_MASK                         ;wrap in
001453 003053 B1 19 D7                                        CMPA    SCI_TXBUF_OUT                           ;check for overflow
001456 003056 27 03                                           BEQ     SCI_TX_READY_NB_2                       ;buffer is full
                                                              ;Signal success
001458 003058 0C 80 01                SCI_TX_READY_NB_1       BSET    0,SP, #1                                ;set C-flag
                                                              ;Restore registers
00145B 00305B MACRO                   SCI_TX_READY_NB_2       SSTACK_PREPULL  4                               ;check SSTACK
00145B 00305B 38                                              PULC                                            ;restore CCR (incl. result)
00145C 00305C 32                                              PULA                                            ;restore A
                                                              ;Done
00145D 00305D 3D                                              RTS
                                      ;#Wait until TX queue can hold further data
                                      ; args:   none
                                      ; result: none
                                      ; SSTACK: 6 bytes
                                      ;         X, Y, and D are preserved
00145E 00305E -> $145E                SCI_TX_READY_BL         EQU     *
00145E 00305E MACRO                                           SCI_MAKE_BL     SCI_TX_READY_NB, 4
                                      ;#Helper functions                                                               (SCI_MAKE_BL)
                                      ;#----------------                                                               (SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (SCI_MAKE_BL)
00145E 00305E 14 10                   LOOP                    SEI                                                      (SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (SCI_MAKE_BL)
001460 003060 07 E7                                           JOBSR   SCI_TX_READY_NB                                  (SCI_MAKE_BL)
001462 003062 24 03                                           BCC     WAIT            ;function unsuccessful           (SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (SCI_MAKE_BL)
001464 003064 10 EF                                           CLI                                                      (SCI_MAKE_BL)
                                                              ;Done                                                    (SCI_MAKE_BL)
001466 003066 MACRO                                           SSTACK_PREPULL  2                                        (SCI_MAKE_BL)
001466 003066 3D                                              RTS                                                      (SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (SCI_MAKE_BL)
001467 003067 MACRO                   WAIT                    ISTACK_WAIT                                              (SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (SCI_MAKE_BL/ISTACK_WAIT)
001467 003067 10 EF                                           CLI                                                      (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (SCI_MAKE_BL)
001469 003069 MACRO                                           SSTACK_PREPUSH  4                                        (SCI_MAKE_BL)
001469 003069 20 F3                                           JOB     LOOP                                             (SCI_MAKE_BL)
                                      ;#Check if there is no more data in the TX queue
                                      ; args:   none
                                      ; result: C-flag: set if successful
                                      ; SSTACK: 4 bytes
                                      ;         X, Y and B are preserved
00146B 00306B -> $146B                SCI_TX_DONE_NB          EQU     *
                                                              ;Save registers
00146B 00306B 36                                              PSHA                                            ;save A
00146C 00306C 10 FE                                           CLC                                             ;default result: failure
00146E 00306E 39                                              PSHC                                            ;save CCR (incl. default result)
                                                              ;Check if TX queue is empty
00146F 00306F B6 19 D6                                        LDAA    SCI_TXBUF_IN                            ;in -> A
001472 003072 B1 19 D7                                        CMPA    SCI_TXBUF_OUT                           ;check for overflow
001475 003075 27 E1                                           BEQ     SCI_TX_READY_NB_1                       ;signal success
001477 003077 20 E2                                           JOB     SCI_TX_READY_NB_2                       ;signal failure
                                      ;#Wait until there is no more data in the TX queue
                                      ; args:   none
                                      ; result: none
                                      ; SSTACK: 6 bytes
                                      ;         X, Y and B are preserved
001479 003079 -> $1479                SCI_TX_DONE_BL          EQU     *
001479 003079 MACRO                                           SCI_MAKE_BL     SCI_TX_DONE_NB, 4
                                      ;#Helper functions                                                               (SCI_MAKE_BL)
                                      ;#----------------                                                               (SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (SCI_MAKE_BL)
001479 003079 14 10                   LOOP                    SEI                                                      (SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (SCI_MAKE_BL)
00147B 00307B 07 EE                                           JOBSR   SCI_TX_DONE_NB                                   (SCI_MAKE_BL)
00147D 00307D 24 03                                           BCC     WAIT            ;function unsuccessful           (SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (SCI_MAKE_BL)
00147F 00307F 10 EF                                           CLI                                                      (SCI_MAKE_BL)
                                                              ;Done                                                    (SCI_MAKE_BL)
001481 003081 MACRO                                           SSTACK_PREPULL  2                                        (SCI_MAKE_BL)
001481 003081 3D                                              RTS                                                      (SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (SCI_MAKE_BL)
001482 003082 MACRO                   WAIT                    ISTACK_WAIT                                              (SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (SCI_MAKE_BL/ISTACK_WAIT)
001482 003082 10 EF                                           CLI                                                      (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (SCI_MAKE_BL)
001484 003084 MACRO                                           SSTACK_PREPUSH  4                                        (SCI_MAKE_BL)
001484 003084 20 F3                                           JOB     LOOP                                             (SCI_MAKE_BL)
                                      ;#Receive one byte - non-blocking ;OK!
                                      ; args:   none
                                      ; result: A:      error flags
                                      ;         B:      received data
                                      ;         C-flag: set if successful
                                      ; SSTACK: 5 bytes
                                      ;         X and Y are preserved
001486 003086 -> $1486                SCI_RX_NB               EQU     *
                                                              ;Save registers
001486 003086 34                                              PSHX                                            ;save X
001487 003087 10 FE                                           CLC                                             ;signal failure by default
001489 003089 39                                              PSHC                                            ;save CCR
                                                              ;Check if there is data in the RX queue
00148A 00308A FC 19 CC                                        LDD     SCI_RXBUF_IN                            ;A:B=in:out
00148D 00308D 18 16                                           SBA                                             ;A=in-out
00148F 00308F 27 1E                                           BEQ     SCI_RX_NB_5                             ;RX buffer is empty (failure)
                                                              ;Signal success
001491 003091 0C 80 01                                        BSET    0,SP, #$01                              ;set C-flag
                                                              ;Pull entry from the RX queue (in-out in A, out in B)
001494 003094 CE 19 8C                                        LDX     #SCI_RXBUF                              ;buffer pointer -> X
001497 003097 EE E5                                           LDX     B,X                                     ;flags:data -> X
001499 003099 CB 02                                           ADDB    #$02                                    ;increment out
00149B 00309B C4 3F                                           ANDB    #SCI_RXBUF_MASK                         ;wrap out
00149D 00309D 7B 19 CD                                        STAB    SCI_RXBUF_OUT                           ;update out
                                                              ;Check if more RX buffer is running empty (in-out in A, flags:data in X)
0014A0 0030A0 84 3F                                           ANDA    #SCI_RXBUF_MASK                         ;adjust RX data count
0014A2 0030A2 81 04                                           CMPA    #SCI_RX_EMPTY_LEVEL                     ;check flow control threshold
0014A4 0030A4 26 07                                           BNE     SCI_RX_NB_2                             ;don't apply flow control
0014A6 0030A6 1C 19 D8 80                                     BSET    SCI_EXCPT,#SCI_EXCPT_RXFC               ;request flow control handletr
0014AA 0030AA 4C CB 80                                        BSET    SCICR2, #TXIE                           ;enable TX interrupt
                                                              ;Return result (flags:data in X)
0014AD 0030AD B7 54                   SCI_RX_NB_2             TFR     X, D                                    ;flags:data -> D
                                                              ;Restore registers (flags:data in D)
0014AF 0030AF MACRO                   SCI_RX_NB_5             SSTACK_PREPULL  5                               ;check SSTACK
0014AF 0030AF 38                                              PULC                                            ;restore CCR (incl. result)
0014B0 0030B0 30                                              PULX                                            ;restore X
                                                              ;Done
0014B1 0030B1 3D                                              RTS
                                      ;#Receive one byte - blocking
                                      ; args:   none
                                      ; result: A:      error flags
                                      ;         B:      received data
                                      ; SSTACK: 7 bytes
                                      ;         X and Y are preserved
0014B2 0030B2 -> $14B2                SCI_RX_BL               EQU     *
0014B2 0030B2 MACRO                                           SCI_MAKE_BL     SCI_RX_NB, 5
                                      ;#Helper functions                                                               (SCI_MAKE_BL)
                                      ;#----------------                                                               (SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (SCI_MAKE_BL)
0014B2 0030B2 14 10                   LOOP                    SEI                                                      (SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (SCI_MAKE_BL)
0014B4 0030B4 07 D0                                           JOBSR   SCI_RX_NB                                        (SCI_MAKE_BL)
0014B6 0030B6 24 03                                           BCC     WAIT            ;function unsuccessful           (SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (SCI_MAKE_BL)
0014B8 0030B8 10 EF                                           CLI                                                      (SCI_MAKE_BL)
                                                              ;Done                                                    (SCI_MAKE_BL)
0014BA 0030BA MACRO                                           SSTACK_PREPULL  2                                        (SCI_MAKE_BL)
0014BA 0030BA 3D                                              RTS                                                      (SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (SCI_MAKE_BL)
0014BB 0030BB MACRO                   WAIT                    ISTACK_WAIT                                              (SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (SCI_MAKE_BL/ISTACK_WAIT)
0014BB 0030BB 10 EF                                           CLI                                                      (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (SCI_MAKE_BL)
0014BD 0030BD MACRO                                           SSTACK_PREPUSH  5                                        (SCI_MAKE_BL)
0014BD 0030BD 20 F3                                           JOB     LOOP                                             (SCI_MAKE_BL)
                                      ;#Check if there is data in the RX queue
                                      ; args:   none
                                      ; result: C-flag: set if successful
                                      ; SSTACK: 5 bytes
                                      ;         X, Y and D are preserved
0014BF 0030BF -> $14BF                SCI_RX_READY_NB         EQU     *
                                                              ;Save registers
0014BF 0030BF 3B                                              PSHD                                            ;save D
0014C0 0030C0 10 FE                                           CLC                                             ;default result: failure
0014C2 0030C2 39                                              PSHC                                            ;save CCR (incl. default result)
                                                              ;Check if there is data in the RX queue
0014C3 0030C3 FC 19 CC                                        LDD     SCI_RXBUF_IN                            ;in:out -> A:B
0014C6 0030C6 18 17                                           CBA                                             ;check is RX data is available
0014C8 0030C8 27 03                                           BEQ     SCI_RX_READY_NB_1                       ;buffer is empty
                                                              ;Signal success
0014CA 0030CA 0C 80 01                                        BSET    0,SP, #1                                ;set C-flag
                                                              ;Restore registers
0014CD 0030CD MACRO                   SCI_RX_READY_NB_1       SSTACK_PREPULL  5                               ;check SSTACK
0014CD 0030CD 38                                              PULC                                            ;restore CCR (incl. result)
0014CE 0030CE 3A                                              PULD                                            ;restore D
                                                              ;Done
0014CF 0030CF 3D                                              RTS
                                      ;#Wait until there is data in the RX queue
                                      ; args:   none
                                      ; result: none
                                      ; SSTACK: 7 bytes
                                      ;         X, Y and D are preserved
0014D0 0030D0 -> $14D0                SCI_RX_READY_BL         EQU     *
0014D0 0030D0 MACRO                                           SCI_MAKE_BL     SCI_RX_READY_NB, 5
                                      ;#Helper functions                                                               (SCI_MAKE_BL)
                                      ;#----------------                                                               (SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (SCI_MAKE_BL)
0014D0 0030D0 14 10                   LOOP                    SEI                                                      (SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (SCI_MAKE_BL)
0014D2 0030D2 07 EB                                           JOBSR   SCI_RX_READY_NB                                  (SCI_MAKE_BL)
0014D4 0030D4 24 03                                           BCC     WAIT            ;function unsuccessful           (SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (SCI_MAKE_BL)
0014D6 0030D6 10 EF                                           CLI                                                      (SCI_MAKE_BL)
                                                              ;Done                                                    (SCI_MAKE_BL)
0014D8 0030D8 MACRO                                           SSTACK_PREPULL  2                                        (SCI_MAKE_BL)
0014D8 0030D8 3D                                              RTS                                                      (SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (SCI_MAKE_BL)
0014D9 0030D9 MACRO                   WAIT                    ISTACK_WAIT                                              (SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (SCI_MAKE_BL/ISTACK_WAIT)
0014D9 0030D9 10 EF                                           CLI                                                      (SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (SCI_MAKE_BL)
0014DB 0030DB MACRO                                           SSTACK_PREPUSH  5                                        (SCI_MAKE_BL)
0014DB 0030DB 20 F3                                           JOB     LOOP                                             (SCI_MAKE_BL)
                                      ;#TIM OC ISR
                                      ;-----------
                                      ;  Baud rate detection:
                                      ;    Invalidate last IC edge at every OC event
                                      ;    Calcuate and set baud rate when delay is over
                                      ;      Restart baud rate detection if baud rate is invalid
                                      ;  XON/XOFF flow control
                                      ;    Disable OC
                                      ;    Request XON/XOFF transmission
                                      ;  RTS polling
                                      ;    Disable OC
                                      ;    Run RX/TX ISR
0014DD 0030DD -> $14DD                SCI_ISR_OC              EQU     *
0014DD 0030DD                                                 //Clear interrupt flag
0014DD 0030DD MACRO                                           TIM_CLRIF, SCI_OC_TIM, SCI_OC           ;clear IF
                                      ;#Clear one interrupt flag                                                       (TIM_CLRIF)
                                      ; args: 1: start address of register space                                       (TIM_CLRIF)
                                      ;       2: channel number                                                        (TIM_CLRIF)
                                      ; SSTACK: none                                                                   (TIM_CLRIF)
                                      ;         X, Y, and D are preserved                                              (TIM_CLRIF)
0014DD 0030DD MACRO                                           TIM_MULT_CLRIF  SCI_OC_TIM, (1<<SCI_OC)                  (TIM_CLRIF)
                                      ;#Clear multiple interrupt flags                                                 (TIM_CLRIF/TIM_MULT_CLRIF)
                                      ; args: 1: start address of register space                                       (TIM_CLRIF/TIM_MULT_CLRIF)
                                      ;       2: channel mask                                                          (TIM_CLRIF/TIM_MULT_CLRIF)
                                      ; SSTACK: none                                                                   (TIM_CLRIF/TIM_MULT_CLRIF)
                                      ;         X, Y, and D are preserved                                              (TIM_CLRIF/TIM_MULT_CLRIF)
0014DD 0030DD 18 0B 01 00 4E                                  MOVB    #1<<SCI_OC, SCI_OC_TIM+TFLG1_OFFSET              (TIM_CLRIF/TIM_MULT_CLRIF)
                                                              ;########################################
                                                              ;# RTS/CTS                              #
                                                              ;# =======                              #
                                                              ;# - Set TXIE after RTS poll delay      #
                                                              ;########################################
                                                              ;Enable TX interrupt
0014E2 0030E2 1C 19 D8 80                                     BSET    SCI_EXCPT,#SCI_EXCPT_RXFC               ;request exception handler
0014E6 0030E6 4C CB 80                                        BSET    SCICR2, #TXIE                           ;enable TX interrupt
0014E9 0030E9 MACRO                                           TIM_DIS SCI_OC_TIM, SCI_OC                      ;disable OC
                                      ;#Disable one timer channel                                                      (TIM_DIS)
                                      ; args: 1: start address of register space                                       (TIM_DIS)
                                      ;       2: channel number                                                        (TIM_DIS)
                                      ; SSTACK: none                                                                   (TIM_DIS)
                                      ;         X, Y, and D are preserved                                              (TIM_DIS)
0014E9 0030E9 MACRO                                           TIM_MULT_DIS    SCI_OC_TIM, (1<<SCI_OC)                  (TIM_DIS)
                                      ;#Disable multiple timer channels                                                (TIM_DIS/TIM_MULT_DIS)
                                      ; args: 1: start address of register space                                       (TIM_DIS/TIM_MULT_DIS)
                                      ;       2: channel mask                                                          (TIM_DIS/TIM_MULT_DIS)
                                      ; SSTACK: none                                                                   (TIM_DIS/TIM_MULT_DIS)
                                      ;         X, Y, and D are preserved                                              (TIM_DIS/TIM_MULT_DIS)
0014E9 0030E9 4D 4C 01                                        BCLR    SCI_OC_TIM+TIE_OFFSET, #1<<SCI_OC                (TIM_DIS/TIM_MULT_DIS)
0014EC 0030EC 26 03                                           BNE     DONE                                             (TIM_DIS/TIM_MULT_DIS)
0014EE 0030EE 79 00 46                DISABLE                 CLR     SCI_OC_TIM+TSCR1_OFFSET                          (TIM_DIS/TIM_MULT_DIS)
0014F1 0030F1 -> $14F1                DONE                    EQU     *                                                (TIM_DIS/TIM_MULT_DIS)
                                                              ;Done
0014F1 0030F1 MACRO                                           ISTACK_RTI                                      ;done
                                      ;#Return from interrupt                                                          (ISTACK_RTI)
                                      ; args:   none                                                                   (ISTACK_RTI)
                                      ; ISTACK: -9 (S12)/-10 (S12X)                                                    (ISTACK_RTI)
                                      ;         X, Y, and D are pulled from the interrupt stack                        (ISTACK_RTI)
                                                              ;End ISR                                                 (ISTACK_RTI)
0014F1 0030F1 0B                                              RTI                                                      (ISTACK_RTI)
                                      ;#SCI EXCPT ISR (status flags in A)
                                      ;----------------------------------
0014F2 0030F2 -> $14F2                SCI_ISR_EXCPT           EQU     *
                                                              ;Handle RXFC request (status flags in A)
                                                              ;---------------------------------------
                                                              ;Check if an RXFC request is pending
0014F2 0030F2 1F 19 D8 80 1D                                  BRCLR   SCI_EXCPT,#SCI_EXCPT_RXFC,SCI_ISR_EXCPT_3;handle another exception
                                                              ;Check RX buffer
0014F7 0030F7 FC 19 CC                                        LDD     SCI_RXBUF_IN                            ;A:B=in:out
0014FA 0030FA 18 16                                           SBA                                             ;A=in-out
0014FC 0030FC 84 3F                                           ANDA    #SCI_RXBUF_MASK                         ;adjust RX data count
                                                              ;Check empty level (char count in A)
0014FE 0030FE 81 04                                           CMPA    #SCI_RX_EMPTY_LEVEL                     ;check flow control threshold
001500 003100 22 06                                           BHI     SCI_ISR_EXCPT_1                         ;don't apply flow control
                                                              ;Allow incoming data
001502 003102 MACRO                                           SCI_ASSERT_CTS                                  ;set CTS
                                      ;#Assert CTS (Clear To Send - allow incoming data)                               (SCI_ASSERT_CTS)
                                      ; args:   none                                                                   (SCI_ASSERT_CTS)
                                      ; result: none                                                                   (SCI_ASSERT_CTS)
                                      ; SSTACK: none                                                                   (SCI_ASSERT_CTS)
                                      ;         X, Y, and D are preserved                                              (SCI_ASSERT_CTS)
001502 003102 1D 02 50 02                                     BCLR    SCI_CTS_PORT, #SCI_CTS_PIN              ;clear CTS (allow RX data) (SCI_ASSERT_CTS)
001506 003106 20 08                                           JOB     SCI_ISR_EXCPT_2                         ;done
                                                              ;Check full level (char count in A)
001508 003108 81 36                   SCI_ISR_EXCPT_1         CMPA    #SCI_RX_FULL_LEVEL                      ;check flow control threshold
00150A 00310A 25 04                                           BLO     SCI_ISR_EXCPT_2                         ;don't apply flow control
                                                              ;Block incoming data
00150C 00310C MACRO                                           SCI_DEASSERT_CTS                                ;clear CTS
                                      ;#Deassert CTS (stop incoming data)                                              (SCI_DEASSERT_CTS)
                                      ; args:   none                                                                   (SCI_DEASSERT_CTS)
                                      ; SSTACK: none                                                                   (SCI_DEASSERT_CTS)
                                      ;         X, Y, and D are preserved                                              (SCI_DEASSERT_CTS)
00150C 00310C 1C 02 50 02                                     BSET    SCI_CTS_PORT, #SCI_CTS_PIN              ;set CTS (prohibit RX data) (SCI_DEASSERT_CTS)
001510 003110                         SCI_ISR_EXCPT_2         ;Clear RXFC request
001510 003110 1D 19 D8 80                                     BCLR    SCI_EXCPT,#SCI_EXCPT_RXFC               ;clear RXFC request
001514 003114 -> $1514                SCI_ISR_EXCPT_3         EQU     *
                                                              ;Done
001514 003114 MACRO                   SCI_ISR_EXCPT_8         ISTACK_RTI                                      ;done
                                      ;#Return from interrupt                                                          (ISTACK_RTI)
                                      ; args:   none                                                                   (ISTACK_RTI)
                                      ; ISTACK: -9 (S12)/-10 (S12X)                                                    (ISTACK_RTI)
                                      ;         X, Y, and D are pulled from the interrupt stack                        (ISTACK_RTI)
                                                              ;End ISR                                                 (ISTACK_RTI)
001514 003114 0B                                              RTI                                                      (ISTACK_RTI)
                                      ;#SCI TX ISR (status flags in A)
                                      ;-------------------------------
001515 003115 -> $1515                SCI_ISR_TX              EQU     *
                                                              ;Check action requests (status flags in A)
001515 003115 F6 19 D8                                        LDAB    SCI_EXCPT                               ;exceptions -> A
001518 003118 C5 80                                           BITB    #SCI_EXCPT_ANY                          ;only check implemented requests
00151A 00311A 26 D6                                           BNE     SCI_ISR_EXCPT                           ;process exception handlers
                                                              ;Make sure TDRE is set (status flags in A)
00151C 00311C 97                                              TSTA                                            ;check TDRE
00151D 00311D 2A 3E                                           BPL     SCI_ISR_TX_4                            ;done
                                                              ;Check TX flow control
00151F 00311F 1F 02 50 01 19                                  BRCLR   SCI_RTS_PORT,#SCI_RTS_PIN,SCI_ISR_TX_2  ;transmission permitted
001524 003124 MACRO                                           SCI_LDD_FRAME_DELAY     1                       ;poll delay -> D
                                      ;#Load TCs for the length a given number of SCI frames into accu D               (SCI_LDD_FRAME_DELAY)
                                      ; args:   1: delay in SCI frames                                                 (SCI_LDD_FRAME_DELAY)
                                      ; result: D: TCs roughly equivalent to 2 SCI frames                              (SCI_LDD_FRAME_DELAY)
                                      ; SSTACK: 0 bytes                                                                (SCI_LDD_FRAME_DELAY)
                                      ;         X is preserved                                                         (SCI_LDD_FRAME_DELAY)
                                      ; SCI V6: TC = FRAMES *  10 * SCIBD * CLOCK_BUS_FREQ/TIM_FREQ                    (SCI_LDD_FRAME_DELAY)
                                      ; SCI V5: TC = FRAMES * 160 * SCIBD * CLOCK_BUS_FREQ/TIM_FREQ                    (SCI_LDD_FRAME_DELAY)
                                                              ;Fixed baud rate                                         (SCI_LDD_FRAME_DELAY)
001524 003124 CC 00 13                                        LDD     #((1*160*$140*SCI_BAUD)/TIM_FREQ);TC -> D        (SCI_LDD_FRAME_DELAY)
001527 003127 D3 44                                           ADDD    SCI_OC_TCNT                             ;new OC timestamp -> D
001529 003129 5C 50                                           STD     SCI_OC_TC                               ;setup OC
00152B 00312B MACRO                                           TIM_EN  SCI_OC_TIM, SCI_OC                      ;enable timer
                                      ;#Enable one timer channel                                                       (TIM_EN)
                                      ; args: 1: start address of register space                                       (TIM_EN)
                                      ;       2: channel number                                                        (TIM_EN)
                                      ; SSTACK: none                                                                   (TIM_EN)
                                      ;         X, Y, and D are preserved                                              (TIM_EN)
00152B 00312B MACRO                                           TIM_MULT_EN     SCI_OC_TIM, (1<<SCI_OC)                  (TIM_EN)
                                      ;#Enable multiple timer channels                                                 (TIM_EN/TIM_MULT_EN)
                                      ; args: 1: start address of register space                                       (TIM_EN/TIM_MULT_EN)
                                      ;       2: channels  mask                                                        (TIM_EN/TIM_MULT_EN)
                                      ; SSTACK: none                                                                   (TIM_EN/TIM_MULT_EN)
                                      ;         X, Y, and D are preserved                                              (TIM_EN/TIM_MULT_EN)
00152B 00312B 18 0B 01 00 4E                                  MOVB    #1<<SCI_OC, SCI_OC_TIM+TFLG1_OFFSET            ;clear interrupt flags (TIM_EN/TIM_MULT_EN)
001530 003130 4C 4C 01                                        BSET    SCI_OC_TIM+TIE_OFFSET, #1<<SCI_OC              ;enable interrupts (TIM_EN/TIM_MULT_EN)
001533 003133 18 0B A0 00 46                                  MOVB    #(TEN|TSFRZ), SCI_OC_TIM+TSCR1_OFFSET   ;enable timer (TIM_EN/TIM_MULT_EN)
001538 003138 4D CB 80                                        BCLR    SCICR2, #TXIE                           ;disable TX interrupt
00153B 00313B 20 20                                           JOB     SCI_ISR_TX_4                            ;done
                                                              ;Check TX buffer
00153D 00313D FC 19 D6                SCI_ISR_TX_2            LDD     SCI_TXBUF_IN                            ;in:out -> A:B
001540 003140 18 17                                           CBA                                             ;check if buffer is empty
001542 003142 27 1A                                           BEQ     SCI_ISR_TX_5                            ;buffer is empty
                                                              ;Get TX data (in:out in D)
001544 003144 CD 19 CE                                        LDY     #SCI_TXBUF                              ;buffer pointer -> Y
001547 003147 A6 ED                                           LDAA    B,Y                                     ;data -> A
                                                              ;Handle DLE code (data in A, out in B)
001549 003149 1D 19 D9 40                                     BCLR    SCI_STAT,#SCI_STAT_TXDLE                ;release sequence lock
00154D 00314D 81 10                                           CMPA    #SCI_C0_DLE                             ;check for DLE
00154F 00314F 26 04                                           BNE     SCI_ISR_TX_3                            ;no DLE code
001551 003151 1C 19 D9 40                                     BSET    SCI_STAT,#SCI_STAT_TXDLE                ;flag atomic sequence
                                                              ;Transmit data (data in A, out in B)
001555 003155 5A CF                   SCI_ISR_TX_3            STAA    SCIDRL                                  ;transmit data
                                                              ;Increment index (out in B)
001557 003157 52                                              INCB                                            ;advance out index
001558 003158 C4 07                                           ANDB    #SCI_TXBUF_MASK                         ;wrap out index
00155A 00315A 7B 19 D7                                        STAB    SCI_TXBUF_OUT                           ;update out index
                                                              ;Done
00155D 00315D MACRO                   SCI_ISR_TX_4            ISTACK_RTI                                      ;done
                                      ;#Return from interrupt                                                          (ISTACK_RTI)
                                      ; args:   none                                                                   (ISTACK_RTI)
                                      ; ISTACK: -9 (S12)/-10 (S12X)                                                    (ISTACK_RTI)
                                      ;         X, Y, and D are pulled from the interrupt stack                        (ISTACK_RTI)
                                                              ;End ISR                                                 (ISTACK_RTI)
00155D 00315D 0B                                              RTI                                                      (ISTACK_RTI)
                                                              ;TX buffer is empty
00155E 00315E F7 19 D8                SCI_ISR_TX_5            TST     SCI_EXCPT                               ;RXFC->N, /others->Z, 0->V
001561 003161 2E FA                                           BGT     SCI_ISR_TX_4                            ;Z + (N ^ V) = 0
001563 003163 4D CB 80                                        BCLR    SCICR2, #TXIE                           ;disable TX interrupt
001566 003166 20 F5                                           JOB     SCI_ISR_TX_4                            ;done
                                      ;#SCI RX/TX ISR (SCI ISR)
                                      ;------------------------
001568 003168 -> $1568                SCI_ISR_RXTX            EQU     *
                                                              ;Common entry point for all SCI interrupts
                                                              ;Load flags
001568 003168 96 CC                                           LDAA    SCISR1                                  ;load status flags into accu A
                                                                                                              ;SCI Flag order:
                                                                                                              ; 7:TDRE (Transmit Data Register Empty Flag)
                                                                                                              ; 6:TC   (TransmitCompleteFlag)
                                                                                                              ; 5:RDRF (Receive Data Register Full Flag)
                                                                                                              ; 4:IDLE (Idle Line Flag)
                                                                                                              ; 3:OR   (Overrun Flag)
                                                                                                              ; 2:NF   (Noise Flag)
                                                                                                              ; 1:FE   (Framing Error Flag)
                                                                                                              ; 0:PE   (Parity Error Flag)
                                                              ;Check for RX data (status flags in A)
00156A 00316A 85 28                                           BITA    #(RDRFF|OR)                             ;go to receive handler if receive buffer
00156C 00316C 27 A7                                           BEQ     SCI_ISR_TX                              ;process requested actions
                                      ;#SCI RX ISR (status flags in A)
                                      ;-------------------------------
00156E 00316E D6 CF                   SCI_ISR_RX              LDAB    SCIDRL                                  ;load receive data into accu B (clears flags)
                                                              ;Transfer hardware flag to metadata (status flags in A, RX data in B)
001570 003170 84 0F                                           ANDA    #(OR|NF|FE|PF)                          ;keep  error flags
                                                              ;Check for C0 range (metadata in A, RX data in B)
001572 003172 C1 1A                   SCI_ISR_RX_1            CMPB    #SCI_C0_US                              ;check for lower C0 range
001574 003174 2F 04                                           BLE     SCI_ISR_RX_2                            ;decode C0 character
001576 003176 C1 7F                                           CMPB    #SCI_C0_DEL                             ;check for DEL
001578 003178 26 02                                           BNE     SCI_ISR_RX_3                            ;no C0 character
00157A 00317A 8A 40                   SCI_ISR_RX_2            ORAA    #SCI_META_C0                            ;mark as C0 character
                                                              ;Check for C1 range (metadata in A, RX data in B)
00157C 00317C D7                      SCI_ISR_RX_3            TSTB                                            ;check for C1 range
00157D 00317D 2A 02                                           BPL     SCI_ISR_RX_4                            ;no C1 character
00157F 00317F 8A 80                                           ORAA    #SCI_META_C1                            ;mark as C1 character
                                                              ;Transfer SWOR und DLE flags to metadata (metadata in A, RX data in B)
001581 003181 B7 15                   SCI_ISR_RX_4            TFR     B, X                                    ;RX data -> X
001583 003183 F6 19 D9                                        LDAB    SCI_STAT                                ;get status bits
001586 003186 C4 30                                           ANDB    #(SCI_STAT_RXDLE|SCI_STAT_SWOR)                 ;mask DLE and SWOR
001588 003188 18 06                                           ABA                                             ;transfer status bits to metadata
00158A 00318A B7 51                                           TFR     X, B                                    ;RX data -> X
                                                              ;Interpret C0 codes if there is no error (metadata in A, RX data in B)
00158C 00318C 81 40                   SCI_ISR_RX_5            CMPA    #SCI_META_C0                            ;check for C0 and no errors
00158E 00318E 26 0A                                           BNE     SCI_ISR_RX_13                           ;queue RX data
                                                              ;Interpret DLE (RX data in B)
001590 003190 C1 10                                           CMPB    #SCI_C0_DLE                             ;check for DLE
001592 003192 26 06                                           BNE     SCI_ISR_RX_6                            ;no DLE character
001594 003194 1C 19 D9 20                                     BSET    SCI_STAT,#SCI_STAT_RXDLE                        ;set DLE status
001598 003198 20 30                                           JOB     SCI_ISR_RX_16                           ;done
00159A 00319A -> $159A                SCI_ISR_RX_6            EQU     *                                       ;no DLE character
                                                              ;Queue RX data (metadata in A, RX data in B)
00159A 00319A 1D 19 D9 30             SCI_ISR_RX_13           BCLR    SCI_STAT, #(SCI_STAT_RXDLE|SCI_STAT_SWOR);clear DLE and SWOR status
00159E 00319E B7 46                                           TFR     D, Y                                    ;metadata:RX data -> Y
0015A0 0031A0 CE 19 8C                                        LDX     #SCI_RXBUF                              ;buffer pointer -> X
0015A3 0031A3 FC 19 CC                                        LDD     SCI_RXBUF_IN                            ;in:out -> A:B
0015A6 0031A6 6D E4                                           STY     A,X                                     ;store metadata:RX data in buffer
0015A8 0031A8 8B 02                                           ADDA    #2                                      ;advance in pointer
0015AA 0031AA 84 3F                                           ANDA    #SCI_RXBUF_MASK                         ;
0015AC 0031AC 18 17                                           CBA                                             ;check for buffer overflow
0015AE 0031AE 27 11                                           BEQ     SCI_ISR_RX_14                           ;buffer overflow
0015B0 0031B0 7A 19 CC                                        STAA    SCI_RXBUF_IN                            ;update IN pointer
                                                              ;Check if flow control must be applied (in:out in D, flags:data in Y)
0015B3 0031B3 18 16                                           SBA                                             ;determine free buffer space
0015B5 0031B5 84 3F                                           ANDA    #SCI_RXBUF_MASK                         ;
0015B7 0031B7 81 36                                           CMPA    #SCI_RX_FULL_LEVEL                      ;check for threshold
0015B9 0031B9 25 0F                                           BLO     SCI_ISR_RX_16                           ;buffer is getting full
                                                              ;Deassert CTS (flags:data in Y)
                                                              ;BSET   SCI_EXCPT,#SCI_EXCPT_RXFC               ;request flow control handletr
                                                              ;JOB    SCI_ISR_RX_15                           ;enable TX interrupt
0015BB 0031BB MACRO                                           SCI_DEASSERT_CTS                                ;clear CTS
                                      ;#Deassert CTS (stop incoming data)                                              (SCI_DEASSERT_CTS)
                                      ; args:   none                                                                   (SCI_DEASSERT_CTS)
                                      ; SSTACK: none                                                                   (SCI_DEASSERT_CTS)
                                      ;         X, Y, and D are preserved                                              (SCI_DEASSERT_CTS)
0015BB 0031BB 1C 02 50 02                                     BSET    SCI_CTS_PORT, #SCI_CTS_PIN              ;set CTS (prohibit RX data) (SCI_DEASSERT_CTS)
0015BF 0031BF 20 09                                           JOB     SCI_ISR_RX_16                           ;done
                                                              ;Buffer overflow
0015C1 0031C1 -> $15C1                SCI_ISR_RX_14           EQU     *
0015C1 0031C1 1C 19 D9 10                                     BSET    SCI_STAT,#SCI_STAT_SWOR                 ;set SWOR status
0015C5 0031C5 20 03                                           JOB     SCI_ISR_RX_16
                                                              ;Enable TX interrupt
0015C7 0031C7 4C CB 80                SCI_ISR_RX_15           BSET    SCICR2, #TXIE                           ;enable TX interrupt
                                                              ;Done
0015CA 0031CA MACRO                   SCI_ISR_RX_16           ISTACK_RTI                                      ;done
                                      ;#Return from interrupt                                                          (ISTACK_RTI)
                                      ; args:   none                                                                   (ISTACK_RTI)
                                      ; ISTACK: -9 (S12)/-10 (S12X)                                                    (ISTACK_RTI)
                                      ;         X, Y, and D are pulled from the interrupt stack                        (ISTACK_RTI)
                                                              ;End ISR                                                 (ISTACK_RTI)
0015CA 0031CA 0B                                              RTI                                                      (ISTACK_RTI)
0015CB 0031CB -> $155D                SCI_ISR_RX_17           EQU     SCI_ISR_TX_4                            ;done
0015CB 0031CB -> $15CB                SCI_CODE_END            EQU     *
0015CB 0031CB -> $31CB                SCI_CODE_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
001400 003000                                                 ORG     SCI_TABS_START, SCI_TABS_START_LIN
001400 003000 -> $1400                SCI_TABS_END            EQU     *
001400 003000 -> $3000                SCI_TABS_END_LIN        EQU     @
                                      ;#######################################################x#######################
                                      ;# Configuration                                                               #
                                      ;###############################################################################
                                      ;TIM configuration
                                      ;-----------------
                                      ;TIM instance
001400 003000 -> $0040                LED_TIM                 EQU     TIOS            ;default is the TIM instance associated with TIOS
                                      ;Output compare channel
001400 003000 -> $0003                LED_OC                  EQU     3               ;default is OC3
                                      ;LED C
001400 003000 -> $0001                LED_C_BLINK_OFF         EQU     1               ;blink patterns disabled by default
001400 003000 -> $0258                LED_C_PORT              EQU     PTP             ;default is port P
001400 003000 -> $0004                LED_C_PIN               EQU     PP2             ;default is PP2
                                      ;LED D
001400 003000 -> $0001                LED_D_BLINK_OFF         EQU     1               ;blink patterns disabled by default
001400 003000 -> $0258                LED_D_PORT              EQU     PTP             ;default is port P
001400 003000 -> $0008                LED_D_PIN               EQU     PP3             ;default is PP3
                                      ;Non-requrring sequences
001400 003000 -> $00C0                LED_NONREC_MASK         EQU     $C0             ;default is patterns 7 and 8
                                      ; TIOS
001400 003000 -> $0000                LED_TIOS_INIT           EQU     0
                                      ;#Output compare register
001400 003000 -> $0056                LED_OC_TC               EQU     LED_TIM+(TC0-TIOS)+(2*LED_OC)
                                      ;#Timer intervall
                                      ;LED_OC_CNT_RST         EQU     (TIM_FREQ/4)>>17                ;1/4 sec
001400 003000 -> $002F                LED_OC_CNT_RST          EQU     TIM_FREQ>>19                    ;1/8 sec
                                      ;#Request masks
001400 003000 -> $00FE                LED_TIMED_REQS          EQU     $FE                             ;mask for timed requests
001400 003000 -> $00C0                LED_NONREC_REQS         EQU     $C0                             ;mask for non-recurring requests
                                      ;#Signal indexes
001400 003000 -> $0007                LED_SEQ_SHORT_PULSE     EQU     7
001400 003000 -> $0006                LED_SEQ_L0NG_PULSE      EQU     6
001400 003000 -> $0005                LED_SEQ_FAST_BLINK      EQU     5
001400 003000 -> $0004                LED_SEQ_SLOW_BLINK      EQU     4
001400 003000 -> $0003                LED_SEQ_SINGLE_GAP      EQU     3
001400 003000 -> $0002                LED_SEQ_DOUBLE_GAP      EQU     2
001400 003000 -> $0001                LED_SEQ_HEART_BEAT      EQU     1
001400 003000 -> $0000                LED_SEQ_ON              EQU     0
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
0019ED 0019ED                                                 ORG     LED_VARS_START, LED_VARS_START_LIN
0019ED 0019ED -> $19ED                LED_VARS_END            EQU     *
0019ED 0019ED -> $19ED                LED_VARS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
00386B 00386B                                                 ORG     LED_CODE_START, LED_CODE_START_LIN
00386B 00386B -> $386B                LED_CODE_END            EQU     *
00386B 00386B -> $386B                LED_CODE_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     LED_TABS_START, LED_TABS_START_LIN
003926 003926 -> $3926                LED_TABS_END            EQU     *
003926 003926 -> $3926                LED_TABS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;#ASCII code
003926 003926 -> $0004                STRING_SYM_EOT          EQU     $04     ;EOT (ctrl-D)
003926 003926 -> $0007                STRING_SYM_BEEP         EQU     $07     ;acoustic signal
003926 003926 -> $0008                STRING_SYM_BACKSPACE    EQU     $08     ;backspace symbol
003926 003926 -> $0009                STRING_SYM_TAB          EQU     $09     ;tab symbol
003926 003926 -> $000A                STRING_SYM_LF           EQU     $0A     ;line feed symbol
003926 003926 -> $000D                STRING_SYM_CR           EQU     $0D     ;carriage return symbol
003926 003926 -> $0020                STRING_SYM_SPACE        EQU     $20     ;space (first printable ASCII character)
003926 003926 -> $007E                STRING_SYM_TILDE        EQU     $7E     ;"~" (last printable ASCII character)
003926 003926 -> $007F                STRING_SYM_DEL          EQU     $7F     ;delete symbol
                                      ;#String ternination
003926 003926 -> $0080                STRING_TERM             EQU     $80     ;MSB for string termination
                                      ;#Line break
003926 003926 -> $000D                STRING_NL_1ST           EQU     STRING_SYM_CR
003926 003926 -> $000A                STRING_NL_2ND           EQU     STRING_SYM_LF
003926 003926 -> $0D0A                STRING_NL               EQU     ((STRING_NL_1ST<<8)|STRING_NL_2ND)
003926 003926 -> $0002                STRING_NL_BYTE_COUNT    EQU     2
                                      ;#Empty string
003926 003926 -> $0000                STRING_EMPTY            EQU     $0000
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
0019DA 0019DA                                                 ORG     STRING_VARS_START, STRING_VARS_START_LIN
0019DA 0019DA -> $19DA                STRING_VARS_END         EQU     *
0019DA 0019DA -> $19DA                STRING_VARS_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
0015CB 0031CB                                                 ORG     STRING_CODE_START, STRING_CODE_START_LIN
                                      ;#Basic print function - non-blocking
                                      ; args:   X:      start of the string
                                      ; result: X:      remaining string (points to the byte after the string, if successful)
                                      ;         C-flag: set if successful
                                      ; SSTACK: 8 bytes
                                      ;         Y and D are preserved
0015CB 0031CB -> $15CB                STRING_PRINT_NB         EQU     *
                                                              ;Save registers (string pointer in X)
0015CB 0031CB 37                                              PSHB                            ;save B
                                                              ;Print characters (string pointer in X)
0015CC 0031CC E6 30                   STRING_PRINT_NB_1       LDAB    1,X+                    ;get next ASCII character
0015CE 0031CE 2B 0A                                           BMI     STRING_PRINT_NB_3       ;last character
0015D0 0031D0 16 14 1A                                        JOBSR   SCI_TX_NB               ;print character non blocking (SSTACK: 5 bytes)
0015D3 0031D3 25 F7                                           BCS     STRING_PRINT_NB_1
                                                              ;Adjust string pointer (next string pointer in X)
0015D5 0031D5 09                      STRING_PRINT_NB_2       DEX
                                                              ;Restore registers (string pointer in X)
0015D6 0031D6 MACRO                                           SSTACK_PREPULL  3
0015D6 0031D6 33                                              PULB
                                                              ;Signal failure (string pointer in X)
0015D7 0031D7 10 FE                                           CLC
                                                              ;Done
0015D9 0031D9 3D                                              RTS
                                                              ;Print last character (next string pointer in X, last char in B)
0015DA 0031DA C4 7F                   STRING_PRINT_NB_3       ANDB    #$7F                    ;remove termination bit
0015DC 0031DC 16 14 1A                                        JOBSR   SCI_TX_NB               ;print character non blocking (SSTACK: 5 bytes)
0015DF 0031DF 24 F4                                           BCC     STRING_PRINT_NB_2
                                                              ;Restore registers (next string pointer in X)
0015E1 0031E1 MACRO                                           SSTACK_PREPULL  3
0015E1 0031E1 33                                              PULB
                                                              ;Signal success (next string pointer in X)
0015E2 0031E2 14 01                                           SEC
                                                              ;Done
0015E4 0031E4 3D                                              RTS
                                      ;#Basic print function - blocking
                                      ; args:   X:      start of the string
                                      ; result: X;      points to the byte after the string
                                      ; SSTACK: 10 bytes
                                      ;         Y and D are preserved
0015E5 0031E5 -> $15E5                STRING_PRINT_BL         EQU     *
0015E5 0031E5 MACRO                                           STRING_MAKE_BL  STRING_PRINT_NB, 8
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (STRING_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (STRING_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function (min. 4)            (STRING_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (STRING_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (STRING_MAKE_BL)
0015E5 0031E5 MACRO                                           SCI_MAKE_BL STRING_PRINT_NB, 8                           (STRING_MAKE_BL)
                                      ;#Helper functions                                                               (STRING_MAKE_BL/SCI_MAKE_BL)
                                      ;#----------------                                                               (STRING_MAKE_BL/SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (STRING_MAKE_BL/SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (STRING_MAKE_BL/SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (STRING_MAKE_BL/SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (STRING_MAKE_BL/SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (STRING_MAKE_BL/SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (STRING_MAKE_BL/SCI_MAKE_BL)
0015E5 0031E5 14 10                   LOOP                    SEI                                                      (STRING_MAKE_BL/SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (STRING_MAKE_BL/SCI_MAKE_BL)
0015E7 0031E7 07 E2                                           JOBSR   STRING_PRINT_NB                                  (STRING_MAKE_BL/SCI_MAKE_BL)
0015E9 0031E9 24 03                                           BCC     WAIT            ;function unsuccessful           (STRING_MAKE_BL/SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (STRING_MAKE_BL/SCI_MAKE_BL)
0015EB 0031EB 10 EF                                           CLI                                                      (STRING_MAKE_BL/SCI_MAKE_BL)
                                                              ;Done                                                    (STRING_MAKE_BL/SCI_MAKE_BL)
0015ED 0031ED MACRO                                           SSTACK_PREPULL  2                                        (STRING_MAKE_BL/SCI_MAKE_BL)
0015ED 0031ED 3D                                              RTS                                                      (STRING_MAKE_BL/SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (STRING_MAKE_BL/SCI_MAKE_BL)
0015EE 0031EE MACRO                   WAIT                    ISTACK_WAIT                                              (STRING_MAKE_BL/SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (STRING_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (STRING_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (STRING_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (STRING_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (STRING_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
0015EE 0031EE 10 EF                                           CLI                                                      (STRING_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (STRING_MAKE_BL/SCI_MAKE_BL)
0015F0 0031F0 MACRO                                           SSTACK_PREPUSH  8                                        (STRING_MAKE_BL/SCI_MAKE_BL)
0015F0 0031F0 20 F3                                           JOB     LOOP                                             (STRING_MAKE_BL/SCI_MAKE_BL)
                                      ;#Make ASCII character printable
                                      ; args:   B: ASCII character (w/out termination)
                                      ; result: B: printable ASCII character or "."
                                      ; SSTACK: 2 bytes
                                      ;         X, Y, and A are preserved
0015F2 0031F2 -> $15F2                STRING_PRINTABLE        EQU     *
0015F2 0031F2 C1 20                                           CMPB    #$20            ;" "
0015F4 0031F4 25 04                                           BLO     STRING_PRINTABLE_1
0015F6 0031F6 C1 7E                                           CMPB    #$7E            ;"~"
0015F8 0031F8 23 02                                           BLS     STRING_PRINTABLE_2
0015FA 0031FA C6 2E                   STRING_PRINTABLE_1      LDAB    #$2E            ;"."
                                                              ;Done
0015FC 0031FC MACRO                                           SSTACK_PREPULL  2
0015FC 0031FC 3D                      STRING_PRINTABLE_2      RTS
0015FD 0031FD -> $15FD                STRING_CODE_END         EQU     *
0015FD 0031FD -> $31FD                STRING_CODE_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
001400 003000                                                 ORG     STRING_TABS_START, STRING_TABS_START_LIN
                                      ;Common strings
                                      ;STRING_STR_EXCLAM_NL   DB      "!"     ;exclamation mark + new line
001400 003000 MACRO                   STRING_STR_NL           STRING_NL_TERM  ;new line
                                      ;#Terminated line break                                                          (STRING_NL_TERM)
001400 003000 0D                                              DB      STRING_NL_1ST                                    (STRING_NL_TERM)
001401 003001 8A                                              DB      (STRING_NL_2ND|STRING_TERM)                      (STRING_NL_TERM)
001402 003002 -> $1402                STRING_TABS_END         EQU     *
001402 003002 -> $3002                STRING_TABS_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     RESET_VARS_START, RESET_VARS_START_LIN
00198B 00198B -> $198B                RESET_VARS_END          EQU     *
00198B 00198B -> $198B                RESET_VARS_END_LIN      EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
003784 003784                                                 ORG     RESET_CODE_START, RESET_CODE_START_LIN
                                      ;# Entry point for COP reset
                                      ;#==========================
003784 003784 -> $3784                RESET_COP_ENTRY         EQU     *
003784 003784                                                 //Run firmware's COP reset handler
003784 003784 18 0B EF 01 20                                  MOVB    #(($FF00-BOOTLOADER_SIZE)>>8), IVBR
003789 003789 05 FB B8 6D                                     JMP     [$FFFA-BOOTLOADER_SIZE]
                                      ;# Entry point for CM reset
                                      ;#=========================
00378D 00378D -> $378D                RESET_CM_ENTRY          EQU     *
00378D 00378D                                                 //Run firmware's COP reset handler
00378D 00378D 18 0B EF 01 20                                  MOVB    #(($FF00-BOOTLOADER_SIZE)>>8), IVBR
003792 003792 05 FB B8 66                                     JMP     [$FFFC-BOOTLOADER_SIZE]
                                      ;# Entry point for common resets
                                      ;#==============================
003796 003796 -> $358B                RESET_EXT_ENTRY         EQU     START_OF_CODE
003796 003796 -> $3796                RESET_CODE_END          EQU     *
003796 003796 -> $3796                RESET_CODE_END_LIN      EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     RESET_TABS_START, RESET_TABS_START_LIN
003926 003926 -> $3926                RESET_TABS_END          EQU     *
003926 003926 -> $3926                RESET_TABS_END_LIN      EQU     @
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     LRE_VARS_START, LRE_VARS_START_LIN
00198B 00198B -> $198B                LRE_VARS_END            EQU     *
00198B 00198B -> $198B                LRE_VARS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
003796 003796                                                 ORG     LRE_CODE_START, LRE_CODE_START_LIN
003796 003796 -> $3796                LRE_CODE_END            EQU     *
003796 003796 -> $3796                LRE_CODE_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     LRE_TABS_START, LRE_TABS_START_LIN
003926 003926 -> $3926                LRE_TABS_END            EQU     *
003926 003926 -> $3926                LRE_TABS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Configuration                                                               #
                                      ;###############################################################################
                                      ;Prescaler value
                                      ;---------------
003926 003926 -> $0018                NVM_FDIV_VAL            EQU     (CLOCK_BUS_FREQ/1000000)-1 ;FTMRG clock divider
                                      ;Program buffer
                                      ;--------------
003926 003926 -> $0010                NVM_BUF_DEPTH           EQU     16                      ;max. 32 entries
                                      ;Firmware range
                                      ;--------------
003926 003926 -> $4000                NVM_FIRMWARE_START_LIN  EQU     MMAP_FLASH_F_END_LIN-MMAP_FLASH_SIZE
003926 003926 -> $3F000               NVM_FIRMWARE_END_LIN    EQU     MMAP_FLASH_F_END_LIN-BOOTLOADER_SIZE
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;#Sector size
003926 003926 -> $0200                NVM_SECTOR_SIZE         EQU     512                     ;sector size  [bytes]
003926 003926 -> $0008                NVM_PHRASE_SIZE         EQU     8                       ;phrase size  [bytes]
003926 003926 -> $0004                NVM_ADDR_SIZE           EQU     4                       ;address size [bytes]
                                      ;#Firmware size
003926 003926 -> $3B000               NVM_FIRMWARE_SIZE       EQU     NVM_FIRMWARE_END_LIN-NVM_FIRMWARE_START_LIN
                                      ;#NVM commands
003926 003926 -> $0006                NVM_CMD_PROG            EQU     $06                     ;program P-flash command
003926 003926 -> $000A                NVM_CMD_ERASE           EQU     $0A                     ;erase P-flash sector command
003926 003926 -> $0003                NVM_CMD_VERIFY          EQU     $03                     ;erase verify P-flash section command
                                      ;#NVM fill pattern
003926 003926 -> $00FF                NVM_FILL_PATTERN        EQU     $FF                     ;fill gaps with $FF
                                      ;#Error codes
003926 003926 -> $0008                NVM_ERR_ADDR            EQU     $08                     ;address error
003926 003926 -> $0004                NVM_ERR_HW              EQU     $04                     ;HW error
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
0019ED 0019ED                                                 ORG     NVM_VARS_START, NVM_VARS_START_LIN
0019ED 0019ED                                                 ALIGN   1
0019EE 0019EE                         NVM_DATA_BUF            DS      NVM_BUF_DEPTH*NVM_PHRASE_SIZE
001A6E 001A6E -> $1A6E                NVM_DATA_BUF_END        EQU     *
001A6E 001A6E                         NVM_ADDR_BUF            DS      NVM_BUF_DEPTH*NVM_ADDR_SIZE
001AAE 001AAE -> $1AAE                NVM_ADDR_BUF_END        EQU     *
001AAE 001AAE                         NVM_BUF_IN              DS      1                       ;points to the next free space
001AAF 001AAF                         NVM_BUF_OUT             DS      1                       ;points to the oldest entry
001AB0 001AB0                         NVM_TAGS                DS      NVM_FIRMWARE_SIZE/(8*NVM_SECTOR_SIZE)
001AEB 001AEB -> $1AEB                NVM_TAGS_END            EQU     *
001AEB 001AEB -> $1AEB                NVM_VARS_END            EQU     *
001AEB 001AEB -> $1AEB                NVM_VARS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
0015FD 0031FD                                                 ORG     NVM_CODE_START, NVM_CODE_START_LIN
                                      ;#Set the start address of the following input stream (non-blocking)
                                      ; args:   Y:X: address
                                      ; result: none
                                      ; SSTACK: 21 bytes
                                      ;         All registers are preserved
0015FD 0031FD -> $15FD                NVM_SET_ADDR_NB         EQU     *
                                                              ;Save registers (address in Y:X)
0015FD 0031FD 35                                              PSHY                                            ;save Y (SP+5)
0015FE 0031FE 34                                              PSHX                                            ;save X (SP+3)
0015FF 0031FF B7 81                                           EXG     A, B                                    ;adjust D for RTI unstacking
001601 003201 3B                                              PSHD                                            ;save B:A (SP+1)
001602 003202 10 FE                                           CLC                                             ;signal fail by default
001604 003204 39                                              PSHC                                            ;save C (SP+0)
                                                              ;Check if phrase address matches (upper address word in Y)
001605 003205 CE 1A 6E                                        LDX     #NVM_ADDR_BUF                           ;address buffer -> X
001608 003208 B6 1A AE                                        LDAA    NVM_BUF_IN                              ;IN -> A
00160B 00320B 84 F8                                           ANDA    #~(NVM_PHRASE_SIZE-1)                   ;phrase offset -> A
00160D 00320D 44                                              LSRA                                            ;address buffer offset -> X
00160E 00320E 1A E4                                           LEAX    A,X                                     ;address pointer -> X
001610 003210 AD 00                                           CPY     0,X                                     ;compare upper address word
001612 003212 26 24                                           BNE     NVM_SET_ADDR_NB_5                       ;mismatch
001614 003214 EC 83                                           LDD     3,SP                                    ;lower address word -> D
001616 003216 C4 F8                                           ANDB    #~(NVM_PHRASE_SIZE-1)                   ;align address
001618 003218 AC 02                                           CPD     2,X                                     ;compare lower address word
00161A 00321A 26 1C                                           BNE     NVM_SET_ADDR_NB_5                       ;mismatch
                                                              ;Check for gap to fill (upper address word in Y, address pointer in X)
00161C 00321C A6 84                   NVM_SET_ADDR_NB_1       LDAA    4,SP                                    ;lowest address byte -> A
00161E 00321E 84 07                                           ANDA    #(NVM_PHRASE_SIZE-1)                    ;byte offset -> A
001620 003220 F6 1A AE                                        LDAB    NVM_BUF_IN                              ;IN -> B
001623 003223 C4 07                                           ANDB    #(NVM_PHRASE_SIZE-1)                    ;byte offset -> B
001625 003225 18 16                                           SBA                                             ;A - B -> A
001627 003227 2B 0F                                           BMI     NVM_SET_ADDR_NB_5                       ;mismatch
001629 003229 27 09                                           BEQ     NVM_SET_ADDR_NB_3                       ;done
00162B 00322B C6 FF                                           LDAB    #NVM_FILL_PATTERN                       ;fill pattern -> B
00162D 00322D MACRO                   NVM_SET_ADDR_NB_2       NVM_PGM_BYTE_NB                                 ;program one byte (SSTACK: 9  bytes)
                                      ;#Program one byte (non-blocking)                                                (NVM_PGM_BYTE_NB)
                                      ; args:   B: data                                                                (NVM_PGM_BYTE_NB)
                                      ; result: C-flag: set if successful                                              (NVM_PGM_BYTE_NB)
                                      ; SSTACK: 9  bytes                                                               (NVM_PGM_BYTE_NB)
                                      ;         All registers are preserved                                            (NVM_PGM_BYTE_NB)
00162D 00322D MACRO                                           SSTACK_JOBSR    NVM_PGM_BYTE_NB, 9                       (NVM_PGM_BYTE_NB)
                                      ;#Check stack and call subroutine                                                (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
00162D 00322D 07 51                                           JOBSR   NVM_PGM_BYTE_NB                                  (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
00162F 00322F 24 06                                           BCC     NVM_SET_ADDR_NB_4                       ;signal failure
001631 003231 04 30 F9                                        DBNE    A, NVM_SET_ADDR_NB_2
                                                              ;Signal success
001634 003234 0C 80 01                NVM_SET_ADDR_NB_3       BSET    0,SP, #$01                              ;set C-flag
                                                              ;Done
001637 003237 MACRO                   NVM_SET_ADDR_NB_4       SSTACK_PREPULL  9                               ;check SSTACK
001637 003237 0B                                              RTI                                             ;done
                                                              ;Flush on address mismatch (upper address word in Y)
001638 003238 MACRO                   NVM_SET_ADDR_NB_5       NVM_FLUSH_NB                                    ;flush phrase (SSTACK: 12 bytes)
                                      ;#Submit current phrase for programming (non-blocking)                           (NVM_FLUSH_NB)
                                      ; args:   none                                                                   (NVM_FLUSH_NB)
                                      ; result: C-flag: set if successful                                              (NVM_FLUSH_NB)
                                      ; SSTACK: 19 bytes                                                               (NVM_FLUSH_NB)
                                      ;         All registers are preserved                                            (NVM_FLUSH_NB)
001638 003238 MACRO                                           SSTACK_JOBSR    NVM_FLUSH_NB, 12                         (NVM_FLUSH_NB)
                                      ;#Check stack and call subroutine                                                (NVM_FLUSH_NB/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (NVM_FLUSH_NB/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (NVM_FLUSH_NB/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (NVM_FLUSH_NB/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (NVM_FLUSH_NB/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (NVM_FLUSH_NB/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (NVM_FLUSH_NB/SSTACK_JOBSR)
001638 003238 07 24                                           JOBSR   NVM_FLUSH_NB                                     (NVM_FLUSH_NB/SSTACK_JOBSR)
00163A 00323A 24 FB                                           BCC     NVM_SET_ADDR_NB_4                       ;signal failure
                                                              ;Update address pointer (upper address word in Y
00163C 00323C CE 1A 6E                                        LDX     #NVM_ADDR_BUF                           ;address buffer -> X
00163F 00323F B6 1A AE                                        LDAA    NVM_BUF_IN                              ;IN -> A
001642 003242 84 F8                                           ANDA    #~(NVM_PHRASE_SIZE-1)                   ;phrase offset -> A
001644 003244 44                                              LSRA                                            ;address buffer offset -> X
001645 003245 1A E4                                           LEAX    A,X                                     ;address pointer -> X
                                                              ;Set phrase address (upper address word in Y, address pointer in X)
001647 003247 6D 00                                           STY     0,X                                     ;set upper address word
001649 003249 EC 83                                           LDD     3,SP                                    ;lower address word -> D
00164B 00324B C4 F8                                           ANDB    #~(NVM_PHRASE_SIZE-1)                   ;align address
00164D 00324D 6C 02                                           STD     2,X                                     ;set lower address word
00164F 00324F 20 CB                                           JOB     NVM_SET_ADDR_NB_1                       ;fill gap
                                      ;#Set the start address of the following input stream (blocking)
                                      ; args:   Y:X: address
                                      ; result: none
                                      ; SSTACK: 23 bytes
                                      ;         All registers are preserved
001651 003251 -> $1651                NVM_SET_ADDR_BL         EQU     *
                                                              ;NVM_SHOW_ADDR                                  ;debug output
001651 003251 MACRO                                           NVM_MAKE_BL     NVM_SET_ADDR_NB, 21
                                      ;#Helper functions                                                               (NVM_MAKE_BL)
                                      ;#----------------                                                               (NVM_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (NVM_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (NVM_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (NVM_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (NVM_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (NVM_MAKE_BL)
001651 003251 MACRO                                           SCI_MAKE_BL NVM_SET_ADDR_NB 21                           (NVM_MAKE_BL)
                                      ;#Helper functions                                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#----------------                                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (NVM_MAKE_BL/SCI_MAKE_BL)
001651 003251 14 10                   LOOP                    SEI                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (NVM_MAKE_BL/SCI_MAKE_BL)
001653 003253 07 A8                                           JOBSR   NVM_SET_ADDR_NB                                  (NVM_MAKE_BL/SCI_MAKE_BL)
001655 003255 24 03                                           BCC     WAIT            ;function unsuccessful           (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (NVM_MAKE_BL/SCI_MAKE_BL)
001657 003257 10 EF                                           CLI                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Done                                                    (NVM_MAKE_BL/SCI_MAKE_BL)
001659 003259 MACRO                                           SSTACK_PREPULL  2                                        (NVM_MAKE_BL/SCI_MAKE_BL)
001659 003259 3D                                              RTS                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (NVM_MAKE_BL/SCI_MAKE_BL)
00165A 00325A MACRO                   WAIT                    ISTACK_WAIT                                              (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
00165A 00325A 10 EF                                           CLI                                                      (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (NVM_MAKE_BL/SCI_MAKE_BL)
00165C 00325C MACRO                                           SSTACK_PREPUSH  21                                       (NVM_MAKE_BL/SCI_MAKE_BL)
00165C 00325C 20 F3                                           JOB     LOOP                                             (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Submit current phrase for programming (non-blocking)
                                      ; args:   none
                                      ; result: C-flag: set if successful
                                      ; SSTACK: 12 bytes
                                      ;         All registers are preserved
00165E 00325E -> $165E                NVM_FLUSH_NB            EQU     *
                                                              ;Save registers
00165E 00325E 36                                              PSHA                                            ;save A
00165F 00325F 14 01                                           SEC                                             ;signal success by default
001661 003261 39                                              PSHC                                            ;save CCR
                                                              ;Complete phrase
001662 003262 C6 FF                                           LDAB    #NVM_FILL_PATTERN                       ;fill pattern -> B
001664 003264 1F 1A AE 07 07          NVM_FLUSH_NB_1          BRCLR   NVM_BUF_IN,#(NVM_PHRASE_SIZE-1),NVM_FLUSH_NB_2;phrase is complete
001669 003269 MACRO                                           NVM_PGM_BYTE_NB                                 ;program one byte (SSTACK: 9  bytes)
                                      ;#Program one byte (non-blocking)                                                (NVM_PGM_BYTE_NB)
                                      ; args:   B: data                                                                (NVM_PGM_BYTE_NB)
                                      ; result: C-flag: set if successful                                              (NVM_PGM_BYTE_NB)
                                      ; SSTACK: 9  bytes                                                               (NVM_PGM_BYTE_NB)
                                      ;         All registers are preserved                                            (NVM_PGM_BYTE_NB)
001669 003269 MACRO                                           SSTACK_JOBSR    NVM_PGM_BYTE_NB, 9                       (NVM_PGM_BYTE_NB)
                                      ;#Check stack and call subroutine                                                (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
001669 003269 07 15                                           JOBSR   NVM_PGM_BYTE_NB                                  (NVM_PGM_BYTE_NB/SSTACK_JOBSR)
00166B 00326B 25 F7                                           BCS     NVM_FLUSH_NB_1                          ;success
                                                              ;Signal failure
00166D 00326D 0D 80 01                                        BCLR    0,SP, #$01                              ;clear C-flag
                                                              ;Restore registers
001670 003270 MACRO                   NVM_FLUSH_NB_2          SSTACK_PREPULL  4                               ;check SSTACK
001670 003270 38                                              PULC                                            ;restore CCR (incl. result)
001671 003271 33                                              PULB                                            ;restore B
                                                              ;Done
001672 003272 3D                                              RTS
                                      ;#Submit current phrase for programming (blocking)
                                      ; args:   none
                                      ; result: none
                                      ; SSTACK: 14 bytes
                                      ;         All registers are preserved
001673 003273 -> $1673                NVM_FLUSH_BL            EQU     *
001673 003273 MACRO                                           NVM_MAKE_BL     NVM_FLUSH_NB, 12
                                      ;#Helper functions                                                               (NVM_MAKE_BL)
                                      ;#----------------                                                               (NVM_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (NVM_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (NVM_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (NVM_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (NVM_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (NVM_MAKE_BL)
001673 003273 MACRO                                           SCI_MAKE_BL NVM_FLUSH_NB 12                              (NVM_MAKE_BL)
                                      ;#Helper functions                                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#----------------                                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (NVM_MAKE_BL/SCI_MAKE_BL)
001673 003273 14 10                   LOOP                    SEI                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (NVM_MAKE_BL/SCI_MAKE_BL)
001675 003275 07 E7                                           JOBSR   NVM_FLUSH_NB                                     (NVM_MAKE_BL/SCI_MAKE_BL)
001677 003277 24 03                                           BCC     WAIT            ;function unsuccessful           (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (NVM_MAKE_BL/SCI_MAKE_BL)
001679 003279 10 EF                                           CLI                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Done                                                    (NVM_MAKE_BL/SCI_MAKE_BL)
00167B 00327B MACRO                                           SSTACK_PREPULL  2                                        (NVM_MAKE_BL/SCI_MAKE_BL)
00167B 00327B 3D                                              RTS                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (NVM_MAKE_BL/SCI_MAKE_BL)
00167C 00327C MACRO                   WAIT                    ISTACK_WAIT                                              (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
00167C 00327C 10 EF                                           CLI                                                      (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (NVM_MAKE_BL/SCI_MAKE_BL)
00167E 00327E MACRO                                           SSTACK_PREPUSH  12                                       (NVM_MAKE_BL/SCI_MAKE_BL)
00167E 00327E 20 F3                                           JOB     LOOP                                             (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Program one byte (non-blocking)
                                      ; args:   B: data
                                      ; result: C-flag: set if successful
                                      ; SSTACK: 9  bytes
                                      ;         All registers are preserved
001680 003280 -> $1680                NVM_PGM_BYTE_NB         EQU     *
                                                              ;Save registers (data in B)
001680 003280 35                                              PSHY                                            ;save Y (SP+5)
001681 003281 34                                              PSHX                                            ;save X (SP+3)
001682 003282 36                                              PSHA                                            ;save A (SP+2)
001683 003283 37                                              PSHB                                            ;save B (SP+1)
001684 003284 10 FE                                           CLC                                             ;signal fail by default
001686 003286 39                                              PSHC                                            ;save C (SP+0)
                                                              ;Store data byte (data in B)
001687 003287 CD 19 EE                                        LDY     #NVM_DATA_BUF                           ;data buffer -> Y
00168A 00328A B6 1A AE                                        LDAA    NVM_BUF_IN                              ;IN -> A
00168D 00328D 6B EC                                           STAB    A,Y                                     ;store data
00168F 00328F 18 0E                                           TAB                                             ;IN -> B
001691 003291 42                                              INCA                                            ;advance IN
001692 003292 84 7F                                           ANDA    #((NVM_BUF_DEPTH*NVM_PHRASE_SIZE)-1)    ;wrap IN
001694 003294 B1 1A AF                                        CMPA    NVM_BUF_OUT                             ;check if buffer is full
001697 003297 27 29                                           BEQ     NVM_PGM_BYTE_NB_2                       ;signal failure (buffer is full)
001699 003299 7A 1A AE                                        STAA    NVM_BUF_IN                              ;update IN
                                                              ;Check if phrase is complete (new IN in A, old IN in B)
00169C 00329C 85 07                                           BITA    #(NVM_PHRASE_SIZE-1)                    ;check if phrase is complete
00169E 00329E 26 1F                                           BNE     NVM_PGM_BYTE_NB_1                       ;phrase is still incomplete
                                                              ;Set new phrase address (new IN in A, old IN in B)
0016A0 0032A0 84 F8                                           ANDA    #~(NVM_PHRASE_SIZE-1)                   ;new phrase offset -> A
0016A2 0032A2 C4 F8                                           ANDB    #~(NVM_PHRASE_SIZE-1)                   ;old phrase offset -> A
0016A4 0032A4 49                                              LSRD                                            ;new address offset -> A, old address offset -> B
0016A5 0032A5 CE 1A 6E                                        LDX     #NVM_ADDR_BUF                           ;address buffer -> X
0016A8 0032A8 19 E5                                           LEAY    B,X                                     ;old address pointer -> Y
0016AA 0032AA 1A E4                                           LEAX    A,X                                     ;new address pointer -> X
0016AC 0032AC EC 42                                           LDD     2,Y                                     ;old lower address word -> D
0016AE 0032AE C3 00 08                                        ADDD    #NVM_PHRASE_SIZE                        ;advance lower address word
0016B1 0032B1 6C 02                                           STD     2,X                                     ;update lower address word
0016B3 0032B3 EC 40                                           LDD     0,Y                                     ;upper address word -> D
0016B5 0032B5 C9 00                                           ADCB    #0                                      ;advance upper address word
0016B7 0032B7 89 00                                           ADCA    #0                                      ;
0016B9 0032B9 6C 00                                           STD     0,X                                     ;update upper address word
                                                              ;Submit complete phrase to NVM (new IN in A, old IN in B)
                                                              ;NVM_SHOW_BUF                                   ;debug output
0016BB 0032BB 1C 01 04 80                                     BSET    FCNFG, #CCIE                            ;enable interrupt
                                                              ;Signal success
0016BF 0032BF                         NVM_PGM_BYTE_NB_1       ;NVM_SHOW_BUF                                   ;debug output
0016BF 0032BF 0C 80 01                                        BSET    0,SP, #$01                              ;set C-flag
                                                              ;Done
0016C2 0032C2 MACRO                   NVM_PGM_BYTE_NB_2       SSTACK_PREPULL  9                               ;check SSTACK
0016C2 0032C2 0B                                              RTI
                                      ;#Program one byte (blocking)
                                      ; args:   B: data
                                      ; result: none
                                      ; SSTACK: 11 bytes
                                      ;         All registers are preserved
0016C3 0032C3 -> $16C3                NVM_PGM_BYTE_BL         EQU     *
                                                              ;NVM_SHOW_BYTE                                  ;debug output
0016C3 0032C3 MACRO                                           NVM_MAKE_BL     NVM_PGM_BYTE_NB, 9
                                      ;#Helper functions                                                               (NVM_MAKE_BL)
                                      ;#----------------                                                               (NVM_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (NVM_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (NVM_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (NVM_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (NVM_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (NVM_MAKE_BL)
0016C3 0032C3 MACRO                                           SCI_MAKE_BL NVM_PGM_BYTE_NB 9                            (NVM_MAKE_BL)
                                      ;#Helper functions                                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#----------------                                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Turn a non-blocking subroutine into a blocking subroutine                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ; args:   1: non-blocking function                                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;         2: subroutine stack usage of non-blocking function                     (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ; SSTACK: stack usage of non-blocking function + 2                               (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;         rgister output of the non-blocking function is preserved               (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Disable interrupts                                      (NVM_MAKE_BL/SCI_MAKE_BL)
0016C3 0032C3 14 10                   LOOP                    SEI                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Call non-blocking function                              (NVM_MAKE_BL/SCI_MAKE_BL)
0016C5 0032C5 07 B9                                           JOBSR   NVM_PGM_BYTE_NB                                  (NVM_MAKE_BL/SCI_MAKE_BL)
0016C7 0032C7 24 03                                           BCC     WAIT            ;function unsuccessful           (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Enable interrupts                                       (NVM_MAKE_BL/SCI_MAKE_BL)
0016C9 0032C9 10 EF                                           CLI                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Done                                                    (NVM_MAKE_BL/SCI_MAKE_BL)
0016CB 0032CB MACRO                                           SSTACK_PREPULL  2                                        (NVM_MAKE_BL/SCI_MAKE_BL)
0016CB 0032CB 3D                                              RTS                                                      (NVM_MAKE_BL/SCI_MAKE_BL)
                                                              ;Wait for next interrupt                                 (NVM_MAKE_BL/SCI_MAKE_BL)
0016CC 0032CC MACRO                   WAIT                    ISTACK_WAIT                                              (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Wait until any interrupt has been serviced                                     (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; args:   none                                                                   (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ; SSTACK: none                                                                   (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                      ;         X, Y, and D are preserved                                              (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Wait for the next interrupt                             (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
0016CC 0032CC 10 EF                                           CLI                                                      (NVM_MAKE_BL/SCI_MAKE_BL/ISTACK_WAIT)
                                                              ;Try again                                               (NVM_MAKE_BL/SCI_MAKE_BL)
0016CE 0032CE MACRO                                           SSTACK_PREPUSH  9                                        (NVM_MAKE_BL/SCI_MAKE_BL)
0016CE 0032CE 20 F3                                           JOB     LOOP                                             (NVM_MAKE_BL/SCI_MAKE_BL)
                                      ;#Command complete interrupt
                                      ;---------------------------
0016D0 0032D0 -> $16D0                NVM_ISR_CC              EQU     *
                                                              ;Clear busy signal
0016D0 0032D0 MACRO                                           LED_OFF A                                       ;not busy anymore
                                      ;#Turn off non-blinking LED                                                      (LED_OFF)
                                      ; args:   1: LED index (A..D)                                                    (LED_OFF)
                                      ; result: none                                                                   (LED_OFF)
                                      ; SSTACK: none                                                                   (LED_OFF)
                                      ;         X, Y and D are preserved                                               (LED_OFF)
0016D0 0032D0 4C 08 01                                        BSET    LED_A_PORT, #LED_A_PIN        ;set port pin      (LED_OFF)
                                                              ;Check for errors of previous operation
0016D3 0032D3 F6 01 06                                        LDAB    FSTAT                                   ;FSTAT -> B
0016D6 0032D6 C4 33                                           ANDB    #(ACCERR|FPVIOL|MGSTAT1|MGSTAT0)        ;mask error flags
0016D8 0032D8 18 26 00 8C                                     BNE     NVM_ISR_CC_7                            ;error detected
                                                              ;Check if data is available for programming
0016DC 0032DC FC 1A AE                                        LDD     NVM_BUF_IN                              ;IN:OUT -> A:B
0016DF 0032DF 84 F8                                           ANDA    #~(NVM_PHRASE_SIZE-1)                   ;align in to phrase boundary
0016E1 0032E1 18 17                                           CBA                                             ;compare pointers
0016E3 0032E3 18 27 00 90                                     BEQ     NVM_ISR_CC_10                           ;buffer is empty
                                                              ;Get phrase address (OUT in B)
0016E7 0032E7 CD 1A 6E                                        LDY     #NVM_ADDR_BUF                           ;address buffer -> Y
0016EA 0032EA 54                                              LSRB                                            ;buffer offset -> B
0016EB 0032EB 19 ED                                           LEAY    B,Y                                     ;address pointer -> Y
                                                              ;Check phrase address (address pointer in Y)
0016ED 0032ED EE 40                                           LDX     0,Y                                     ;upper address word -> X
0016EF 0032EF 27 05                                           BEQ     NVM_ISR_CC_1                            ;address < 64K
0016F1 0032F1 8E 00 00                                        CPX     #(NVM_FIRMWARE_START_LIN>>16)           ;check lower boundary
0016F4 0032F4 24 07                                           BHS     NVM_ISR_CC_2                            ;address is within range
0016F6 0032F6 EE 42                   NVM_ISR_CC_1            LDX     2,Y                                     ;lower address word -> X
0016F8 0032F8 8E F0 00                                        CPX     #NVM_FIRMWARE_END_LIN                   ;check upper boundary
0016FB 0032FB 24 71                                           BHS     NVM_ISR_CC_8                            ;address out of range
                                                              ;Set phrase address (address pointer in Y)
0016FD 0032FD 79 01 02                NVM_ISR_CC_2            CLR     FCCOBIX                                 ;reset CCOB index
001700 003300 18 0B 06 01 0A                                  MOVB    #NVM_CMD_PROG, FCCOBHI                  ;set command byte (program P-flash)
001705 003305 18 0D 41 01 0B                                  MOVB    1,Y, FCCOBLO                            ;set upper address byte
00170A 00330A 72 01 02                                        INC     FCCOBIX                                 ;advance CCOB index
00170D 00330D 18 05 42 01 0A                                  MOVW    2,Y, FCCOBHI                            ;set lower address word
                                                              ;Determine tag address (address pointer in Y)
001712 003312 EC 41                                           LDD     1,Y                                     ;address/256 -> D
001714 003314 49                                              LSRD                                            ;sector address -> D
001715 003315 B7 45                                           TFR     D, X                                    ;sector address -> X
001717 003317 49                                              LSRD                                            ;sector address/8 -> D
001718 003318 49                                              LSRD                                            ;
001719 003319 49                                              LSRD                                            ;
00171A 00331A B7 C5                                           EXG     D, X                                    ;sector address/8 -> X, sector address -> D
00171C 00331C 1A E2 1A AC                                     LEAX    (NVM_TAGS-(NVM_FIRMWARE_START_LIN>>12)),X;tag address -> X
                                                              ;Determine tag bit (tag address in X, sector address/8 in D)
001720 003320 86 01                                           LDAA    #1                                      ;bit 0 -> A
001722 003322 C4 07                                           ANDB    #(NVM_PHRASE_SIZE-1)                    ;bit offset -> B
001724 003324 27 04                                           BEQ     NVM_ISR_CC_4                            ;bit offset = 0
001726 003326 48                      NVM_ISR_CC_3            LSLA                                            ;shift bit index
001727 003327 04 31 FC                                        DBNE    B, NVM_ISR_CC_3                         ;tag bit -> A
                                                              ;Check tag (tag address in X, tag bit in A)
00172A 00332A 18 0E                   NVM_ISR_CC_4            TAB                                             ;tag bit -> B
00172C 00332C E4 00                                           ANDB    0,X                                     ;tag status -> B
00172E 00332E 27 4D                                           BEQ     NVM_ISR_CC_11                           ;erase sector
                                                              ;Set data field
001730 003330 CE 19 EE                                        LDX     #NVM_DATA_BUF                           ;data buffer -> X
001733 003333 B6 1A AF                                        LDAA    NVM_BUF_OUT                             ;OUT -> A
001736 003336 1A E4                                           LEAX    A,X                                     ;phrase address -> X
001738 003338 72 01 02                                        INC     FCCOBIX                                 ;advance CCOB index
00173B 00333B 18 05 00 01 0A                                  MOVW    0,X, FCCOBHI                            ;set first data word
001740 003340 72 01 02                                        INC     FCCOBIX                                 ;advance CCOB index
001743 003343 18 05 02 01 0A                                  MOVW    2,X, FCCOBHI                            ;set first data word
001748 003348 72 01 02                                        INC     FCCOBIX                                 ;advance CCOB index
00174B 00334B 18 05 04 01 0A                                  MOVW    4,X, FCCOBHI                            ;set first data word
001750 003350 72 01 02                                        INC     FCCOBIX                                 ;advance CCOB index
001753 003353 18 05 06 01 0A                                  MOVW    6,X, FCCOBHI                            ;set first data word
001758 003358 8B 08                                           ADDA    #NVM_PHRASE_SIZE                        ;advance OUT
00175A 00335A 84 7F                                           ANDA    #((NVM_BUF_DEPTH*NVM_PHRASE_SIZE)-1)    ;wrap OUT
00175C 00335C 7A 1A AF                                        STAA    NVM_BUF_OUT                             ;update out
                                                              ;Launch NVM command
00175F 00335F MACRO                   NVM_ISR_CC_5            LED_ON A                                        ;show activity
                                      ;#User functions                                                                 (LED_ON)
                                      ;#--------------                                                                 (LED_ON)
                                      ;#Turn on non-blinking LED                                                       (LED_ON)
                                      ; args:   1: LED index (A..D)                                                    (LED_ON)
                                      ; result: none                                                                   (LED_ON)
                                      ; SSTACK: none                                                                   (LED_ON)
                                      ;         X,Y and D are preserved                                                (LED_ON)
00175F 00335F 4D 08 01                                        BCLR    LED_A_PORT, #LED_A_PIN        ;clear port pin    (LED_ON)
001762 003362 18 0B 80 01 06                                  MOVB    #CCIF, FSTAT                            ;launch command
                                                              ;BCLR   FCNFG, #CCIE                            ;debug output
                                                              ;CLI                                            ;debug output
                                                              ;NVM_SHOW_CCOB                                  ;debug output
                                                              ;SEI                                            ;debug output
                                                              ;BSET   FCNFG, #CCIE                            ;debug output
                                                              ;Done
001767 003367 MACRO                   NVM_ISR_CC_6            ISTACK_RTI                                      ;done
                                      ;#Return from interrupt                                                          (ISTACK_RTI)
                                      ; args:   none                                                                   (ISTACK_RTI)
                                      ; ISTACK: -9 (S12)/-10 (S12X)                                                    (ISTACK_RTI)
                                      ;         X, Y, and D are pulled from the interrupt stack                        (ISTACK_RTI)
                                                              ;End ISR                                                 (ISTACK_RTI)
001767 003367 0B                                              RTI                                                      (ISTACK_RTI)
                                                              ;Error found
001768 003368 86 04                   NVM_ISR_CC_7            LDAA    #NVM_ERR_HW                             ;HW error -> A
00176A 00336A C5 03                                           BITB    #(MGSTAT1|MGSTAT0)                      ;check for HW error
00176C 00336C 26 02                                           BNE     NVM_ISR_CC_9                            ;HW error
00176E 00336E 86 08                   NVM_ISR_CC_8            LDAA    #NVM_ERR_ADDR                           ;address error -> A
001770 003370 1B 89                   NVM_ISR_CC_9            LEAS    9,SP                                    ;free stack space
001772 003372 10 EF                                           CLI                                             ;enable interrupts
001774 003374 MACRO                                           NVM_ERROR_HANDLER                               ;handle errors
                                      ;Error handler                                                                   (NVM_ERROR_HANDLER)
                                      ;-------------                                                                   (NVM_ERROR_HANDLER)
                                                              ;Signal error (error code in A)                          (NVM_ERROR_HANDLER)
001774 003374 06 37 36                                        JOB     BOOTLOADER_DONE         ;end bootloader          (NVM_ERROR_HANDLER)
                                                              ;Buffer is empty
001777 003377 1D 01 04 80             NVM_ISR_CC_10           BCLR    FCNFG, #CCIE                            ;disable interrupt
00177B 00337B 20 EA                                           JOB     NVM_ISR_CC_6                            ;done
                                                              ;Erase sector (tag address in X, tag bit in A)
00177D 00337D AA 00                   NVM_ISR_CC_11           ORAA    0,X                                     ;set tag
00177F 00337F 6A 00                                           STAA    0,X                                     ;
001781 003381 79 01 02                                        CLR     FCCOBIX                                 ;reset CCOB index
001784 003384 18 0B 0A 01 0A                                  MOVB    #NVM_CMD_ERASE, FCCOBHI                 ;set command byte (program P-flash)
001789 003389 72 01 02                                        INC     FCCOBIX                                 ;advance CCOB index
00178C 00338C 20 D1                                           JOB     NVM_ISR_CC_5                            ;launch command
00178E 00338E -> $178E                NVM_CODE_END            EQU     *
00178E 00338E -> $338E                NVM_CODE_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
001402 003002                                                 ORG     NVM_TABS_START, NVM_TABS_START_LIN
001402 003002 -> $1402                NVM_TABS_END            EQU     *
001402 003002 -> $3002                NVM_TABS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Configuration                                                               #
                                      ;###############################################################################
                                      ;#NVM phrase size
001402 003002 -> $0008                SREC_PHRASE_SIZE        EQU     8               ;default is 8 bytes
                                      ;#Address width
001402 003002 -> $0012                SREC_ADDR_WIDTH         EQU     18              ;default is 10 bit
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;#Error codes
001402 003002 -> $0080                SREC_ERR_RX             EQU     $80             ;communication error
001402 003002 -> $0040                SREC_ERR_FORMAT         EQU     $40             ;format error
001402 003002 -> $0020                SREC_ERR_CHECKSUM       EQU     $20             ;CRC error
001402 003002 -> $0010                SREC_ERR_COUNT          EQU     $10             ;count error
                                      ;#C0 characters
001402 003002 -> $000A                SREC_C0_LF              EQU     $0A             ;line feed
                                      ;#Upper address limit
001402 003002 -> $400000              SREC_MAX_ADDR           EQU     $40_0000        ;highest address
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
001AEB 001AEB                                                 ORG     SREC_VARS_START, SREC_VARS_START_LIN
001AEB 001AEB                                                 ALIGN   1
001AEC 001AEC                         SREC_COUNT              DS      4               ;S-record count (S0=0, S1/S2/S3=+1)
001AF0 001AF0                         SREC_ADDR               DS      4               ;address field
001AF4 001AF4                         SREC_TYPE               DS      1               ;current type
001AF5 001AF5                         SREC_BYTECOUNT          DS      1               ;byte count
001AF6 001AF6                         SREC_CHECKSUM           DS      1               ;checksum
001AF7 001AF7 -> $1AF7                SREC_VARS_END           EQU     *
001AF7 001AF7 -> $1AF7                SREC_VARS_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
00178E 00338E                                                 ORG     SREC_CODE_START, SREC_CODE_START_LIN
                                      ;#Parse S-Records - blocking
                                      ; args:   none
                                      ; result: A:      error code
                                      ; SSTACK: 21 bytes
                                      ;         B, X and Y are preserved
00178E 00338E -> $178E                SREC_PARSE_SREC         EQU     *
                                                              ;Save registers
00178E 00338E 34                                              PSHX                                            ;save X
00178F 00338F 37                                              PSHB                                            ;save B
                                                              ;Parse header
001790 003390 MACRO                   SREC_PARSE_SREC_1       SREC_PARSE_HEADER                               ;(SSTACK: 16 bytes)
                                      ;#Parse header - blocking                                                        (SREC_PARSE_HEADER)
                                      ; args:   none                                                                   (SREC_PARSE_HEADER)
                                      ; result: A: error code                                                          (SREC_PARSE_HEADER)
                                      ;         B: type                                                                (SREC_PARSE_HEADER)
                                      ; SSTACK: 16 bytes                                                               (SREC_PARSE_HEADER)
                                      ;         X and Y are preserved                                                  (SREC_PARSE_HEADER)
001790 003390 MACRO                                           SSTACK_JOBSR    SREC_PARSE_HEADER, 16                    (SREC_PARSE_HEADER)
                                      ;#Check stack and call subroutine                                                (SREC_PARSE_HEADER/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_PARSE_HEADER/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_PARSE_HEADER/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_PARSE_HEADER/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_PARSE_HEADER/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_PARSE_HEADER/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_PARSE_HEADER/SSTACK_JOBSR)
001790 003390 16 18 6D                                        JOBSR   SREC_PARSE_HEADER                                (SREC_PARSE_HEADER/SSTACK_JOBSR)
001793 003393 04 60 1D                                        TBNE    A, SREC_PARSE_SREC_4                    ;error (fail)
                                                              ;Determine srecord handler (type in D)
001796 003396 58                                              LSLB                                            ;jump table offset -> D
001797 003397 05 FF                                           JMP [D,PC]                                      ;table lookup
001799 003399 17 B6                                           DW      SREC_PARSE_SREC_5                       ;S0 - print header
00179B 00339B 17 E0                                           DW      SREC_PARSE_SREC_8                       ;S1 - flash data
00179D 00339D 17 E0                                           DW      SREC_PARSE_SREC_8                       ;S2 - flash data
00179F 00339F 17 E0                                           DW      SREC_PARSE_SREC_8                       ;S3 - flash data
0017A1 0033A1 17 AD                                           DW      SREC_PARSE_SREC_2                       ;format error
0017A3 0033A3 18 1D                                           DW      SREC_PARSE_SREC_12                      ;S5 - check count
0017A5 0033A5 18 1D                                           DW      SREC_PARSE_SREC_12                      ;S6 - check count
0017A7 0033A7 18 3B                                           DW      SREC_PARSE_SREC_14                      ;S7 - last S-record
0017A9 0033A9 18 3B                                           DW      SREC_PARSE_SREC_14                      ;S8 - last S-record
0017AB 0033AB 18 3B                                           DW      SREC_PARSE_SREC_14                      ;S9 - last S-record
                                                              ;Format error
0017AD 0033AD 86 40                   SREC_PARSE_SREC_2       LDAA    #SREC_ERR_FORMAT                        ;return format error
0017AF 0033AF 20 02                                           JOB     SREC_PARSE_SREC_4                       ;done
                                                              ;Checksum error
0017B1 0033B1 86 20                   SREC_PARSE_SREC_3       LDAA    #SREC_ERR_CHECKSUM                      ;return checksum error
0017B3 0033B3 MACRO                   SREC_PARSE_SREC_4       SSTACK_PREPULL  5                               ;check SSTACK
0017B3 0033B3 33                                              PULB                                            ;restore B
0017B4 0033B4 30                                              PULX                                            ;restore X
0017B5 0033B5 3D                                              RTS                                             ;done
                                                              ;S0 Record
                                                              ;---------
0017B6 0033B6 18 03 00 00 1A EC       SREC_PARSE_SREC_5       MOVW    #0000, SREC_COUNT                       ;reset srecord count
0017BC 0033BC 18 03 00 00 1A EE                               MOVW    #0000, SREC_COUNT+2                     ;
0017C2 0033C2 CE 14 02                                        LDX     #SREC_MSG_S0_HEADER                     ;message header -> X
0017C5 0033C5 MACRO                                           STRING_PRINT_BL                                 ;print message header
                                      ;#Basic print function - blocking                                                (STRING_PRINT_BL)
                                      ; args:   X:      start of the string                                            (STRING_PRINT_BL)
                                      ; result: X;      points to the byte after the string                            (STRING_PRINT_BL)
                                      ; SSTACK: 10 bytes                                                               (STRING_PRINT_BL)
                                      ;         Y and D are preserved                                                  (STRING_PRINT_BL)
0017C5 0033C5 MACRO                                           SSTACK_JOBSR    STRING_PRINT_BL, 10                      (STRING_PRINT_BL)
                                      ;#Check stack and call subroutine                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (STRING_PRINT_BL/SSTACK_JOBSR)
0017C5 0033C5 16 15 E5                                        JOBSR   STRING_PRINT_BL                                  (STRING_PRINT_BL/SSTACK_JOBSR)
0017C8 0033C8 MACRO                   SREC_PARSE_SREC_6       SREC_PARSE_DATA                                 ;data byte -> B (SSTACK: 14 bytes)
                                      ;#Parse data field - blocking                                                    (SREC_PARSE_DATA)
                                      ; args:   none                                                                   (SREC_PARSE_DATA)
                                      ; result: A:      error code                                                     (SREC_PARSE_DATA)
                                      ;         B:      data                                                           (SREC_PARSE_DATA)
                                      ;         C-flag: set if data is valid                                           (SREC_PARSE_DATA)
                                      ; SSTACK: 14 bytes                                                               (SREC_PARSE_DATA)
                                      ;         X and Y are preserved                                                  (SREC_PARSE_DATA)
0017C8 0033C8 MACRO                                           SSTACK_JOBSR    SREC_PARSE_DATA, 14                      (SREC_PARSE_DATA)
                                      ;#Check stack and call subroutine                                                (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_PARSE_DATA/SSTACK_JOBSR)
0017C8 0033C8 16 18 4B                                        JOBSR   SREC_PARSE_DATA                                  (SREC_PARSE_DATA/SSTACK_JOBSR)
0017CB 0033CB 04 70 E5                                        TBNE    A, SREC_PARSE_SREC_4                    ;error (fail)
0017CE 0033CE 24 08                                           BCC     SREC_PARSE_SREC_7                       ;end of S-record reached
0017D0 0033D0 MACRO                                           STRING_PRINTABLE                                ;make sure character is printable
                                      ;#Make ASCII character printable                                                 (STRING_PRINTABLE)
                                      ; args:   B: ASCII character (w/out termination)                                 (STRING_PRINTABLE)
                                      ; result: B: printable ASCII character or "."                                    (STRING_PRINTABLE)
                                      ; SSTACK: 2 bytes                                                                (STRING_PRINTABLE)
                                      ;         X, Y, and A are preserved                                              (STRING_PRINTABLE)
0017D0 0033D0 MACRO                                           SSTACK_JOBSR    STRING_PRINTABLE, 2                      (STRING_PRINTABLE)
                                      ;#Check stack and call subroutine                                                (STRING_PRINTABLE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (STRING_PRINTABLE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (STRING_PRINTABLE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (STRING_PRINTABLE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (STRING_PRINTABLE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (STRING_PRINTABLE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (STRING_PRINTABLE/SSTACK_JOBSR)
0017D0 0033D0 16 15 F2                                        JOBSR   STRING_PRINTABLE                                 (STRING_PRINTABLE/SSTACK_JOBSR)
0017D3 0033D3 MACRO                                           SCI_TX_BL                                       ;print character
                                      ;#Transmit one byte - blocking                                                   (SCI_TX_BL)
                                      ; args:   B: data to be send                                                     (SCI_TX_BL)
                                      ; SSTACK: 8 bytes                                                                (SCI_TX_BL)
                                      ;         X, Y, and D are preserved                                              (SCI_TX_BL)
0017D3 0033D3 MACRO                                           SSTACK_JOBSR    SCI_TX_BL, 8                             (SCI_TX_BL)
                                      ;#Check stack and call subroutine                                                (SCI_TX_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SCI_TX_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SCI_TX_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SCI_TX_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SCI_TX_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SCI_TX_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SCI_TX_BL/SSTACK_JOBSR)
0017D3 0033D3 16 14 3C                                        JOBSR   SCI_TX_BL                                        (SCI_TX_BL/SSTACK_JOBSR)
0017D6 0033D6 20 F0                                           JOB     SREC_PARSE_SREC_6                       ;get next byte
0017D8 0033D8 CE 14 00                SREC_PARSE_SREC_7       LDX     #STRING_STR_NL                          ;line break -> X
0017DB 0033DB MACRO                                           STRING_PRINT_BL                                 ;print line break
                                      ;#Basic print function - blocking                                                (STRING_PRINT_BL)
                                      ; args:   X:      start of the string                                            (STRING_PRINT_BL)
                                      ; result: X;      points to the byte after the string                            (STRING_PRINT_BL)
                                      ; SSTACK: 10 bytes                                                               (STRING_PRINT_BL)
                                      ;         Y and D are preserved                                                  (STRING_PRINT_BL)
0017DB 0033DB MACRO                                           SSTACK_JOBSR    STRING_PRINT_BL, 10                      (STRING_PRINT_BL)
                                      ;#Check stack and call subroutine                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (STRING_PRINT_BL/SSTACK_JOBSR)
0017DB 0033DB 16 15 E5                                        JOBSR   STRING_PRINT_BL                                  (STRING_PRINT_BL/SSTACK_JOBSR)
0017DE 0033DE 20 B0                                           JOB     SREC_PARSE_SREC_1                       ;parse next header
                                                              ;S1/S2/S3 Record
                                                              ;---------------
0017E0 0033E0 FD 1A F0                SREC_PARSE_SREC_8       LDY     SREC_ADDR                               ;upper address word -> Y
                                                              ;CPY    #(SREC_MAX_ADDR>>16)                    ;check address range
                                                              ;BHS    SREC_PARSE_SREC_2                       ;address range exeeded
0017E3 0033E3 FE 1A F2                                        LDX     SREC_ADDR+2                             ;lower address word -> X
0017E6 0033E6 MACRO                                           NVM_SET_ADDR_BL                                         ;set new NVM address
                                      ;#Set the start address of the following input stream (blocking)                 (NVM_SET_ADDR_BL)
                                      ; args:   Y:X: address                                                           (NVM_SET_ADDR_BL)
                                      ; result: none                                                                   (NVM_SET_ADDR_BL)
                                      ; SSTACK: 323bytes                                                               (NVM_SET_ADDR_BL)
                                      ;         All registers are preserved                                            (NVM_SET_ADDR_BL)
0017E6 0033E6 MACRO                                           SSTACK_JOBSR    NVM_SET_ADDR_BL, 23                      (NVM_SET_ADDR_BL)
                                      ;#Check stack and call subroutine                                                (NVM_SET_ADDR_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (NVM_SET_ADDR_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (NVM_SET_ADDR_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (NVM_SET_ADDR_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (NVM_SET_ADDR_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (NVM_SET_ADDR_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (NVM_SET_ADDR_BL/SSTACK_JOBSR)
0017E6 0033E6 16 16 51                                        JOBSR   NVM_SET_ADDR_BL                                  (NVM_SET_ADDR_BL/SSTACK_JOBSR)
0017E9 0033E9 MACRO                   SREC_PARSE_SREC_9       SREC_PARSE_DATA                                 ;data byte -> B (SSTACK: 14 bytes)
                                      ;#Parse data field - blocking                                                    (SREC_PARSE_DATA)
                                      ; args:   none                                                                   (SREC_PARSE_DATA)
                                      ; result: A:      error code                                                     (SREC_PARSE_DATA)
                                      ;         B:      data                                                           (SREC_PARSE_DATA)
                                      ;         C-flag: set if data is valid                                           (SREC_PARSE_DATA)
                                      ; SSTACK: 14 bytes                                                               (SREC_PARSE_DATA)
                                      ;         X and Y are preserved                                                  (SREC_PARSE_DATA)
0017E9 0033E9 MACRO                                           SSTACK_JOBSR    SREC_PARSE_DATA, 14                      (SREC_PARSE_DATA)
                                      ;#Check stack and call subroutine                                                (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_PARSE_DATA/SSTACK_JOBSR)
0017E9 0033E9 07 60                                           JOBSR   SREC_PARSE_DATA                                  (SREC_PARSE_DATA/SSTACK_JOBSR)
0017EB 0033EB 04 70 C5                                        TBNE    A, SREC_PARSE_SREC_4                    ;error (fail)
0017EE 0033EE 24 05                                           BCC     SREC_PARSE_SREC_10                      ;end of S-record reached
0017F0 0033F0 MACRO                                           NVM_PGM_BYTE_BL                                 ;queue data byte for programming
                                      ;#Program one byte (blocking)                                                    (NVM_PGM_BYTE_BL)
                                      ; args:   B: data                                                                (NVM_PGM_BYTE_BL)
                                      ; result: none                                                                   (NVM_PGM_BYTE_BL)
                                      ; SSTACK: 11 bytes                                                               (NVM_PGM_BYTE_BL)
                                      ;         All registers are preserved                                            (NVM_PGM_BYTE_BL)
0017F0 0033F0 MACRO                                           SSTACK_JOBSR    NVM_PGM_BYTE_BL, 11                      (NVM_PGM_BYTE_BL)
                                      ;#Check stack and call subroutine                                                (NVM_PGM_BYTE_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (NVM_PGM_BYTE_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (NVM_PGM_BYTE_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (NVM_PGM_BYTE_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (NVM_PGM_BYTE_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (NVM_PGM_BYTE_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (NVM_PGM_BYTE_BL/SSTACK_JOBSR)
0017F0 0033F0 16 16 C3                                        JOBSR   NVM_PGM_BYTE_BL                                  (NVM_PGM_BYTE_BL/SSTACK_JOBSR)
0017F3 0033F3 20 F4                                           JOB     SREC_PARSE_SREC_9                       ;get next byte
0017F5 0033F5 C6 2A                   SREC_PARSE_SREC_10      LDAB    #"*"                                    ;progress char -> B
0017F7 0033F7 MACRO                                           SCI_TX_BL                                       ;print progress char
                                      ;#Transmit one byte - blocking                                                   (SCI_TX_BL)
                                      ; args:   B: data to be send                                                     (SCI_TX_BL)
                                      ; SSTACK: 8 bytes                                                                (SCI_TX_BL)
                                      ;         X, Y, and D are preserved                                              (SCI_TX_BL)
0017F7 0033F7 MACRO                                           SSTACK_JOBSR    SCI_TX_BL, 8                             (SCI_TX_BL)
                                      ;#Check stack and call subroutine                                                (SCI_TX_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SCI_TX_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SCI_TX_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SCI_TX_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SCI_TX_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SCI_TX_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SCI_TX_BL/SSTACK_JOBSR)
0017F7 0033F7 16 14 3C                                        JOBSR   SCI_TX_BL                                        (SCI_TX_BL/SSTACK_JOBSR)
0017FA 0033FA FC 1A EE                                        LDD     SREC_COUNT+2                            ;S-Record count (lower word) -> D
0017FD 0033FD C3 00 01                                        ADDD    #1                                      ;increment S-Record count (lower word)
001800 003400 7C 1A EE                                        STD     SREC_COUNT+2                            ;update S-Record count (lower word)
001803 003403 FC 1A EC                                        LDD     SREC_COUNT                              ;S-Record count (upper word) -> D
001806 003406 89 00                                           ADCA    #$00                                    ;increment S-Record count (upper word)
001808 003408 C9 00                                           ADCB    #$00                                    ;
00180A 00340A 7C 1A EC                                        STD     SREC_COUNT                              ;S-Record count (upper word) -> D
00180D 00340D F6 1A EF                                        LDAB    SREC_COUNT+3                            ;S-Record count (lowest byte) -> B
001810 003410 C5 3F                                           BITB    #$3F                                    ;;check for multiples of 64
001812 003412 26 06                                           BNE     SREC_PARSE_SREC_11                      ;
001814 003414 CE 14 00                                        LDX     #STRING_STR_NL                          ;line break -> X
001817 003417 MACRO                                           STRING_PRINT_BL                                 ;print line break
                                      ;#Basic print function - blocking                                                (STRING_PRINT_BL)
                                      ; args:   X:      start of the string                                            (STRING_PRINT_BL)
                                      ; result: X;      points to the byte after the string                            (STRING_PRINT_BL)
                                      ; SSTACK: 10 bytes                                                               (STRING_PRINT_BL)
                                      ;         Y and D are preserved                                                  (STRING_PRINT_BL)
001817 003417 MACRO                                           SSTACK_JOBSR    STRING_PRINT_BL, 10                      (STRING_PRINT_BL)
                                      ;#Check stack and call subroutine                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (STRING_PRINT_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (STRING_PRINT_BL/SSTACK_JOBSR)
001817 003417 16 15 E5                                        JOBSR   STRING_PRINT_BL                                  (STRING_PRINT_BL/SSTACK_JOBSR)
00181A 00341A                         SREC_PARSE_SREC_11      ;LDY    SREC_ADDR                               ;debug: address -> Y:X
                                                              ;LDX    SREC_ADDR+2                             ;debug:
                                                              ;LDD    #$0610                                  ;debug: alignment:base -> D
                                                              ;NUM_PRINT_ZUD_BL                               ;debug: print address
                                                              ;LDX    #STRING_STR_NL                          ;debug: line break -> X
                                                              ;STRING_PRINT_BL                                ;debug: print line break
00181A 00341A 06 17 90                                        JOB     SREC_PARSE_SREC_1                       ;parse next header
                                                              ;S5/S6 Record
                                                              ;------------
00181D 00341D MACRO                   SREC_PARSE_SREC_12      SREC_PARSE_DATA                                 ;data byte -> B (SSTACK: 14 bytes)
                                      ;#Parse data field - blocking                                                    (SREC_PARSE_DATA)
                                      ; args:   none                                                                   (SREC_PARSE_DATA)
                                      ; result: A:      error code                                                     (SREC_PARSE_DATA)
                                      ;         B:      data                                                           (SREC_PARSE_DATA)
                                      ;         C-flag: set if data is valid                                           (SREC_PARSE_DATA)
                                      ; SSTACK: 14 bytes                                                               (SREC_PARSE_DATA)
                                      ;         X and Y are preserved                                                  (SREC_PARSE_DATA)
00181D 00341D MACRO                                           SSTACK_JOBSR    SREC_PARSE_DATA, 14                      (SREC_PARSE_DATA)
                                      ;#Check stack and call subroutine                                                (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_PARSE_DATA/SSTACK_JOBSR)
00181D 00341D 07 2C                                           JOBSR   SREC_PARSE_DATA                                  (SREC_PARSE_DATA/SSTACK_JOBSR)
00181F 00341F 04 70 91                                        TBNE    A, SREC_PARSE_SREC_4                    ;error (fail)
001822 003422 25 89                                           BCS     SREC_PARSE_SREC_2                       ;error (fail)
001824 003424 FE 1A F2                                        LDX     SREC_ADDR+2                             ;S-Record count (lower word) -> X
001827 003427 BE 1A EE                                        CPX     SREC_COUNT+2                            ;check S-Record count (low word)
00182A 00342A 26 0A                                           BNE     SREC_PARSE_SREC_13                      ;mismatch
00182C 00342C FE 1A F0                                        LDX     SREC_ADDR                               ;S-Record count (upper word) -> X
00182F 00342F BE 1A EC                                        CPX     SREC_COUNT                              ;check S-Record count (low word)
001832 003432 18 27 FF 5A                                     BEQ     SREC_PARSE_SREC_1                       ;parse next header
001836 003436 86 10                   SREC_PARSE_SREC_13      LDAA    #SREC_ERR_COUNT                         ;return count error
001838 003438 06 17 B3                                        JOB     SREC_PARSE_SREC_4                       ;done
                                                              ;S7/S8/S9 Record
                                                              ;---------------
00183B 00343B MACRO                   SREC_PARSE_SREC_14      SREC_PARSE_DATA                                 ;data byte -> B (SSTACK: 14 bytes)
                                      ;#Parse data field - blocking                                                    (SREC_PARSE_DATA)
                                      ; args:   none                                                                   (SREC_PARSE_DATA)
                                      ; result: A:      error code                                                     (SREC_PARSE_DATA)
                                      ;         B:      data                                                           (SREC_PARSE_DATA)
                                      ;         C-flag: set if data is valid                                           (SREC_PARSE_DATA)
                                      ; SSTACK: 14 bytes                                                               (SREC_PARSE_DATA)
                                      ;         X and Y are preserved                                                  (SREC_PARSE_DATA)
00183B 00343B MACRO                                           SSTACK_JOBSR    SREC_PARSE_DATA, 14                      (SREC_PARSE_DATA)
                                      ;#Check stack and call subroutine                                                (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_PARSE_DATA/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_PARSE_DATA/SSTACK_JOBSR)
00183B 00343B 07 0E                                           JOBSR   SREC_PARSE_DATA                                  (SREC_PARSE_DATA/SSTACK_JOBSR)
00183D 00343D 04 70 73                                        TBNE    A, SREC_PARSE_srec_4                    ;error (fail)
001840 003440 18 25 FF 69                                     BCS     SREC_PARSE_SREC_2                       ;format error (fail)
001844 003444 MACRO                                           NVM_FLUSH_BL                                    ;program remaining data
                                      ;#Submit current phrase for programming (blocking)                               (NVM_FLUSH_BL)
                                      ; args:   none                                                                   (NVM_FLUSH_BL)
                                      ; result: none                                                                   (NVM_FLUSH_BL)
                                      ; SSTACK: 21 bytes                                                               (NVM_FLUSH_BL)
                                      ;         All registers are preserved                                            (NVM_FLUSH_BL)
001844 003444 MACRO                                           SSTACK_JOBSR    NVM_FLUSH_BL, 14                         (NVM_FLUSH_BL)
                                      ;#Check stack and call subroutine                                                (NVM_FLUSH_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (NVM_FLUSH_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (NVM_FLUSH_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (NVM_FLUSH_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (NVM_FLUSH_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (NVM_FLUSH_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (NVM_FLUSH_BL/SSTACK_JOBSR)
001844 003444 16 16 73                                        JOBSR   NVM_FLUSH_BL                                     (NVM_FLUSH_BL/SSTACK_JOBSR)
001847 003447 87                                              CLRA                                            ;signal no errors
001848 003448 06 17 B3                                        JOB     SREC_PARSE_SREC_4                       ;done
                                      ;#Parse data field - blocking
                                      ; args:   none
                                      ; result: A:      error code
                                      ;         B:      data
                                      ;         C-flag: set if data is valid
                                      ; SSTACK: 14 bytes
                                      ;         X and Y are preserved
00184B 00344B -> $184B                SREC_PARSE_DATA         EQU     *
                                                              ;Get data byte
00184B 00344B MACRO                                           SREC_RX_BYTE                                    ;count -> B, error code in A (SSTACK: 12 bytes)
                                      ;#Receive one data byte - blocking                                               (SREC_RX_BYTE)
                                      ; args:   none                                                                   (SREC_RX_BYTE)
                                      ; result: A: error code                                                          (SREC_RX_BYTE)
                                      ;         B: byte                                                                (SREC_RX_BYTE)
                                      ; SSTACK: 12 bytes                                                               (SREC_RX_BYTE)
                                      ;         X and Y are preserved                                                  (SREC_RX_BYTE)
00184B 00344B MACRO                                           SSTACK_JOBSR    SREC_RX_BYTE, 12                         (SREC_RX_BYTE)
                                      ;#Check stack and call subroutine                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_RX_BYTE/SSTACK_JOBSR)
00184B 00344B 16 19 46                                        JOBSR   SREC_RX_BYTE                                     (SREC_RX_BYTE/SSTACK_JOBSR)
00184E 00344E 04 60 15                                        TBNE    A, SREC_PARSE_DATA_2                    ;error (fail)
                                                              ;Update checksum (data in B)
001851 003451 B6 1A F6                                        LDAA    SREC_CHECKSUM                           ;old checksum -> A
001854 003454 18 06                                           ABA                                             ;new checksum -> A
                                                              ;Update count (data in B)
001856 003456 73 1A F5                                        DEC     SREC_BYTECOUNT                          ;decrement byte count
001859 003459 27 07                                           BEQ     SREC_PARSE_DATA_1                       ;checksum field reached
                                                              ;Return data (data in B, checksum in A)
00185B 00345B 7A 1A F6                                        STAA    SREC_CHECKSUM                           ;update checksum
00185E 00345E 87                                              CLRA                                            ;no errors
00185F 00345F MACRO                                           SSTACK_PREPULL  2                               ;check SSTACK
00185F 00345F 14 01                                           SEC                                             ;data is valid
001861 003461 3D                                              RTS                                             ;done
                                                              ;Verify checksum (data in B, checksum in A)
001862 003462 04 A0 04                SREC_PARSE_DATA_1       IBNE    A, SREC_PARSE_DATA_3                    ;checksum error
001865 003465 87                                              CLRA                                            ;no error
001866 003466 MACRO                   SREC_PARSE_DATA_2       SSTACK_PREPULL  2                               ;check SSTACK
001866 003466 10 FE                                           CLC                                             ;no valid data to return
001868 003468 3D                                              RTS                                             ;done
                                                              ;Checksum error
001869 003469 86 20                   SREC_PARSE_DATA_3       LDAA    #SREC_ERR_CHECKSUM                      ;return checksum erreor
00186B 00346B 20 F9                                           JOB     SREC_PARSE_DATA_2                       ;done
                                      ;#Parse header - blocking
                                      ; args:   none
                                      ; result: A: error code
                                      ;         B: type
                                      ; SSTACK: 16 bytes
                                      ;         X and Y are preserved
00186D 00346D -> $186D                SREC_PARSE_HEADER       EQU     *
                                                              ;Save registers
00186D 00346D 34                                              PSHX                                            ;save X
                                                              ;Clear S-record information
00186E 00346E 87                                              CLRA                                            ;zero -> D
00186F 00346F C7                                              CLRB                                            ;
001870 003470 7C 1A F0                                        STD     SREC_ADDR                               ;clear address
001873 003473 7C 1A F2                                        STD     SREC_ADDR+2                             ;
001876 003476 7C 1A F4                                        STD     SREC_TYPE                               ;clear type and byte count
                                                              ;Skip to the beginning of the next S-record
001879 003479 MACRO                                           SREC_SKIP_TYPE                                  ;type -> B, error code -> A (SSTACK: 12 bytes)
                                      ;#Skip to next type field - blocking                                             (SREC_SKIP_TYPE)
                                      ; args:   none                                                                   (SREC_SKIP_TYPE)
                                      ; result: A: error code                                                          (SREC_SKIP_TYPE)
                                      ;         B: type                                                                (SREC_SKIP_TYPE)
                                      ; SSTACK: 9 bytes                                                                (SREC_SKIP_TYPE)
                                      ;         X and Y are preserved                                                  (SREC_SKIP_TYPE)
001879 003479 MACRO                                           SSTACK_JOBSR    SREC_SKIP_TYPE, 12                       (SREC_SKIP_TYPE)
                                      ;#Check stack and call subroutine                                                (SREC_SKIP_TYPE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_SKIP_TYPE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_SKIP_TYPE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_SKIP_TYPE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_SKIP_TYPE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_SKIP_TYPE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_SKIP_TYPE/SSTACK_JOBSR)
001879 003479 16 19 0C                                        JOBSR   SREC_SKIP_TYPE                                   (SREC_SKIP_TYPE/SSTACK_JOBSR)
00187C 00347C 04 60 8B                                        TBNE    A, SREC_PARSE_HEADER_9                  ;communication error (fail)
00187F 00347F B7 15                                           TFR     B, X                                    ;type -> X
                                                              ;Get byte count (type in X)
001881 003481 MACRO                                           SREC_RX_BYTE                                    ;count -> B, error code in A (SSTACK: 12 bytes)
                                      ;#Receive one data byte - blocking                                               (SREC_RX_BYTE)
                                      ; args:   none                                                                   (SREC_RX_BYTE)
                                      ; result: A: error code                                                          (SREC_RX_BYTE)
                                      ;         B: byte                                                                (SREC_RX_BYTE)
                                      ; SSTACK: 12 bytes                                                               (SREC_RX_BYTE)
                                      ;         X and Y are preserved                                                  (SREC_RX_BYTE)
001881 003481 MACRO                                           SSTACK_JOBSR    SREC_RX_BYTE, 12                         (SREC_RX_BYTE)
                                      ;#Check stack and call subroutine                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_RX_BYTE/SSTACK_JOBSR)
001881 003481 16 19 46                                        JOBSR   SREC_RX_BYTE                                     (SREC_RX_BYTE/SSTACK_JOBSR)
001884 003484 04 60 80                                        TBNE    A, SREC_PARSE_HEADER_8                  ;error (fail)
001887 003487 7B 1A F6                                        STAB    SREC_CHECKSUM                           ;set initial checksum
00188A 00348A B7 95                                           EXG     B, X                                    ;byte count -> X, type -> B
                                                              ;Get address (byte count in X, type in D)
00188C 00348C 58                                              LSLB                                            ;jump table offset -> D
00188D 00348D 05 FF                                           JMP     [D,PC]                                  ;jump table
00188F 00348F 18 DF                                           DW      SREC_PARSE_HEADER_6                     ;S0 -> 16bit address
001891 003491 18 DA                                           DW      SREC_PARSE_HEADER_5                     ;S1 -> 16bit address
001893 003493 18 C1                                           DW      SREC_PARSE_HEADER_3                     ;S2 -> 24bit address
001895 003495 18 A7                                           DW      SREC_PARSE_HEADER_2                     ;S3 -> 32bit address
001897 003497 18 A3                                           DW      SREC_PARSE_HEADER_1                     ;S4 -> format error
001899 003499 18 DF                                           DW      SREC_PARSE_HEADER_6                     ;S5 -> 16bit address
00189B 00349B 18 C1                                           DW      SREC_PARSE_HEADER_3                     ;S6 -> 24bit address
00189D 00349D 18 A7                                           DW      SREC_PARSE_HEADER_2                     ;S7 -> 32bit address
00189F 00349F 18 C1                                           DW      SREC_PARSE_HEADER_3                     ;S8 -> 24bit address
0018A1 0034A1 18 DF                                           DW      SREC_PARSE_HEADER_6                     ;S9 -> 16bit address
                                                              ;Format error
0018A3 0034A3 86 40                   SREC_PARSE_HEADER_1     LDAA    #SREC_ERR_FORMAT
0018A5 0034A5 20 60                                           JOB     SREC_PARSE_HEADER_8
                                                              ;32bit address (byte count in X)
0018A7 0034A7 1A 1C                   SREC_PARSE_HEADER_2     LEAX    -4,X                                    ;subtract address width
0018A9 0034A9 B7 51                                           TFR     X, B                                    ;byte count -> B
0018AB 0034AB 7B 1A F5                                        STAB    SREC_BYTECOUNT                          ;store byte count
0018AE 0034AE MACRO                                           SREC_RX_BYTE                                    ;address byte -> B, error code in A (SSTACK: 12 bytes)
                                      ;#Receive one data byte - blocking                                               (SREC_RX_BYTE)
                                      ; args:   none                                                                   (SREC_RX_BYTE)
                                      ; result: A: error code                                                          (SREC_RX_BYTE)
                                      ;         B: byte                                                                (SREC_RX_BYTE)
                                      ; SSTACK: 12 bytes                                                               (SREC_RX_BYTE)
                                      ;         X and Y are preserved                                                  (SREC_RX_BYTE)
0018AE 0034AE MACRO                                           SSTACK_JOBSR    SREC_RX_BYTE, 12                         (SREC_RX_BYTE)
                                      ;#Check stack and call subroutine                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_RX_BYTE/SSTACK_JOBSR)
0018AE 0034AE 16 19 46                                        JOBSR   SREC_RX_BYTE                                     (SREC_RX_BYTE/SSTACK_JOBSR)
0018B1 0034B1 04 60 53                                        TBNE    A, SREC_PARSE_HEADER_8                  ;error (fail)
0018B4 0034B4 18 0F                                           TBA                                             ;address byte -> A
0018B6 0034B6 BB 1A F6                                        ADDA    SREC_CHECKSUM                           ;new checksum -> A
0018B9 0034B9 7A 1A F6                                        STAA    SREC_CHECKSUM                           ;update checksum
0018BC 0034BC 7B 1A F0                                        STAB    SREC_ADDR                               ;store address byte
0018BF 0034BF 20 07                                           JOB     SREC_PARSE_HEADER_4                     ;get remaining address bytes
                                                              ;24bit address (byte count in X)
0018C1 0034C1 1A 1D                   SREC_PARSE_HEADER_3     LEAX    -3,X                                    ;subtract address width
0018C3 0034C3 B7 51                                           TFR     X, B                                    ;byte count -> B
0018C5 0034C5 7B 1A F5                                        STAB    SREC_BYTECOUNT                          ;store byte count
0018C8 0034C8 MACRO                   SREC_PARSE_HEADER_4     SREC_RX_BYTE                                    ;address byte -> B, error code in A (SSTACK: 12 bytes)
                                      ;#Receive one data byte - blocking                                               (SREC_RX_BYTE)
                                      ; args:   none                                                                   (SREC_RX_BYTE)
                                      ; result: A: error code                                                          (SREC_RX_BYTE)
                                      ;         B: byte                                                                (SREC_RX_BYTE)
                                      ; SSTACK: 12 bytes                                                               (SREC_RX_BYTE)
                                      ;         X and Y are preserved                                                  (SREC_RX_BYTE)
0018C8 0034C8 MACRO                                           SSTACK_JOBSR    SREC_RX_BYTE, 12                         (SREC_RX_BYTE)
                                      ;#Check stack and call subroutine                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_RX_BYTE/SSTACK_JOBSR)
0018C8 0034C8 07 7C                                           JOBSR   SREC_RX_BYTE                                     (SREC_RX_BYTE/SSTACK_JOBSR)
0018CA 0034CA 04 60 3A                                        TBNE    A, SREC_PARSE_HEADER_8                  ;error (fail)
0018CD 0034CD 18 0F                                           TBA                                             ;address byte -> A
0018CF 0034CF BB 1A F6                                        ADDA    SREC_CHECKSUM                           ;new checksum -> A
0018D2 0034D2 7A 1A F6                                        STAA    SREC_CHECKSUM                           ;update checksum
0018D5 0034D5 7B 1A F1                                        STAB    SREC_ADDR+1                             ;store address byte
0018D8 0034D8 20 0C                                           JOB     SREC_PARSE_HEADER_7                     ;get remaining address bytes
                                                              ;16bit address (byte count in X)
0018DA 0034DA 18 0B 3F 1A F1          SREC_PARSE_HEADER_5     MOVB    #$3F, SREC_ADDR+1                       ;default offset
0018DF 0034DF 1A 1E                   SREC_PARSE_HEADER_6     LEAX    -2,X                                    ;subtract address width
0018E1 0034E1 B7 51                                           TFR     X, B                                    ;byte count -> B
0018E3 0034E3 7B 1A F5                                        STAB    SREC_BYTECOUNT                          ;store byte count
0018E6 0034E6 MACRO                   SREC_PARSE_HEADER_7     SREC_RX_BYTE                                    ;count -> B, error code in A (SSTACK: 12 bytes)
                                      ;#Receive one data byte - blocking                                               (SREC_RX_BYTE)
                                      ; args:   none                                                                   (SREC_RX_BYTE)
                                      ; result: A: error code                                                          (SREC_RX_BYTE)
                                      ;         B: byte                                                                (SREC_RX_BYTE)
                                      ; SSTACK: 12 bytes                                                               (SREC_RX_BYTE)
                                      ;         X and Y are preserved                                                  (SREC_RX_BYTE)
0018E6 0034E6 MACRO                                           SSTACK_JOBSR    SREC_RX_BYTE, 12                         (SREC_RX_BYTE)
                                      ;#Check stack and call subroutine                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_RX_BYTE/SSTACK_JOBSR)
0018E6 0034E6 07 5E                                           JOBSR   SREC_RX_BYTE                                     (SREC_RX_BYTE/SSTACK_JOBSR)
0018E8 0034E8 04 60 1C                                        TBNE    A, SREC_PARSE_HEADER_8                  ;error (fail)
0018EB 0034EB 18 0F                                           TBA                                             ;address byte -> A
0018ED 0034ED BB 1A F6                                        ADDA    SREC_CHECKSUM                           ;new checksum -> A
0018F0 0034F0 7A 1A F6                                        STAA    SREC_CHECKSUM                           ;update checksum
0018F3 0034F3 7B 1A F2                                        STAB    SREC_ADDR+2                             ;store address byte
0018F6 0034F6 MACRO                                           SREC_RX_BYTE                                    ;count -> B, error code in A (SSTACK: 12 bytes)
                                      ;#Receive one data byte - blocking                                               (SREC_RX_BYTE)
                                      ; args:   none                                                                   (SREC_RX_BYTE)
                                      ; result: A: error code                                                          (SREC_RX_BYTE)
                                      ;         B: byte                                                                (SREC_RX_BYTE)
                                      ; SSTACK: 12 bytes                                                               (SREC_RX_BYTE)
                                      ;         X and Y are preserved                                                  (SREC_RX_BYTE)
0018F6 0034F6 MACRO                                           SSTACK_JOBSR    SREC_RX_BYTE, 12                         (SREC_RX_BYTE)
                                      ;#Check stack and call subroutine                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_RX_BYTE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_RX_BYTE/SSTACK_JOBSR)
0018F6 0034F6 07 4E                                           JOBSR   SREC_RX_BYTE                                     (SREC_RX_BYTE/SSTACK_JOBSR)
0018F8 0034F8 04 60 0C                                        TBNE    A, SREC_PARSE_HEADER_8                  ;error (fail)
0018FB 0034FB 18 0F                                           TBA                                             ;address byte -> A
0018FD 0034FD BB 1A F6                                        ADDA    SREC_CHECKSUM                           ;new checksum -> A
001900 003500 7A 1A F6                                        STAA    SREC_CHECKSUM                           ;update checksum
001903 003503 7B 1A F3                                        STAB    SREC_ADDR+3                             ;store address byte
                                                              ;Return results
001906 003506 87                                              CLRA                                            ;return no errors
001907 003507 F6 1A F4                SREC_PARSE_HEADER_8     LDAB    SREC_TYPE                               ;return type
00190A 00350A MACRO                   SREC_PARSE_HEADER_9     SSTACK_PREPULL  4                               ;check SSTACK
00190A 00350A 30                                              PULX                                            ;restore B
00190B 00350B 3D                                              RTS                                             ;done
                                      ;#Skip to next type field - blocking
                                      ; args:   none
                                      ; result: A: error code
                                      ;         B: type
                                      ; SSTACK: 9 bytes
                                      ;         X and Y are preserved
00190C 00350C -> $190C                SREC_SKIP_TYPE          EQU     *
                                                              ;Receive first byte
00190C 00350C MACRO                   SREC_SKIP_TYPE_1        SCI_RX_BL                                       ;flags -> A, data -> B (SSTACK: 7 bytes)
                                      ;#Receive one byte - blocking                                                    (SCI_RX_BL)
                                      ; args:   none                                                                   (SCI_RX_BL)
                                      ; result: A: error flags                                                         (SCI_RX_BL)
                                      ;         B: received data                                                       (SCI_RX_BL)
                                      ; SSTACK: 7 bytes                                                                (SCI_RX_BL)
                                      ;         X and Y are preserved                                                  (SCI_RX_BL)
00190C 00350C MACRO                                           SSTACK_JOBSR    SCI_RX_BL, 6                             (SCI_RX_BL)
                                      ;#Check stack and call subroutine                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SCI_RX_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SCI_RX_BL/SSTACK_JOBSR)
00190C 00350C 16 14 B2                                        JOBSR   SCI_RX_BL                                        (SCI_RX_BL/SSTACK_JOBSR)
00190F 00350F 84 1F                                           ANDA    #(SWOR|OR|NF|FE|PF)                     ;check for communication error
001911 003511 26 21                                           BNE     SREC_SKIP_TYPE_4                        ;communication error (fail)
                                                              ;Check for "S" character (data in B, zero in A)
001913 003513 C1 73                                           CMPB    #"s"                                    ;check for lower case "s"
001915 003515 27 04                                           BEQ     SREC_SKIP_TYPE_2                        ;receive second byte
001917 003517 C1 53                                           CMPB    #"S"                                    ;check for upper case "S"
001919 003519 26 25                                           BNE     SREC_SKIP_TYPE_6                        ;check for line xbreak
                                                              ;Receive second byte
00191B 00351B MACRO                   SREC_SKIP_TYPE_2        SCI_RX_BL                                       ;flags -> A, data -> B (SSTACK: 7 bytes)
                                      ;#Receive one byte - blocking                                                    (SCI_RX_BL)
                                      ; args:   none                                                                   (SCI_RX_BL)
                                      ; result: A: error flags                                                         (SCI_RX_BL)
                                      ;         B: received data                                                       (SCI_RX_BL)
                                      ; SSTACK: 7 bytes                                                                (SCI_RX_BL)
                                      ;         X and Y are preserved                                                  (SCI_RX_BL)
00191B 00351B MACRO                                           SSTACK_JOBSR    SCI_RX_BL, 6                             (SCI_RX_BL)
                                      ;#Check stack and call subroutine                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SCI_RX_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SCI_RX_BL/SSTACK_JOBSR)
00191B 00351B 16 14 B2                                        JOBSR   SCI_RX_BL                                        (SCI_RX_BL/SSTACK_JOBSR)
00191E 00351E 84 1F                                           ANDA    #(SWOR|OR|NF|FE|PF)                     ;check for communication error
001920 003520 26 12                                           BNE     SREC_SKIP_TYPE_4                        ;communication error (fail)
                                                              ;Check for valid type (data in B, zero in A)
001922 003522 C1 30                                           CMPB    #"0"                                    ;check lower boundary
001924 003524 25 13                                           BLO     SREC_SKIP_TYPE_5                        ;skip to next line
001926 003526 C1 39                                           CMPB    #"9"                                    ;check upper boundary
001928 003528 22 0F                                           BHI     SREC_SKIP_TYPE_5                        ;skip to next line
00192A 00352A C1 34                                           CMPB    #"4"                                    ;check upper boundary
00192C 00352C 27 0B                                           BEQ     SREC_SKIP_TYPE_5                        ;skip to next line
00192E 00352E C4 0F                                           ANDB    #$0F                                    ;mask range
001930 003530 7B 1A F4                                        STAB    SREC_TYPE                               ;update current type
                                                              ;Return result (type in B, error code in A)
001933 003533 MACRO                   SREC_SKIP_TYPE_3        SSTACK_PREPULL  2                               ;check SSTACK
001933 003533 3D                                              RTS                                             ;done
                                                              ;Communication error
001934 003534 CC 80 00                SREC_SKIP_TYPE_4        LDD     #(SREC_ERR_RX<<8)                       ;set error code
001937 003537 20 FA                                           JOB     SREC_SKIP_TYPE_3                        ;done
                                                              ;Skip to next line
001939 003539 MACRO                   SREC_SKIP_TYPE_5        SCI_RX_BL                                       ;flags -> A, data -> B (SSTACK: 7 bytes)
                                      ;#Receive one byte - blocking                                                    (SCI_RX_BL)
                                      ; args:   none                                                                   (SCI_RX_BL)
                                      ; result: A: error flags                                                         (SCI_RX_BL)
                                      ;         B: received data                                                       (SCI_RX_BL)
                                      ; SSTACK: 7 bytes                                                                (SCI_RX_BL)
                                      ;         X and Y are preserved                                                  (SCI_RX_BL)
001939 003539 MACRO                                           SSTACK_JOBSR    SCI_RX_BL, 6                             (SCI_RX_BL)
                                      ;#Check stack and call subroutine                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SCI_RX_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SCI_RX_BL/SSTACK_JOBSR)
001939 003539 16 14 B2                                        JOBSR   SCI_RX_BL                                        (SCI_RX_BL/SSTACK_JOBSR)
00193C 00353C 84 1F                                           ANDA    #(SWOR|OR|NF|FE|PF)                     ;check for communication error
00193E 00353E 26 F4                                           BNE     SREC_SKIP_TYPE_4                        ;communication error (fail)
                                                              ;Check for line break (data in B, zero in A)
001940 003540 C1 0A                   SREC_SKIP_TYPE_6        CMPB    #SREC_C0_LF                             ;check for line feed
001942 003542 26 F5                                           BNE     SREC_SKIP_TYPE_5                        ;skip
001944 003544 20 C6                                           JOB     SREC_SKIP_TYPE_1                        ;Parse type field
                                      ;#Receive one data byte - blocking
                                      ; args:   none
                                      ; result: A: error code
                                      ;         B: byte
                                      ; SSTACK: 12 bytes
                                      ;         X and Y are preserved
001946 003546 -> $1946                SREC_RX_BYTE            EQU     *
                                                              ;Reserve temporary stack space
001946 003546 1B 9F                                           LEAS    -1,SP                                   ;allocate stack
                                                              ;Receive first nibble
001948 003548 MACRO                                           SREC_RX_NIBBLE                                  ;data -> B, error code -> A (SSTACK: 9 bytes)
                                      ;#Receive one data nibble - blocking                                             (SREC_RX_NIBBLE)
                                      ; args:   none                                                                   (SREC_RX_NIBBLE)
                                      ; result: A: error code                                                          (SREC_RX_NIBBLE)
                                      ;         B: hexadecimal digit                                                   (SREC_RX_NIBBLE)
                                      ; SSTACK: 9 bytes                                                                (SREC_RX_NIBBLE)
                                      ;         X and Y are preserved                                                  (SREC_RX_NIBBLE)
001948 003548 MACRO                                           SSTACK_JOBSR    SREC_RX_NIBBLE, 9                        (SREC_RX_NIBBLE)
                                      ;#Check stack and call subroutine                                                (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_RX_NIBBLE/SSTACK_JOBSR)
001948 003548 07 13                                           JOBSR   SREC_RX_NIBBLE                                   (SREC_RX_NIBBLE/SSTACK_JOBSR)
00194A 00354A 04 60 0D                                        TBNE    A, SREC_RX_BYTE_1                       ;error (fail)
                                                              ;Shift nibble (nibble in B, zero in A)
00194D 00354D 58                                              LSLB                                            ;shift to upper nibble
00194E 00354E 58                                              LSLB                                            ;
00194F 00354F 58                                              LSLB                                            ;
001950 003550 58                                              LSLB                                            ;
001951 003551 6B 80                                           STAB    0,SP                                    ;store nibble
                                                              ;Receive second nibble
001953 003553 MACRO                                           SREC_RX_NIBBLE                                  ;data -> B, error code -> A (SSTACK: 9 bytes)
                                      ;#Receive one data nibble - blocking                                             (SREC_RX_NIBBLE)
                                      ; args:   none                                                                   (SREC_RX_NIBBLE)
                                      ; result: A: error code                                                          (SREC_RX_NIBBLE)
                                      ;         B: hexadecimal digit                                                   (SREC_RX_NIBBLE)
                                      ; SSTACK: 9 bytes                                                                (SREC_RX_NIBBLE)
                                      ;         X and Y are preserved                                                  (SREC_RX_NIBBLE)
001953 003553 MACRO                                           SSTACK_JOBSR    SREC_RX_NIBBLE, 9                        (SREC_RX_NIBBLE)
                                      ;#Check stack and call subroutine                                                (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SREC_RX_NIBBLE/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SREC_RX_NIBBLE/SSTACK_JOBSR)
001953 003553 07 08                                           JOBSR   SREC_RX_NIBBLE                                   (SREC_RX_NIBBLE/SSTACK_JOBSR)
001955 003555 04 60 02                                        TBNE    A, SREC_RX_BYTE_1                       ;error (fail)
001958 003558 EA 80                                           ORAB    0,SP                                    ;assemble data byte
                                                              ;Return result (byte in B, error code in A)
00195A 00355A MACRO                   SREC_RX_BYTE_1          SSTACK_PREPULL  3                               ;check SSTACK
00195A 00355A 1B 81                                           LEAS    1,SP                                    ;free stack
00195C 00355C 3D                                              RTS                                             ;done
                                      ;#Receive one data nibble - blocking
                                      ; args:   none
                                      ; result: A: error code
                                      ;         B: hexadecimal digit
                                      ; SSTACK: 9 bytes
                                      ;         X and Y are preserved
00195D 00355D -> $195D                SREC_RX_NIBBLE          EQU     *
                                                              ;Receive byte
00195D 00355D MACRO                                           SCI_RX_BL                                       ;flags -> A, data -> B (SSTACK: 7 bytes)
                                      ;#Receive one byte - blocking                                                    (SCI_RX_BL)
                                      ; args:   none                                                                   (SCI_RX_BL)
                                      ; result: A: error flags                                                         (SCI_RX_BL)
                                      ;         B: received data                                                       (SCI_RX_BL)
                                      ; SSTACK: 7 bytes                                                                (SCI_RX_BL)
                                      ;         X and Y are preserved                                                  (SCI_RX_BL)
00195D 00355D MACRO                                           SSTACK_JOBSR    SCI_RX_BL, 6                             (SCI_RX_BL)
                                      ;#Check stack and call subroutine                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   required stack capacity (bytes)                                        (SCI_RX_BL/SSTACK_JOBSR)
                                      ; result: 1: subroutine                                                          (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         2: required stack space                                                (SCI_RX_BL/SSTACK_JOBSR)
                                      ; SSTACK: arg 2                                                                  (SCI_RX_BL/SSTACK_JOBSR)
                                      ;         register content may be changed by the subroutine                      (SCI_RX_BL/SSTACK_JOBSR)
                                      ; args:   1: Number of bytes to be allocated (args + local vars)                 (SCI_RX_BL/SSTACK_JOBSR)
00195D 00355D 16 14 B2                                        JOBSR   SCI_RX_BL                                        (SCI_RX_BL/SSTACK_JOBSR)
001960 003560 84 1F                                           ANDA    #(SWOR|OR|NF|FE|PF)                     ;check for communication error
001962 003562 26 1D                                           BNE     SREC_RX_NIBBLE_4                        ;communication error (fail)
                                                              ;Check decimal range (data in B, zero in A)
001964 003564 C1 30                                           CMPB    #"0"                                    ;check lower boundary
001966 003566 25 1E                                           BLO     SREC_RX_NIBBLE_5                        ;format error
001968 003568 C1 39                                           CMPB    #"9"                                    ;check upper boundary
00196A 00356A 23 12                                           BLS     SREC_RX_NIBBLE_2                        ;digit found
                                                              ;Check upper case range (data in B, zero in A)
00196C 00356C C1 41                                           CMPB    #"A"                                    ;check lower boundary
00196E 00356E 25 16                                           BLO     SREC_RX_NIBBLE_5                        ;format error
001970 003570 C1 46                                           CMPB    #"F"                                    ;check upper boundary
001972 003572 23 08                                           BLS     SREC_RX_NIBBLE_1                        ;digit found
                                                              ;Check lower case range (data in B, zero in A)
001974 003574 C1 61                                           CMPB    #"a"                                    ;check lower boundary
001976 003576 25 0E                                           BLO     SREC_RX_NIBBLE_5                        ;format error
001978 003578 C1 66                                           CMPB    #"f"                                    ;check upper boundary
00197A 00357A 22 0A                                           BHI     SREC_RX_NIBBLE_5                        ;format error
00197C 00357C CB 09                   SREC_RX_NIBBLE_1        ADDB    #9                                      ;addd offset
00197E 00357E C4 0F                   SREC_RX_NIBBLE_2        ANDB    #$0F                                    ;mask range
                                                              ;Return result (digit in B, error code in A)
001980 003580 MACRO                   SREC_RX_NIBBLE_3        SSTACK_PREPULL  2                               ;check SSTACK
001980 003580 3D                                              RTS                                             ;done
                                                              ;Communication error
001981 003581 CC 80 00                SREC_RX_NIBBLE_4        LDD     #(SREC_ERR_RX<<8)                       ;set error code
001984 003584 20 FA                                           JOB     SREC_RX_NIBBLE_3                        ;done
                                                              ;Format error
001986 003586 CC 40 00                SREC_RX_NIBBLE_5        LDD     #(SREC_ERR_FORMAT<<8)                   ;set error code
001989 003589 20 F5                                           JOB     SREC_RX_NIBBLE_3                        ;done
00198B 00358B -> $198B                SREC_CODE_END           EQU     *
00198B 00358B -> $358B                SREC_CODE_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
001402 003002                                                 ORG     SREC_TABS_START, SREC_TABS_START_LIN
001402 003002 MACRO                   SREC_MSG_S0_HEADER      STRING_NL_NONTERM
                                      ;#Non-terminated line break                                                      (STRING_NL_NONTERM)
001402 003002 0D                                              DB      STRING_NL_1ST                                    (STRING_NL_NONTERM)
001403 003003 0A                                              DB      STRING_NL_2ND                                    (STRING_NL_NONTERM)
001404 003004 55 70 6C 6F 61 64 69 6E                         FCS     "Uploading: "
              67 3A A0                
00140F 00300F -> $140F                SREC_TABS_END           EQU     *
00140F 00300F -> $300F                SREC_TABS_END_LIN       EQU     @
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
001AF7 001AF7                                                 ORG     IMG_VARS_START, IMG_VARS_START_LIN
001AF7 001AF7 -> $1AF7                IMG_VARS_END            EQU     *
001AF7 001AF7 -> $1AF7                IMG_VARS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
00386B 00386B                                                 ORG     IMG_CODE_START, IMG_CODE_START_LIN
00386B 00386B -> $386B                IMG_CODE_END            EQU     *
00386B 00386B -> $386B                IMG_CODE_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
003926 003926                                                 ORG     IMG_TABS_START, IMG_TABS_START_LIN
                                      ;#Display configurationtion
                                      ;#=========================
003926 003926 -> $3926                IMG_SEQ_INIT_START      EQU     *
003926 003926 MACRO                                           DISP_SEQ_CONFIG                 ;configure display
                                      ;#Display configuration                                                          (DISP_SEQ_CONFIG)
                                                              ;DISP_SEQ_CMD                           ;switch to command mode (DISP_SEQ_CONFIG)
                                                              ;Initialize the display                                  (DISP_SEQ_CONFIG)
003926 003926 40                                              DB      $40                             ;start display at line 0 (DISP_SEQ_CONFIG)
                                                              ;DB     $A0                             ;flip display    (DISP_SEQ_CONFIG)
                                                              ;DB     $C8                             ;reverse COM63~COM0 (DISP_SEQ_CONFIG)
003927 003927 A1                                              DB      $A1                             ;flip display    (DISP_SEQ_CONFIG)
003928 003928 C0                                              DB      $C0                             ;normal COM0~COM63 (DISP_SEQ_CONFIG)
003929 003929 A2                                              DB      $A2                             ;set bias 1/9 (Duty 1/65) ; (DISP_SEQ_CONFIG)
00392A 00392A 2F                                              DB      $2F                             ;enabable booster, regulator and follower (DISP_SEQ_CONFIG)
00392B 00392B F8                                              DB      $F8                             ;set booster to 4x (DISP_SEQ_CONFIG)
00392C 00392C 00                                              DB      $00                             ;                (DISP_SEQ_CONFIG)
00392D 00392D 27                                              DB      $27                             ;set ref value to 6.5 (DISP_SEQ_CONFIG)
00392E 00392E 81                                              DB      $81                             ;set alpha value to 47 (DISP_SEQ_CONFIG)
00392F 00392F 10                                              DB      $10                             ;V0=alpha*(1-(ref/162)*2.1V =[4V..13.5V] (DISP_SEQ_CONFIG)
003930 003930 AC                                              DB      $AC                             ;no static indicator (DISP_SEQ_CONFIG)
003931 003931 00                                              DB      $00                             ;                (DISP_SEQ_CONFIG)
003932 003932 AF                                              DB      $AF                             ;enable display  (DISP_SEQ_CONFIG)
                                      ;#Static content - pages 0 to 5
                                      ;#=============================
                                      ;#Page 0:
003933 003933 B0 10 00                                        DB  $B0 $10 $00                     ;set page and column address
003936 003936 E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003938 003938 E3 04 00                                        DB  DISP_ESC_START $04 $00          ;repeat 5 times
00393B 00393B FF FF                                           DB  $FF $FF
00393D 00393D E3 03 33                                        DB  DISP_ESC_START $03 $33          ;repeat 4 times
003940 003940 03 00 00 FB FB 00 00 F8                         DB  $03 $00 $00 $FB $FB $00 $00 $F8
003948 003948 F8 30 18 18 00 F8 F8 10                         DB  $F8 $30 $18 $18 $00 $F8 $F8 $10
003950 003950 18 F8 F0 10 18 F8 F0 00                         DB  $18 $F8 $F0 $10 $18 $F8 $F0 $00
003958 003958 18 F8 E0 80 F0 78 F0 80                         DB  $18 $F8 $E0 $80 $F0 $78 $F0 $80
003960 003960 E0 F8 18 00 10 98 D8 58                         DB  $E0 $F8 $18 $00 $10 $98 $D8 $58
003968 003968 F8 F0 00 00 F8 F8 30 18                         DB  $F8 $F0 $00 $00 $F8 $F8 $30 $18
003970 003970 18 00 E0 F0 D8 D8 D8 F0                         DB  $18 $00 $E0 $F0 $D8 $D8 $D8 $F0
003978 003978 E0                                              DB  $E0
003979 003979 E3 05 00                                        DB  DISP_ESC_START $05 $00          ;repeat 6 times
00397C 00397C FF FF                                           DB  $FF $FF
00397E 00397E E3 04 00                                        DB  DISP_ESC_START $04 $00          ;repeat 5 times
003981 003981 FF FF 00 00 F8 F8 30 18                         DB  $FF $FF $00 $00 $F8 $F8 $30 $18
003989 003989 38 F0 E0 00 00 E0 F0 38                         DB  $38 $F0 $E0 $00 $00 $E0 $F0 $38
003991 003991 18 30 FF FF 00 00 10 98                         DB  $18 $30 $FF $FF $00 $00 $10 $98
003999 003999 D8 58 F8 F0 00 18 FC FE                         DB  $D8 $58 $F8 $F0 $00 $18 $FC $FE
0039A1 0039A1 18 18 00 E0 F0 D8 D8 D8                         DB  $18 $18 $00 $E0 $F0 $D8 $D8 $D8
0039A9 0039A9 F0 E0                                           DB  $F0 $E0
0039AB 0039AB E3 04 00                                        DB  DISP_ESC_START $04 $00          ;repeat 5 times
0039AE 0039AE E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 1:
0039B0 0039B0 B1 10 00                                        DB  $B1 $10 $00                     ;set page and column address
0039B3 0039B3 E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
0039B5 0039B5 E3 03 00                                        DB  DISP_ESC_START $03 $00          ;repeat 4 times
0039B8 0039B8 30 37 37                                        DB  $30 $37 $37
0039BB 0039BB E3 06 30                                        DB  DISP_ESC_START $06 $30          ;repeat 7 times
0039BE 0039BE 37 37 30 30 37 37                               DB  $37 $37 $30 $30 $37 $37
0039C4 0039C4 E3 03 30                                        DB  DISP_ESC_START $03 $30          ;repeat 4 times
0039C7 0039C7 37 37 30 30 37 37 30 30                         DB  $37 $37 $30 $30 $37 $37 $30 $30
0039CF 0039CF 37 37 30 30 30 37 37 33                         DB  $37 $37 $30 $30 $30 $37 $37 $33
0039D7 0039D7 30 33 37 37 30 30 30 33                         DB  $30 $33 $37 $37 $30 $30 $30 $33
0039DF 0039DF 37 36 36 33 37 34 30 37                         DB  $37 $36 $36 $33 $37 $34 $30 $37
0039E7 0039E7 37                                              DB  $37
0039E8 0039E8 E3 03 30                                        DB  DISP_ESC_START $03 $30          ;repeat 4 times
0039EB 0039EB 31 33                                           DB  $31 $33
0039ED 0039ED E3 03 36                                        DB  DISP_ESC_START $03 $36          ;repeat 4 times
0039F0 0039F0 32                                              DB  $32
0039F1 0039F1 E3 05 30                                        DB  DISP_ESC_START $05 $30          ;repeat 6 times
0039F4 0039F4 31 33 37 36 36 36 37 33                         DB  $31 $33 $37 $36 $36 $36 $37 $33
0039FC 0039FC 31 30 00 3F 3F 03 36 37                         DB  $31 $30 $00 $3F $3F $03 $36 $37
003A04 003A04 33 31 30 30 31 33 37 36                         DB  $33 $31 $30 $30 $31 $33 $37 $36
003A0C 003A0C 33 37 37 30 30 33 37 36                         DB  $33 $37 $37 $30 $30 $33 $37 $36
003A14 003A14 36 33 37 34 30 33 37 36                         DB  $36 $33 $37 $34 $30 $33 $37 $36
003A1C 003A1C 36 30 31 33                                     DB  $36 $30 $31 $33
003A20 003A20 E3 03 36                                        DB  DISP_ESC_START $03 $36          ;repeat 4 times
003A23 003A23 32 30                                           DB  $32 $30
003A25 003A25 E3 03 00                                        DB  DISP_ESC_START $03 $00          ;repeat 4 times
003A28 003A28 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 2:
003A2A 003A2A B2 10 00                                        DB  $B2 $10 $00                     ;set page and column address
003A2D 003A2D E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003A2F 003A2F E3 13 00                                        DB  DISP_ESC_START $13 $00          ;repeat 20 times
003A32 003A32 10 10 F0 10 10 00 80 40                         DB  $10 $10 $F0 $10 $10 $00 $80 $40
003A3A 003A3A 40 80 00 00 C0 40 00 C0                         DB  $40 $80 $00 $00 $C0 $40 $00 $C0
003A42 003A42 40 40 80 40 40 80 00 00                         DB  $40 $40 $80 $40 $40 $80 $00 $00
003A4A 003A4A D0 00 00 C0 40 40 80 00                         DB  $D0 $00 $00 $C0 $40 $40 $80 $00
003A52 003A52 00 00 40 40 80 00 00 F0                         DB  $00 $00 $40 $40 $80 $00 $00 $F0
003A5A 003A5A E3 04 00                                        DB  DISP_ESC_START $04 $00          ;repeat 5 times
003A5D 003A5D 60 90 90 90 20 00 00 80                         DB  $60 $90 $90 $90 $20 $00 $00 $80
003A65 003A65 40 40 80 00 40 F0 40 40                         DB  $40 $40 $80 $00 $40 $F0 $40 $40
003A6D 003A6D F0 40 00 D0 00 00 C0 40                         DB  $F0 $40 $00 $D0 $00 $00 $C0 $40
003A75 003A75 40 80 00 00 80 40 40 C0                         DB  $40 $80 $00 $00 $80 $40 $40 $C0
003A7D 003A7D 00 80 40 40 40 00 40                            DB  $00 $80 $40 $40 $40 $00 $40
003A84 003A84 E3 17 00                                        DB  DISP_ESC_START $17 $00          ;repeat 24 times
003A87 003A87 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 3:
003A89 003A89 B3 10 00                                        DB  $B3 $10 $00                     ;set page and column address
003A8C 003A8C E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003A8E 003A8E E3 06 00                                        DB  DISP_ESC_START $06 $00          ;repeat 7 times
003A91 003A91 80 40 40 80 00 80 40 40                         DB  $80 $40 $40 $80 $00 $80 $40 $40
003A99 003A99 80 00 80 40 40 80 00 87                         DB  $80 $00 $80 $40 $40 $80 $00 $87
003AA1 003AA1 40 40 80 03 05 05 05 C0                         DB  $40 $40 $80 $03 $05 $05 $05 $C0
003AA9 003AA9 00 07 00 00 07 00 00 07                         DB  $00 $07 $00 $00 $07 $00 $00 $07
003AB1 003AB1 00 00 07 00 00 07 00 00                         DB  $00 $00 $07 $00 $00 $07 $00 $00
003AB9 003AB9 07 00 00 07 C0 00 06 05                         DB  $07 $00 $00 $07 $C0 $00 $06 $05
003AC1 003AC1 05 07 00 00 87 40 40 80                         DB  $05 $07 $00 $00 $87 $40 $40 $80
003AC9 003AC9 00 00 C2 84 04 04 C3 00                         DB  $00 $00 $C2 $84 $04 $04 $C3 $00
003AD1 003AD1 00 83 C5 05 05 00 00 03                         DB  $00 $83 $C5 $05 $05 $00 $00 $03
003AD9 003AD9 04 00 03 04 C0 47 40 40                         DB  $04 $00 $03 $04 $C0 $47 $40 $40
003AE1 003AE1 87 00 40 47 C0 40 4B 14                         DB  $87 $00 $40 $47 $C0 $40 $4B $14
003AE9 003AE9 94 4F 40 84 05 05 02 C0                         DB  $94 $4F $40 $84 $05 $05 $02 $C0
003AF1 003AF1 04 80 40 40 40 80 00 40                         DB  $04 $80 $40 $40 $40 $80 $00 $40
003AF9 003AF9 40 C0 40 40 00 80 40 40                         DB  $40 $C0 $40 $40 $00 $80 $40 $40
003B01 003B01 80                                              DB  $80
003B02 003B02 E3 07 00                                        DB  DISP_ESC_START $07 $00          ;repeat 8 times
003B05 003B05 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 4:
003B07 003B07 B4 10 00                                        DB  $B4 $10 $00                     ;set page and column address
003B0A 003B0A E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003B0C 003B0C E3 06 00                                        DB  DISP_ESC_START $06 $00          ;repeat 7 times
003B0F 003B0F 09 12 12 0F 00 0F 12 12                         DB  $09 $12 $12 $0F $00 $0F $12 $12
003B17 003B17 0C 00 0F 10 10 0F 00 0F                         DB  $0C $00 $0F $10 $10 $0F $00 $0F
003B1F 003B1F 10 10 0F                                        DB  $10 $10 $0F
003B22 003B22 E3 03 00                                        DB  DISP_ESC_START $03 $00          ;repeat 4 times
003B25 003B25 1F 11 11 11 0E 00 09 15                         DB  $1F $11 $11 $11 $0E $00 $09 $15
003B2D 003B2D 15 1E 00 0F 10 10 10 1F                         DB  $15 $1E $00 $0F $10 $10 $10 $1F
003B35 003B35 00 0E 11 11 11 1F 00 00                         DB  $00 $0E $11 $11 $11 $1F $00 $00
003B3D 003B3D 30                                              DB  $30
003B3E 003B3E E3 03 00                                        DB  DISP_ESC_START $03 $00          ;repeat 4 times
003B41 003B41 0D 12 12 0D 00 00 1F 01                         DB  $0D $12 $12 $0D $00 $00 $1F $01
003B49 003B49 02 0C 1F 00 01 00 1F 00                         DB  $02 $0C $1F $00 $01 $00 $1F $00
003B51 003B51 00 00 30                                        DB  $00 $00 $30
003B54 003B54 E3 04 00                                        DB  DISP_ESC_START $04 $00          ;repeat 5 times
003B57 003B57 1F 02 06 0A 11 00 00 00                         DB  $1F $02 $06 $0A $11 $00 $00 $00
003B5F 003B5F 1F 00 00 00 09 12 12 0C                         DB  $1F $00 $00 $00 $09 $12 $12 $0C
003B67 003B67 00 18 07 00 00 0F 10 10                         DB  $00 $18 $07 $00 $00 $0F $10 $10
003B6F 003B6F 10 08 00 00 00 1F 00 00                         DB  $10 $08 $00 $00 $00 $1F $00 $00
003B77 003B77 00 09 12 12 0C                                  DB  $00 $09 $12 $12 $0C
003B7C 003B7C E3 07 00                                        DB  DISP_ESC_START $07 $00          ;repeat 8 times
003B7F 003B7F E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 5:
003B81 003B81 B5 10 00                                        DB  $B5 $10 $00                     ;set page and column address
003B84 003B84 E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003B86 003B86 E3 7F 00                                        DB  DISP_ESC_START $7F $00          ;repeat 128 times
003B89 003B89 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#"READY" banner - pages 6 to 7
                                      ;#=============================
                                      ;#Page 6:
003B8B 003B8B B6 10 00                                        DB  $B6 $10 $00                     ;set page and column address
003B8E 003B8E E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003B90 003B90 E3 29 00                                        DB  DISP_ESC_START $29 $00          ;repeat 42 times
003B93 003B93 F8 FF 67 63                                     DB  $F8 $FF $67 $63
003B97 003B97 E3 01 E3                                        DB  DISP_ESC_START $01 $E3          ;repeat 2 times
003B9A 003B9A 33 3F 1E 00 E0 F0 78 58                         DB  $33 $3F $1E $00 $E0 $F0 $78 $58
003BA2 003BA2 58 78 70 00 80 90 D8 58                         DB  $58 $78 $70 $00 $80 $90 $D8 $58
003BAA 003BAA D8 F8 70 00 E0 F0 38 18                         DB  $D8 $F8 $70 $00 $E0 $F0 $38 $18
003BB2 003BB2 18 B0 F8 FF 07 18 F8 E0                         DB  $18 $B0 $F8 $FF $07 $18 $F8 $E0
003BBA 003BBA 00 C0 F0 38 08 00 F8 3F                         DB  $00 $C0 $F0 $38 $08 $00 $F8 $3F
003BC2 003BC2 07                                              DB  $07
003BC3 003BC3 E3 26 00                                        DB  DISP_ESC_START $26 $00          ;repeat 39 times
003BC6 003BC6 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 7:
003BC8 003BC8 B7 10 00                                        DB  $B7 $10 $00                     ;set page and column address
003BCB 003BCB E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003BCD 003BCD E3 28 00                                        DB  DISP_ESC_START $28 $00          ;repeat 41 times
003BD0 003BD0 07 07                                           DB  $07 $07
003BD2 003BD2 E3 03 00                                        DB  DISP_ESC_START $03 $00          ;repeat 4 times
003BD5 003BD5 03 07 04 00 00 01 03 06                         DB  $03 $07 $04 $00 $00 $01 $03 $06
003BDD 003BDD 06 06 03 01 00 03 07 06                         DB  $06 $06 $03 $01 $00 $03 $07 $06
003BE5 003BE5 02 07 07 00 00 03 07 06                         DB  $02 $07 $07 $00 $00 $03 $07 $06
003BED 003BED 06 02 07 07 00 30 30 39                         DB  $06 $02 $07 $07 $00 $30 $30 $39
003BF5 003BF5 1F 0F 03 00 00 00 06 06                         DB  $1F $0F $03 $00 $00 $00 $06 $06
003BFD 003BFD E3 28 00                                        DB  DISP_ESC_START $28 $00          ;repeat 41 times
003C00 003C00 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
003C02 003C02 -> $3C02                DISP_SEQ_INIT_END       EQU     *
                                      ;#"BUSY" banner - pages 6 to 7
                                      ;#============================
003C02 003C02 -> $3C02                IMG_SEQ_BUSY_START      EQU     *
                                      ;#Page 6:
003C02 003C02 B6 10 00                                        DB  $B6 $10 $00                     ;set page and column address
003C05 003C05 E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003C07 003C07 E3 2E 00                                        DB  DISP_ESC_START $2E $00          ;repeat 47 times
003C0A 003C0A F8 FF 37 33 33 33 F3 DF                         DB  $F8 $FF $37 $33 $33 $33 $F3 $DF
003C12 003C12 0E 00 80 F8 78 00 00 80                         DB  $0E $00 $80 $F8 $78 $00 $00 $80
003C1A 003C1A F8 78 00 00 70 F8 D8 D8                         DB  $F8 $78 $00 $00 $70 $F8 $D8 $D8
003C22 003C22 98 10 00 18 F8 E0 00 C0                         DB  $98 $10 $00 $18 $F8 $E0 $00 $C0
003C2A 003C2A F0 38 08 00 F8 3F 07                            DB  $F0 $38 $08 $00 $F8 $3F $07
003C31 003C31 E3 29 00                                        DB  DISP_ESC_START $29 $00          ;repeat 42 times
003C34 003C34 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 7:
003C36 003C36 B7 10 00                                        DB  $B7 $10 $00                     ;set page and column address
003C39 003C39 E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003C3B 003C3B E3 2D 00                                        DB  DISP_ESC_START $2D $00          ;repeat 46 times
003C3E 003C3E 07 07                                           DB  $07 $07
003C40 003C40 E3 03 06                                        DB  DISP_ESC_START $03 $06          ;repeat 4 times
003C43 003C43 07 03 01 00 00 03 07 06                         DB  $07 $03 $01 $00 $00 $03 $07 $06
003C4B 003C4B 06 02 07 07 00 00 02 06                         DB  $06 $02 $07 $07 $00 $00 $02 $06
003C53 003C53 06 06 07 03 00 30 30 39                         DB  $06 $06 $07 $03 $00 $30 $30 $39
003C5B 003C5B 1F 0F 03 00 00 00 06 06                         DB  $1F $0F $03 $00 $00 $00 $06 $06
003C63 003C63 E3 2B 00                                        DB  DISP_ESC_START $2B $00          ;repeat 44 times
003C66 003C66 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
003C68 003C68 -> $3C68                IMG_SEQ_BUSY_END        EQU     *
                                      ;#"DONE" banner - pages 6 to 7
                                      ;#============================
003C68 003C68 -> $3C68                IMG_SEQ_DONE_START      EQU     *
                                      ;#Page 6:
003C68 003C68 B6 10 00                                        DB  $B6 $10 $00                     ;set page and column address
003C6B 003C6B E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003C6D 003C6D E3 2E 00                                        DB  DISP_ESC_START $2E $00          ;repeat 47 times
003C70 003C70 F8 FF 07 03 03 03 87 FE                         DB  $F8 $FF $07 $03 $03 $03 $87 $FE
003C78 003C78 7C 00 E0 F0 38 18 18 18                         DB  $7C $00 $E0 $F0 $38 $18 $18 $18
003C80 003C80 F0 E0 00 00 F8 F8 30 18                         DB  $F0 $E0 $00 $00 $F8 $F8 $30 $18
003C88 003C88 18 F8 F0 00 E0 F0 78 58                         DB  $18 $F8 $F0 $00 $E0 $F0 $78 $58
003C90 003C90 58 78 70 00 00 F8 3F 07                         DB  $58 $78 $70 $00 $00 $F8 $3F $07
003C98 003C98 E3 28 00                                        DB  DISP_ESC_START $28 $00          ;repeat 41 times
003C9B 003C9B E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 7:
003C9D 003C9D B7 10 00                                        DB  $B7 $10 $00                     ;set page and column address
003CA0 003CA0 E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003CA2 003CA2 E3 2D 00                                        DB  DISP_ESC_START $2D $00          ;repeat 46 times
003CA5 003CA5 07 07                                           DB  $07 $07
003CA7 003CA7 E3 03 06                                        DB  DISP_ESC_START $03 $06          ;repeat 4 times
003CAA 003CAA 07 03 01 00 00 01 03 06                         DB  $07 $03 $01 $00 $00 $01 $03 $06
003CB2 003CB2 06 06 07 03 01 00 07 07                         DB  $06 $06 $07 $03 $01 $00 $07 $07
003CBA 003CBA 00 00 00 07 07 00 00 01                         DB  $00 $00 $00 $07 $07 $00 $00 $01
003CC2 003CC2 03 06 06 06 03 01 00 06                         DB  $03 $06 $06 $06 $03 $01 $00 $06
003CCA 003CCA 06                                              DB  $06
003CCB 003CCB E3 2A 00                                        DB  DISP_ESC_START $2A $00          ;repeat 43 times
003CCE 003CCE E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
003CD0 003CD0 -> $3CD0                IMG_SEQ_DONE_END        EQU     *
                                      ;#"ERROR" banner - pages 6 to 7
                                      ;#=============================
003CD0 003CD0 -> $3CD0                IMG_SEQ_ERROR_START     EQU     *
                                      ;#Page 6:
003CD0 003CD0 B6 10 00                                        DB  $B6 $10 $00                     ;set page and column address
003CD3 003CD3 E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003CD5 003CD5 E3 2E 00                                        DB  DISP_ESC_START $2E $00          ;repeat 47 times
003CD8 003CD8 F8 FF 37                                        DB  $F8 $FF $37
003CDB 003CDB E3 03 33                                        DB  DISP_ESC_START $03 $33          ;repeat 4 times
003CDE 003CDE 03 03 00 F8 F8 30 18 18                         DB  $03 $03 $00 $F8 $F8 $30 $18 $18
003CE6 003CE6 00 F8 F8 30 18 18 E0 F0                         DB  $00 $F8 $F8 $30 $18 $18 $E0 $F0
003CEE 003CEE 38 18 18 18 F0 E0 00 00                         DB  $38 $18 $18 $18 $F0 $E0 $00 $00
003CF6 003CF6 F8 F8 30 18 18 00 F8 3F                         DB  $F8 $F8 $30 $18 $18 $00 $F8 $3F
003CFE 003CFE 07                                              DB  $07
003CFF 003CFF E3 28 00                                        DB  DISP_ESC_START $28 $00          ;repeat 41 times
003D02 003D02 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
                                      ;#Page 7:
003D04 003D04 B7 10 00                                        DB  $B7 $10 $00                     ;set page and column address
003D07 003D07 E3 FD                                           DB  DISP_ESC_START DISP_ESC_DATA    ;switch to data input
003D09 003D09 E3 2D 00                                        DB  DISP_ESC_START $2D $00          ;repeat 46 times
003D0C 003D0C 07 07                                           DB  $07 $07
003D0E 003D0E E3 05 06                                        DB  DISP_ESC_START $05 $06          ;repeat 6 times
003D11 003D11 00 00 07 07                                     DB  $00 $00 $07 $07
003D15 003D15 E3 03 00                                        DB  DISP_ESC_START $03 $00          ;repeat 4 times
003D18 003D18 07 07                                           DB  $07 $07
003D1A 003D1A E3 03 00                                        DB  DISP_ESC_START $03 $00          ;repeat 4 times
003D1D 003D1D 01 03 06 06 06 07 03 01                         DB  $01 $03 $06 $06 $06 $07 $03 $01
003D25 003D25 00 07 07                                        DB  $00 $07 $07
003D28 003D28 E3 03 00                                        DB  DISP_ESC_START $03 $00          ;repeat 4 times
003D2B 003D2B 06 06                                           DB  $06 $06
003D2D 003D2D E3 2A 00                                        DB  DISP_ESC_START $2A $00          ;repeat 43 times
003D30 003D30 E3 FE                                           DB  DISP_ESC_START DISP_ESC_CMD     ;switch to command input
003D32 003D32 -> $3D32                IMG_SEQ_ERROR_END       EQU     *
003D32 003D32 -> $3D32                IMG_TABS_END            EQU     *
003D32 003D32 -> $3D32                IMG_TABS_END_LIN        EQU     @
                                      ;###############################################################################
                                      ;# Constants                                                                   #
                                      ;###############################################################################
                                      ;Size of the vector table
003D32 003D32 -> $0080                VECTAB_SIZE             EQU     $80
                                      ;###############################################################################
                                      ;# Variables                                                                   #
                                      ;###############################################################################
00198B 00198B                                                 ORG     VECTAB_VARS_START, VECTAB_VARS_START_LIN
00198B 00198B -> $198B                VECTAB_VARS_END         EQU     *
00198B 00198B -> $198B                VECTAB_VARS_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Code                                                                        #
                                      ;###############################################################################
00141A 00301A                                                 ORG     VECTAB_CODE_START, VECTAB_CODE_START_LIN
00141A 00301A -> $141A                VECTAB_CODE_END         EQU     *
00141A 00301A -> $301A                VECTAB_CODE_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# Tables                                                                      #
                                      ;###############################################################################
001400 003000                                                 ORG     VECTAB_TABS_START, VECTAB_TABS_START_LIN
                                      ;#Interrupt service routines
                                      ;#--------------------------
001400 003000 -> $377C                ISR_SPURIOUS            EQU     BOOTLOADER_ISR_ERROR    ;vector base + $80
001400 003000 -> $377C                ISR_PAD                 EQU     BOOTLOADER_ISR_ERROR    ;vector base + $82
001400 003000 -> $377C                ISR_ADCCOMP             EQU     BOOTLOADER_ISR_ERROR    ;vector base + $84
001400 003000 -> $377C                ISR_RES86               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $86
001400 003000 -> $377C                ISR_API                 EQU     BOOTLOADER_ISR_ERROR    ;vector base + $88
001400 003000 -> $377C                ISR_LVI                 EQU     BOOTLOADER_ISR_ERROR    ;vector base + $8A
001400 003000 -> $377C                ISR_RES8C               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $8C
001400 003000 -> $377C                ISR_PORTP               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $8E
001400 003000 -> $377C                ISR_RES90               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $90
001400 003000 -> $377C                ISR_RES92               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $92
001400 003000 -> $377C                ISR_RES94               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $94
001400 003000 -> $377C                ISR_RES96               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $96
001400 003000 -> $377C                ISR_RES98               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $98
001400 003000 -> $377C                ISR_RES9A               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $9A
001400 003000 -> $377C                ISR_RES9C               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $9C
001400 003000 -> $377C                ISR_RES9E               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $9E
001400 003000 -> $377C                ISR_RESA0               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $A0
001400 003000 -> $377C                ISR_RESA2               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $A2
001400 003000 -> $377C                ISR_RESA4               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $A4
001400 003000 -> $377C                ISR_RESA6               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $A6
001400 003000 -> $377C                ISR_RESA8               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $A8
001400 003000 -> $377C                ISR_RESAA               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $AA
001400 003000 -> $377C                ISR_RESAC               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $AC
001400 003000 -> $377C                ISR_RESAE               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $AE
001400 003000 -> $377C                ISR_CANTX               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $B0
001400 003000 -> $377C                ISR_CANRX               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $B2
001400 003000 -> $377C                ISR_CANERR              EQU     BOOTLOADER_ISR_ERROR    ;vector base + $B4
001400 003000 -> $377C                ISR_CANWUP              EQU     BOOTLOADER_ISR_ERROR    ;vector base + $B6
001400 003000 -> $16D0                ISR_FLASH               EQU     NVM_ISR_CC
001400 003000 -> $377C                ISR_FLASHFLT            EQU     BOOTLOADER_ISR_ERROR    ;vector base + $BA
001400 003000 -> $377C                ISR_SPI2                EQU     BOOTLOADER_ISR_ERROR    ;vector base + $BC
001400 003000 -> $377C                ISR_SPI1                EQU     BOOTLOADER_ISR_ERROR    ;vector base + $BE
001400 003000 -> $377C                ISR_RESC0               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $C0
001400 003000 -> $377C                ISR_SCI2                EQU     BOOTLOADER_ISR_ERROR    ;vector base + $C2
001400 003000 -> $377C                ISR_RESC4               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $C4
001400 003000 -> $377C                ISR_PLLLOCK             EQU     BOOTLOADER_ISR_ERROR    ;vector base + $C6
001400 003000 -> $377C                ISR_OSCSTAT             EQU     BOOTLOADER_ISR_ERROR    ;vector base + $C8
001400 003000 -> $377C                ISR_RESCA               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $CA
001400 003000 -> $377C                ISR_ACMP                EQU     BOOTLOADER_ISR_ERROR    ;vector base + $CC
001400 003000 -> $377C                ISR_PORTJ               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $CC
001400 003000 -> $377C                ISR_RESD0               EQU     BOOTLOADER_ISR_ERROR    ;vector base + $D0
001400 003000 -> $377C                ISR_ATD0                EQU     BOOTLOADER_ISR_ERROR    ;vector base + $D2
001400 003000 -> $377C                ISR_SCI1                EQU     BOOTLOADER_ISR_ERROR    ;vector base + $D4
001400 003000 -> $1568                ISR_SCI0                EQU     SCI_ISR_RXTX
001400 003000 -> $37E7                ISR_SPI0                EQU     DISP_ISR                ;vector base + $D8
001400 003000 -> $377C                ISR_TIM_PAIE            EQU     BOOTLOADER_ISR_ERROR            ;vector base + $DA
001400 003000 -> $377C                ISR_TIM_PAOV            EQU     BOOTLOADER_ISR_ERROR            ;vector base + $DC
001400 003000 -> $377C                ISR_TIM_TOV             EQU     BOOTLOADER_ISR_ERROR            ;vector base + $DE
001400 003000 -> $377C                ISR_TIM_TC7             EQU     BOOTLOADER_ISR_ERROR            ;vector base + $E0
001400 003000 -> $377C                ISR_TIM_TC6             EQU     BOOTLOADER_ISR_ERROR            ;vector base + $E2
001400 003000 -> $377C                ISR_TIM_TC5             EQU     BOOTLOADER_ISR_ERROR            ;vector base + $E4
001400 003000 -> $377C                ISR_TIM_TC4             EQU     BOOTLOADER_ISR_ERROR            ;vector base + $E6
001400 003000 -> $377C                ISR_TIM_TC3             EQU     BOOTLOADER_ISR_ERROR            ;vector base + $E8
001400 003000 -> $377C                ISR_TIM_TC2             EQU     BOOTLOADER_ISR_ERROR            ;vector base + $EA
001400 003000 -> $377C                ISR_TIM_TC1             EQU     BOOTLOADER_ISR_ERROR            ;vector base + $EC
001400 003000 -> $14DD                ISR_TIM_TC0             EQU     SCI_ISR_OC
001400 003000 -> $377C                ISR_RTI                 EQU     BOOTLOADER_ISR_ERROR    ;vector base + $F0
001400 003000 -> $377C                ISR_IRQ                 EQU     BOOTLOADER_ISR_ERROR    ;vector base + $F2
001400 003000 -> $377C                ISR_XIRQ                EQU     BOOTLOADER_ISR_ERROR    ;vector base + $F4
001400 003000 -> $377C                ISR_SWI                 EQU     BOOTLOADER_ISR_ERROR    ;vector base + $F6
001400 003000 -> $377C                ISR_TRAP                EQU     BOOTLOADER_ISR_ERROR    ;vector base + $F8
001400 003000 -> $1400                VECTAB_TABS_END         EQU     *
001400 003000 -> $3000                VECTAB_TABS_END_LIN     EQU     @
                                      ;###############################################################################
                                      ;# S12G Vector Table                                                           #
                                      ;###############################################################################
002F80 003F80                                                 ORG     VECTAB_START, VECTAB_START_LIN
002F80 003F80 37 7C                   VEC_SPURIOUS            DW      ISR_SPURIOUS            ;vector base + $80
002F82 003F82 37 7C                   VEC_PAD                 DW      ISR_PAD                 ;vector base + $82
002F84 003F84 37 7C                   VEC_ADCCOMP             DW      ISR_ADCCOMP             ;vector base + $84
002F86 003F86 37 7C                   VEC_RES86               DW      ISR_RES86               ;vector base + $86
002F88 003F88 37 7C                   VEC_API                 DW      ISR_API                 ;vector base + $88
002F8A 003F8A 37 7C                   VEC_LVI                 DW      ISR_LVI                 ;vector base + $8A
002F8C 003F8C 37 7C                   VEC_RES8C               DW      ISR_RES8C               ;vector base + $8C
002F8E 003F8E 37 7C                   VEC_PORTP               DW      ISR_PORTP               ;vector base + $8E
002F90 003F90 37 7C                   VEC_RES90               DW      ISR_RES90               ;vector base + $90
002F92 003F92 37 7C                   VEC_RES92               DW      ISR_RES92               ;vector base + $92
002F94 003F94 37 7C                   VEC_RES94               DW      ISR_RES94               ;vector base + $94
002F96 003F96 37 7C                   VEC_RES96               DW      ISR_RES96               ;vector base + $96
002F98 003F98 37 7C                   VEC_RES98               DW      ISR_RES98               ;vector base + $98
002F9A 003F9A 37 7C                   VEC_RES9A               DW      ISR_RES9A               ;vector base + $9A
002F9C 003F9C 37 7C                   VEC_RES9C               DW      ISR_RES9C               ;vector base + $9C
002F9E 003F9E 37 7C                   VEC_RES9E               DW      ISR_RES9E               ;vector base + $9E
002FA0 003FA0 37 7C                   VEC_RESA0               DW      ISR_RESA0               ;vector base + $A0
002FA2 003FA2 37 7C                   VEC_RESA2               DW      ISR_RESA2               ;vector base + $A2
002FA4 003FA4 37 7C                   VEC_RESA4               DW      ISR_RESA4               ;vector base + $A4
002FA6 003FA6 37 7C                   VEC_RESA6               DW      ISR_RESA6               ;vector base + $A6
002FA8 003FA8 37 7C                   VEC_RESA8               DW      ISR_RESA8               ;vector base + $A8
002FAA 003FAA 37 7C                   VEC_RESAA               DW      ISR_RESAA               ;vector base + $AA
002FAC 003FAC 37 7C                   VEC_RESAC               DW      ISR_RESAC               ;vector base + $AC
002FAE 003FAE 37 7C                   VEC_RESAE               DW      ISR_RESAE               ;vector base + $AE
002FB0 003FB0 37 7C                   VEC_CANTX               DW      ISR_CANTX               ;vector base + $A0
002FB2 003FB2 37 7C                   VEC_CANRX               DW      ISR_CANRX               ;vector base + $B2
002FB4 003FB4 37 7C                   VEC_CANERR              DW      ISR_CANERR              ;vector base + $B4
002FB6 003FB6 37 7C                   VEC_CANWUP              DW      ISR_CANWUP              ;vector base + $B6
002FB8 003FB8 16 D0                   VEC_FLASH               DW      ISR_FLASH               ;vector base + $B8
002FBA 003FBA 37 7C                   VEC_FLASHFLT            DW      ISR_FLASHFLT            ;vector base + $BA
002FBC 003FBC 37 7C                   VEC_SPI2                DW      ISR_SPI2                ;vector base + $BC
002FBE 003FBE 37 7C                   VEC_SPI1                DW      ISR_SPI1                ;vector base + $BE
002FC0 003FC0 37 7C                   VEC_RESC0               DW      ISR_RESC0               ;vector base + $C0
002FC2 003FC2 37 7C                   VEC_SCI2                DW      ISR_SCI2                ;vector base + $C2
002FC4 003FC4 37 7C                   VEC_RESC4               DW      ISR_RESC4               ;vector base + $C4
002FC6 003FC6 37 7C                   VEC_PLLLOCK             DW      ISR_PLLLOCK             ;vector base + $C6
002FC8 003FC8 37 7C                   VEC_OSCSTAT             DW      ISR_OSCSTAT             ;vector base + $C8
002FCA 003FCA 37 7C                   VEC_RESCA               DW      ISR_RESCA               ;vector base + $CA
002FCC 003FCC 37 7C                   VEC_ACMP                DW      ISR_ACMP                ;vector base + $CC
002FCE 003FCE 37 7C                   VEC_PORTJ               DW      ISR_PORTJ               ;vector base + $CC
002FD0 003FD0 37 7C                   VEC_RESD0               DW      ISR_RESD0               ;vector base + $D0
002FD2 003FD2 37 7C                   VEC_ATD0                DW      ISR_ATD0                ;vector base + $D2
002FD4 003FD4 37 7C                   VEC_SCI1                DW      ISR_SCI1                ;vector base + $D4
002FD6 003FD6 15 68                   VEC_SCI0                DW      ISR_SCI0                ;vector base + $D6
002FD8 003FD8 37 E7                   VEC_SPI0                DW      ISR_SPI0                ;vector base + $D8
002FDA 003FDA 37 7C                   VEC_TIM_PAIE            DW      ISR_TIM_PAIE            ;vector base + $DA
002FDC 003FDC 37 7C                   VEC_TIM_PAOV            DW      ISR_TIM_PAOV            ;vector base + $DC
002FDE 003FDE 37 7C                   VEC_TIM_TOV             DW      ISR_TIM_TOV             ;vector base + $DE
002FE0 003FE0 37 7C                   VEC_TIM_TC7             DW      ISR_TIM_TC7             ;vector base + $E0
002FE2 003FE2 37 7C                   VEC_TIM_TC6             DW      ISR_TIM_TC6             ;vector base + $E2
002FE4 003FE4 37 7C                   VEC_TIM_TC5             DW      ISR_TIM_TC5             ;vector base + $E4
002FE6 003FE6 37 7C                   VEC_TIM_TC4             DW      ISR_TIM_TC4             ;vector base + $E6
002FE8 003FE8 37 7C                   VEC_TIM_TC3             DW      ISR_TIM_TC3             ;vector base + $E8
002FEA 003FEA 37 7C                   VEC_TIM_TC2             DW      ISR_TIM_TC2             ;vector base + $EA
002FEC 003FEC 37 7C                   VEC_TIM_TC1             DW      ISR_TIM_TC1             ;vector base + $EC
002FEE 003FEE 14 DD                   VEC_TIM_TC0             DW      ISR_TIM_TC0             ;vector base + $EE
002FF0 003FF0 37 7C                   VEC_RTI                 DW      ISR_RTI                 ;vector base + $F0
002FF2 003FF2 37 7C                   VEC_IRQ                 DW      ISR_IRQ                 ;vector base + $F2
002FF4 003FF4 37 7C                   VEC_XIRQ                DW      ISR_XIRQ                ;vector base + $F4
002FF6 003FF6 37 7C                   VEC_SWI                 DW      ISR_SWI                 ;vector base + $F6
002FF8 003FF8 37 7C                   VEC_TRAP                DW      ISR_TRAP                ;vector base + $F8
002FFA 003FFA 37 84                   VEC_RESET_COP           DW      RESET_COP_ENTRY         ;vector base + $FA
002FFC 003FFC 37 8D                   VEC_RESET_CM            DW      RESET_CM_ENTRY          ;vector base + $FC
002FFE 003FFE 35 8B                   VEC_RESET_EXT           DW      RESET_EXT_ENTRY         ;vector base + $FE
003000 004000 -> $3000                VECTAB_END              EQU     *
003000 004000 -> $4000                VECTAB_END_LIN          EQU     @
